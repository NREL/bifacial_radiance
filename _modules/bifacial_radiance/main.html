
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>bifacial_radiance.main &#8212; bifacial_radiance 0.4.4.dev373+g013fa7c.d20240911 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/no_scrollbars.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/bifacial_radiance.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../examples.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../manualapi.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../whatsnew.html">
  Whatâ€™s New
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../validation.html">
  Validation
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/NREL/bifacial_radiance" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://stackoverflow.com/questions/tagged/bifacial-radiance" rel="noopener" target="_blank" title="StackOverflow"><span><i class="fab fa-stack-overflow"></i></span>
            <label class="sr-only">StackOverflow</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/bifacial_radiance" rel="noopener" target="_blank" title="PyPI"><span><i class="fab fa-python"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for bifacial_radiance.main</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">@author: cdeline</span>

<span class="sd">bifacial_radiance.py - module to develop radiance bifacial scenes, including gendaylit and gencumulativesky</span>
<span class="sd">7/5/2016 - test script based on G173_journal_height</span>
<span class="sd">5/1/2017 - standalone module</span>

<span class="sd">Pre-requisites:</span>
<span class="sd">    This software is written for Python &gt;3.6 leveraging many Anaconda tools (e.g. pandas, numpy, etc)</span>

<span class="sd">    *RADIANCE software should be installed from https://github.com/NREL/Radiance/releases</span>

<span class="sd">    *If you want to use gencumulativesky, move &#39;gencumulativesky.exe&#39; from</span>
<span class="sd">    &#39;bifacial_radiance\data&#39; into your RADIANCE source directory.</span>

<span class="sd">    *If using a Windows machine you should download the Jaloxa executables at</span>
<span class="sd">    http://www.jaloxa.eu/resources/radiance/radwinexe.shtml#Download</span>

<span class="sd">    * Installation of  bifacial_radiance from the repo:</span>
<span class="sd">    1. Clone the repo</span>
<span class="sd">    2. Navigate to the directory using the command prompt</span>
<span class="sd">    3. run `pip install -e . `</span>

<span class="sd">Overview:</span>
<span class="sd">    Bifacial_radiance includes several helper functions to make it easier to evaluate</span>
<span class="sd">    different PV system orientations for rear bifacial irradiance.</span>
<span class="sd">    Note that this is simply an optical model - identifying available rear irradiance under different conditions.</span>

<span class="sd">    For a detailed demonstration example, look at the .ipnyb notebook in \docs\</span>

<span class="sd">    There are two solar resource modes in bifacial_radiance: `gendaylit` uses hour-by-hour solar</span>
<span class="sd">    resource descriptions using the Perez diffuse tilted plane model.</span>
<span class="sd">    `gencumulativesky` is an annual average solar resource that combines hourly</span>
<span class="sd">    Perez skies into one single solar source, and computes an annual average.</span>

<span class="sd">    bifacial_radiance includes five object-oriented classes:</span>

<span class="sd">    RadianceObj:  top level class to work on radiance objects, keep track of filenames,</span>
<span class="sd">    sky values, PV module type etc.</span>

<span class="sd">    GroundObj:    details for the ground surface and reflectance</span>

<span class="sd">    SceneObj:    scene information including array configuration (row spacing, clearance or hub height)</span>

<span class="sd">    MetObj: meteorological data from EPW (energyplus) file.</span>
<span class="sd">        Future work: include other file support including TMY files</span>

<span class="sd">    AnalysisObj: Analysis class for plotting and reporting</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>  <span class="c1"># replacement for os.system()</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="c1">#from input import *</span>

<span class="c1"># Mutual parameters across all processes</span>
<span class="c1">#daydate=sys.argv[1]</span>


<span class="k">global</span> <span class="n">DATA_PATH</span> <span class="c1"># path to data files including module.json.  Global context</span>
<span class="c1">#DATA_PATH = os.path.abspath(pkg_resources.resource_filename(&#39;bifacial_radiance&#39;, &#39;data/&#39;) )</span>
<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;data&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_findme</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="c1">#find string match in a list. script from stackexchange</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">a</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_missingKeyWarning</span><span class="p">(</span><span class="n">dictype</span><span class="p">,</span> <span class="n">missingkey</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span> <span class="c1"># prints warnings </span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">newvalue</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">valueunit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valueunit</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: </span><span class="si">{}</span><span class="s2"> Dictionary Parameters passed, but </span><span class="si">{}</span><span class="s2"> is missing. &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dictype</span><span class="p">,</span> <span class="n">missingkey</span><span class="p">))</span>        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting it to default value of </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> to continue</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newvalue</span><span class="p">,</span> <span class="n">valueunit</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_normRGB</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span> <span class="c1">#normalize by each color for human vision sensitivity</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">*</span><span class="mf">0.216</span><span class="o">+</span><span class="n">g</span><span class="o">*</span><span class="mf">0.7152</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="mf">0.0722</span>

<span class="k">def</span> <span class="nf">_popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">data_in</span><span class="p">,</span> <span class="n">data_out</span><span class="o">=</span><span class="n">PIPE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function subprocess.popen replaces os.system</span>
<span class="sd">    - gives better input/output process control</span>
<span class="sd">    usage: pass &lt;data_in&gt; to process &lt;cmd&gt; and return results</span>
<span class="sd">    based on rgbeimage.py (Thomas Bleicher 2010)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="c1"># gets rid of unicode oddities</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">data_out</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="n">shell</span><span class="p">)</span> <span class="c1">#shell=True required for Linux? quick fix, but may be security concern</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">data_in</span><span class="p">)</span>
    <span class="c1">#if err:</span>
    <span class="c1">#    return &#39;message: &#39;+err.strip()</span>
    <span class="c1">#if data:</span>
    <span class="c1">#    return data. in Python3 this is returned as `bytes` and needs to be decoded</span>
    <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">returntuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">),</span> <span class="s1">&#39;message: &#39;</span><span class="o">+</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">returntuple</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;message: &#39;</span><span class="o">+</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">returntuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="c1">#Py3 requires decoding</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">returntuple</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">returntuple</span>

<span class="k">def</span> <span class="nf">_interactive_load</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Tkinter file picker</span>
    <span class="kn">import</span> <span class="nn">tkinter</span>
    <span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">filedialog</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span> <span class="c1">#Start interactive file input</span>
    <span class="n">root</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="s2">&quot;-topmost&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#Bring window into foreground</span>
    <span class="k">return</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span> <span class="c1">#initialdir = data_dir</span>

<span class="k">def</span> <span class="nf">_interactive_directory</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Tkinter directory picker.  Now Py3.6 compliant!</span>
    <span class="kn">import</span> <span class="nn">tkinter</span>
    <span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">filedialog</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span> <span class="c1">#Start interactive file input</span>
    <span class="n">root</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="s2">&quot;-topmost&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#Bring to front</span>
    <span class="k">return</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askdirectory</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_modDict</span><span class="p">(</span><span class="n">originaldict</span><span class="p">,</span> <span class="n">moddict</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compares keys in originaldict with moddict and updates values of </span>
<span class="sd">    originaldict to moddict if existing.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    originaldict : dictionary</span>
<span class="sd">        Original dictionary calculated, for example frontscan or backscan dictionaries.</span>
<span class="sd">    moddict : dictionary</span>
<span class="sd">        Modified dictinoary, for example modscan[&#39;xstart&#39;] = 0 to change position of x.</span>
<span class="sd">    relative : Bool</span>
<span class="sd">        if passing modscanfront and modscanback to modify dictionarie of positions,</span>
<span class="sd">        this sets if the values passed to be updated are relative or absolute. </span>
<span class="sd">        Default is absolute value (relative=False)</span>
<span class="sd">            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    originaldict : dictionary</span>
<span class="sd">        Updated original dictionary with values from moddict.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">newdict</span> <span class="o">=</span> <span class="n">originaldict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">moddict</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">moddict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">newdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">moddict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrong key in modified dictionary&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">newdict</span>

<span class="k">def</span> <span class="nf">_heightCasesSwitcher</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">,</span> <span class="n">preferred</span><span class="o">=</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="n">nonpreferred</span><span class="o">=</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">,</span>
                         <span class="n">suppress_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sceneDict : dictionary</span>
<span class="sd">            Dictionary that might contain more than one way of defining height for </span>
<span class="sd">            the array: `clearance_height`, `hub_height`, `height`*</span>
<span class="sd">            * height deprecated from sceneDict. This function helps choose</span>
<span class="sd">            * which definition to use.  </span>
<span class="sd">        preferred : str, optional</span>
<span class="sd">            When sceneDict has hub_height and clearance_height, or it only has height,</span>
<span class="sd">            it will leave only the preferred option.. The default is &#39;hub_height&#39;.</span>
<span class="sd">        nonpreferred : TYPE, optional</span>
<span class="sd">            When sceneDict has hub_height and clearance_height, </span>
<span class="sd">            it wil ldelete this nonpreferred option. The default is &#39;clearance_height&#39;.</span>
<span class="sd">        suppress_warning  :  Bool, default False</span>
<span class="sd">            If both heights passed in SceneDict, suppress the warning        </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sceneDict : TYPE</span>
<span class="sd">            Dictionary now containing the appropriate definition for system height. </span>
<span class="sd">        use_clearanceheight : Bool</span>
<span class="sd">            Helper variable to specify if dictionary has only clearancehet for</span>
<span class="sd">            use inside `makeScene1axis`. Will get deprecated once that internal</span>
<span class="sd">            function is streamlined.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: When we update to python 3.9.0, this could be a Switch Cases (Structural Pattern Matching):</span>
    
            
        <span class="n">heightCases</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">heightCases</span> <span class="o">=</span> <span class="n">heightCases</span><span class="o">+</span><span class="s1">&#39;height__&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;clearance_height&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">heightCases</span> <span class="o">=</span> <span class="n">heightCases</span><span class="o">+</span><span class="s1">&#39;clearance_height__&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;hub_height&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">heightCases</span> <span class="o">=</span> <span class="n">heightCases</span><span class="o">+</span><span class="s1">&#39;hub_height__&#39;</span>
        
        <span class="n">use_clearanceheight</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># CASES:</span>
        <span class="k">if</span> <span class="n">heightCases</span> <span class="o">==</span> <span class="s1">&#39;_height__&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sceneDict Warning: &#39;height&#39; is being deprecated. &quot;</span><span class="o">+</span>
                                  <span class="s2">&quot;Renaming as &quot;</span><span class="o">+</span><span class="n">preferred</span><span class="p">)</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="n">preferred</span><span class="p">]</span><span class="o">=</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
        
        <span class="k">elif</span> <span class="n">heightCases</span> <span class="o">==</span> <span class="s1">&#39;_clearance_height__&#39;</span><span class="p">:</span>
            <span class="c1">#print(&quot;Using clearance_height.&quot;)</span>
            <span class="n">use_clearanceheight</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">elif</span> <span class="n">heightCases</span> <span class="o">==</span> <span class="s1">&#39;_hub_height__&#39;</span><span class="p">:</span>
            <span class="c1">#print(&quot;Using hub_height.&#39;&quot;)</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">heightCases</span> <span class="o">==</span> <span class="s1">&#39;_height__clearance_height__&#39;</span><span class="p">:</span>  
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sceneDict Warning: &#39;clearance_height and &#39;height&#39; &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;(deprecated) are being passed. removing &#39;height&#39; &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;from sceneDict for this tracking routine&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
            <span class="n">use_clearanceheight</span> <span class="o">=</span> <span class="kc">True</span>
                            
        <span class="k">elif</span> <span class="n">heightCases</span> <span class="o">==</span> <span class="s1">&#39;_height__hub_height__&#39;</span><span class="p">:</span>     
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sceneDict Warning: &#39;height&#39; is being deprecated. Using &#39;hub_height&#39;&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
        
        <span class="k">elif</span> <span class="n">heightCases</span> <span class="o">==</span> <span class="s1">&#39;_height__clearance_height__hub_height__&#39;</span><span class="p">:</span>       
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sceneDict Warning: &#39;hub_height&#39;, &#39;clearance_height&#39;&quot;</span><span class="o">+</span>
                  <span class="s2">&quot;, and &#39;height&#39; are being passed. Removing &#39;height&#39;&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; (deprecated) and &quot;</span><span class="o">+</span> <span class="n">nonpreferred</span><span class="o">+</span> <span class="s2">&quot;, using &quot;</span><span class="o">+</span><span class="n">preferred</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">sceneDict</span><span class="p">[</span><span class="n">nonpreferred</span><span class="p">]</span>
        
        <span class="k">elif</span> <span class="n">heightCases</span> <span class="o">==</span> <span class="s1">&#39;_clearance_height__hub_height__&#39;</span><span class="p">:</span>  
            <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_warning</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sceneDict Warning: &#39;hub_height&#39; and &#39;clearance_height&#39;&quot;</span><span class="o">+</span>
                      <span class="s2">&quot; are being passed. Using &quot;</span><span class="o">+</span><span class="n">preferred</span><span class="o">+</span>
                      <span class="s2">&quot; and removing &quot;</span><span class="o">+</span> <span class="n">nonpreferred</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">sceneDict</span><span class="p">[</span><span class="n">nonpreferred</span><span class="p">]</span>
    
        <span class="k">else</span><span class="p">:</span> 
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;sceneDict Error! no argument in sceneDict found &quot;</span><span class="o">+</span>
                   <span class="s2">&quot;for &#39;hub_height&#39;, &#39;height&#39; nor &#39;clearance_height&#39;. &quot;</span><span class="o">+</span>
                   <span class="s2">&quot;Exiting routine.&quot;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">sceneDict</span><span class="p">,</span> <span class="n">use_clearanceheight</span>

<span class="k">def</span> <span class="nf">_is_leap_and_29Feb</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="c1"># Removes Feb. 29 if it a leap year.</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> \
           <span class="p">((</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">%</span> <span class="mi">400</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;</span> \
           <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_subhourlydatatoGencumskyformat</span><span class="p">(</span><span class="n">gencumskydata</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">):</span>
    <span class="c1"># Subroutine to resample, pad, remove leap year and get data in the</span>
    <span class="c1"># 8760 hourly format</span>
    <span class="c1"># for saving the temporary files for gencumsky in _saveTempTMY and</span>
    <span class="c1"># _makeTrackerCSV</span>
    

    <span class="c1">#Resample to hourly. Gencumsky wants right-labeled data.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;60min&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1"># Pandas 2.0 error</span>
        <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;60min&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
    
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="c1">#switch from left to right labeled by adding an hour</span>
        <span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>
                     

    <span class="c1"># Padding</span>
    <span class="n">tzinfo</span> <span class="o">=</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tzinfo</span>
    <span class="n">padstart</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tzinfo</span><span class="p">)</span>
    <span class="n">padend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tzinfo</span><span class="p">)</span>
    <span class="n">gencumskydata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># set first datapt to zero to forward fill w zeros</span>
    <span class="n">gencumskydata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># set last datapt to zero to forward fill w zeros</span>
    <span class="c1"># check if index exists. I&#39;m sure there is a way to do this backwards.</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">padstart</span><span class="p">])):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data starts on Jan. 01&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#gencumskydata=gencumskydata.append(pd.DataFrame(index=[padstart]))</span>
        <span class="n">gencumskydata</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">gencumskydata</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">padstart</span><span class="p">])])</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">padend</span><span class="p">])):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data ends on Dec. 31st&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#gencumskydata=gencumskydata.append(pd.DataFrame(index=[padend]))</span>
        <span class="n">gencumskydata</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">gencumskydata</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">padend</span><span class="p">])])</span>
    <span class="n">gencumskydata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">padstart</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">gencumskydata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">padend</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">gencumskydata</span><span class="o">=</span><span class="n">gencumskydata</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span> 
    <span class="c1"># Fill empty timestamps with zeros</span>
    <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;60min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Mask leap year</span>
    <span class="n">leapmask</span> <span class="o">=</span>  <span class="o">~</span><span class="p">(</span><span class="n">_is_leap_and_29Feb</span><span class="p">(</span><span class="n">gencumskydata</span><span class="p">))</span>
    <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">gencumskydata</span><span class="p">[</span><span class="n">leapmask</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">gencumskydata</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">8760</span><span class="p">:</span>
        <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">gencumskydata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">gencumskydata</span>
    <span class="c1"># end _subhourlydatatoGencumskyformat   </span>

<span class="k">def</span> <span class="nf">_checkRaypath</span><span class="p">():</span>
    <span class="c1"># Ensure that os.environ[&#39;RAYPATH&#39;] exists and contains current directory &#39;.&#39;     </span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
        <span class="n">splitter</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">splitter</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">raypath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;RAYPATH&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">raypath</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">()</span>
        <span class="n">raysplit</span> <span class="o">=</span> <span class="n">raypath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">splitter</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">raysplit</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;RAYPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">raysplit</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">splitter</span><span class="p">]))</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No RAYPATH set for RADIANCE.  Please check your RADIANCE installation.&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SuperClass</span><span class="p">:</span>
      <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>    
          <span class="c1">#return str(self.__dict__)</span>
      <span class="nd">@property</span>
      <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">return</span> <span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;methods&#39;</span><span class="p">)</span> 
                                               <span class="ow">or</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">)))]</span>
      <span class="nd">@property</span>
      <span class="k">def</span> <span class="nf">methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
          <span class="k">return</span> <span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;methods&#39;</span><span class="p">)</span> 
                                                      <span class="ow">or</span>  <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">)))]</span>
  
    

<div class="viewcode-block" id="RadianceObj"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.html#bifacial_radiance.RadianceObj">[docs]</a><span class="k">class</span> <span class="nc">RadianceObj</span><span class="p">(</span><span class="n">SuperClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The RadianceObj top level class is used to work on radiance objects, </span>
<span class="sd">    keep track of filenames,  sky values, PV module configuration, etc.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : text to append to output files</span>
<span class="sd">    filelist : list of Radiance files to create oconv</span>
<span class="sd">    nowstr : current date/time string</span>
<span class="sd">    path : working directory with Radiance materials and objects</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    __init__ : initialize the object</span>
<span class="sd">    _setPath : change the working directory</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#return str(self.__dict__)  </span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;trackerdict&#39;</span><span class="p">})</span> 
<div class="viewcode-block" id="RadianceObj.__init__"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.html#bifacial_radiance.RadianceObj.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hpc</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        initialize RadianceObj with path of Radiance materials and objects,</span>
<span class="sd">        as well as a basename to append to</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: string, append temporary and output files with this value</span>
<span class="sd">        path: location of Radiance materials and objects</span>
<span class="sd">        hpc:  Keeps track if User is running simulation on HPC so some file </span>
<span class="sd">              reading routines try reading a bit longer and some writing </span>
<span class="sd">              routines (makeModule) that overwrite themselves are inactivated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        none</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span> <span class="o">=</span> <span class="p">{}</span>        <span class="c1"># data from epw met file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>           <span class="c1"># data stored at each timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>             <span class="c1"># path of working directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>         <span class="c1"># basename to append</span>
        <span class="c1">#self.filelist = []         # list of files to include in the oconv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialfiles</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># material files for oconv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c1"># skyfiles for oconv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># scene rad files for oconv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">octfile</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1">#octfile name for analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># cumulative tabulation of front W/m2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span> <span class="o">=</span> <span class="mi">0</span>        <span class="c1"># cumulative tabulation of rear W/m2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backRatio</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># ratio of rear / front Wm2</span>
        <span class="c1">#self.nMods = None        # number of modules per row</span>
        <span class="c1">#self.nRows = None        # number of rows per scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span> <span class="o">=</span> <span class="n">hpc</span>           <span class="c1"># HPC simulation is being run. Some read/write functions are modified</span>
        
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nowstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
        <span class="n">_checkRaypath</span><span class="p">()</span>       <span class="c1"># make sure we have RADIANCE path set up correctly</span>

        <span class="c1"># DEFAULTS</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nowstr</span>  <span class="c1"># set default filename for output files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">name</span> <span class="c1"># add backwards compatibility for prior versions</span>
        <span class="c1">#self.__name__ = self.name  #optional info</span>
        <span class="c1">#self.__str__ = self.__name__   #optional info</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setPath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="c1"># load files in the /materials/ directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">returnMaterialFiles</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        setPath - move path and working directory</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path = &#39;</span><span class="o">+</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Path doesn&#39;&#39;t exist: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

        <span class="c1"># check for path in the new Radiance directory:</span>
        <span class="k">def</span> <span class="nf">_checkPath</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>  <span class="c1"># create the file structure if it doesn&#39;t exist</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Making path: &#39;</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>

        <span class="n">_checkPath</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">);</span> <span class="n">_checkPath</span><span class="p">(</span><span class="s1">&#39;objects&#39;</span><span class="p">)</span>
        <span class="n">_checkPath</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">);</span> <span class="n">_checkPath</span><span class="p">(</span><span class="s1">&#39;skies&#39;</span><span class="p">);</span> <span class="n">_checkPath</span><span class="p">(</span><span class="s1">&#39;EPWs&#39;</span><span class="p">)</span>
        <span class="c1"># if materials directory doesn&#39;t exist, populate it with ground.rad</span>
        <span class="c1"># figure out where pip installed support files.</span>
        <span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copy2</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">):</span>  <span class="c1">#copy ground.rad to /materials</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Making path: materials&#39;</span><span class="p">)</span>

            <span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">,</span> <span class="s1">&#39;ground.rad&#39;</span><span class="p">),</span> <span class="s1">&#39;materials&#39;</span><span class="p">)</span>
        <span class="c1"># if views directory doesn&#39;t exist, create it with two default views - side.vp and front.vp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="s1">&#39;side.vp&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;rvu -vtv -vp -10 1.5 3 -vd 1.581 0 -0.519234 &#39;</span><span class="o">+</span>
                        <span class="s1">&#39;-vu 0 0 1 -vh 45 -vv 45 -vo 0 -va 0 -vs 0 -vl 0&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="s1">&#39;front.vp&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;rvu -vtv -vp 0 -3 5 -vd 0 0.894427 -0.894427 &#39;</span><span class="o">+</span>
                        <span class="s1">&#39;-vu 0 0 1 -vh 45 -vv 45 -vo 0 -va 0 -vs 0 -vl 0&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="RadianceObj.getfilelist"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.getfilelist.html#bifacial_radiance.RadianceObj.getfilelist">[docs]</a>    <span class="k">def</span> <span class="nf">getfilelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Return concat of matfiles, radfiles and skyfiles</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialfiles</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span></div>

<div class="viewcode-block" id="RadianceObj.save"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.save.html#bifacial_radiance.RadianceObj.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pickle the radiance object for further use.</span>
<span class="sd">        Very basic operation - not much use right now.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        savefile : str</span>
<span class="sd">            Optional savefile name, with .pickle extension.</span>
<span class="sd">            Otherwise default to save.pickle</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">pickle</span>

        <span class="k">if</span> <span class="n">savefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">savefile</span> <span class="o">=</span> <span class="s1">&#39;save.pickle&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved to file </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">savefile</span><span class="p">))</span></div>

    <span class="c1">#def setHPC(self, hpc=True):</span>
    <span class="c1">#    self.hpc = hpc</span>
        
    <span class="k">def</span> <span class="nf">addMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">Rrefl</span><span class="p">,</span> <span class="n">Grefl</span><span class="p">,</span> <span class="n">Brefl</span><span class="p">,</span> <span class="n">materialtype</span><span class="o">=</span><span class="s1">&#39;plastic&#39;</span><span class="p">,</span> 
                    <span class="n">specularity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">roughness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">material_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rewrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to add a material in Radiance format. </span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        material : str</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        Rrefl : str</span>
<span class="sd">            Reflectivity for first wavelength, or &#39;R&#39; bin.</span>
<span class="sd">        Grefl : str</span>
<span class="sd">            Reflecstrtivity for second wavelength, or &#39;G&#39; bin.</span>
<span class="sd">        Brefl : str</span>
<span class="sd">            Reflectivity for third wavelength, or &#39;B&#39; bin.</span>
<span class="sd">        materialtype : str, optional</span>
<span class="sd">            Type of material. The default is &#39;plastic&#39;. Others can be mirror,</span>
<span class="sd">            trans, etc. See RADIANCe documentation. </span>
<span class="sd">        specularity : str, optional</span>
<span class="sd">            Ratio of reflection that is specular and not diffuse. The default is 0.</span>
<span class="sd">        roughness : str, optional</span>
<span class="sd">            This is the microscopic surface roughness: the more jagged the </span>
<span class="sd">            facets are, the rougher it is and more blurry reflections will appear.</span>
<span class="sd">        material_file : str, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>
<span class="sd">        comment : str, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>
<span class="sd">        rewrite : str, optional</span>
<span class="sd">            DESCRIPTION. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None. Just adds the material to the material_file specified or the </span>
<span class="sd">        default in ``materials\ground.rad``.</span>

<span class="sd">        References:</span>
<span class="sd">            See examples of documentation for more materialtype details.</span>
<span class="sd">            http://www.jaloxa.eu/resources/radiance/documentation/docs/radiance_tutorial.pdf page 10</span>
<span class="sd">     </span>
<span class="sd">            Also, you can use https://www.jaloxa.eu/resources/radiance/colour_picker.shtml </span>
<span class="sd">            to have a sense of how the material would look with the RGB values as </span>
<span class="sd">            well as specularity and roughness.</span>

<span class="sd">            To understand more on reflectivity, specularity and roughness values</span>
<span class="sd">            https://thinkmoult.com/radiance-specularity-and-roughness-value-examples.html</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">material_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">material_file</span> <span class="o">=</span> <span class="s1">&#39;ground.rad&#39;</span>    
    
        <span class="n">matfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">,</span> <span class="n">material_file</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">matfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                
        <span class="c1"># search buffer for material matching requested addition</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">buffer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">materialtype</span> <span class="ow">and</span> <span class="n">material</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span>            
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Material exists, overwriting...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">pre</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pre</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">-</span> <span class="mi">2</span>            
                <span class="c1"># commit buffer without material match</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">matfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pre</span><span class="p">]:</span>
                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">buffer</span><span class="p">[</span><span class="n">loc</span><span class="o">+</span><span class="mi">4</span><span class="p">:]:</span>
                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">found</span> <span class="ow">and</span> <span class="n">rewrite</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">found</span><span class="p">):</span>
            <span class="c1"># append -- This will create the file if it doesn&#39;t exist</span>
            <span class="n">file_object</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">matfile</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comment</span><span class="p">))</span>
            <span class="n">file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">void </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">materialtype</span><span class="p">,</span> <span class="n">material</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">materialtype</span> <span class="o">==</span> <span class="s1">&#39;glass&#39;</span> <span class="ow">or</span> <span class="n">materialtype</span> <span class="o">==</span><span class="s1">&#39;mirror&#39;</span><span class="p">:</span>
                <span class="n">file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">3 </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Rrefl</span><span class="p">,</span> <span class="n">Grefl</span><span class="p">,</span> <span class="n">Brefl</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">5 </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Rrefl</span><span class="p">,</span> <span class="n">Grefl</span><span class="p">,</span> <span class="n">Brefl</span><span class="p">,</span> <span class="n">specularity</span><span class="p">,</span> <span class="n">roughness</span><span class="p">))</span>
            <span class="n">file_object</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added material </span><span class="si">{}</span><span class="s1"> to file </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="n">material_file</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">found</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rewrite</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Material already exists</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="RadianceObj.exportTrackerDict"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.exportTrackerDict.html#bifacial_radiance.RadianceObj.exportTrackerDict">[docs]</a>    <span class="k">def</span> <span class="nf">exportTrackerDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trackerdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use :py:func:`~bifacial_radiance.load._exportTrackerDict` to save a</span>
<span class="sd">        TrackerDict output as a csv file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            trackerdict</span>
<span class="sd">                The tracker dictionary to save</span>
<span class="sd">            savefile : str </span>
<span class="sd">                path to .csv save file location</span>
<span class="sd">            reindex : bool</span>
<span class="sd">                True saves the trackerdict in TMY format, including rows for hours</span>
<span class="sd">                where there is no sun/irradiance results (empty)</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">bifacial_radiance.load</span>

        <span class="k">if</span> <span class="n">trackerdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span>

        <span class="k">if</span> <span class="n">savefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">savefile</span> <span class="o">=</span> <span class="n">_interactive_load</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Select a .csv file to save to&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># don&#39;t re-index for cumulativesky,</span>
                <span class="c1"># which has angles for index</span>
                <span class="n">reindex</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reindex</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">reindex</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># don&#39;t re-index for cumulativesky,</span>
            <span class="c1"># which has angles for index</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Warning: For cumulativesky simulations, exporting the &quot;</span>
                   <span class="s2">&quot;TrackerDict requires reindex = False. Setting reindex = &quot;</span>
                   <span class="s2">&quot;False and proceeding&quot;</span><span class="p">)</span>
            <span class="n">reindex</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">bifacial_radiance</span><span class="o">.</span><span class="n">load</span><span class="o">.</span><span class="n">_exportTrackerDict</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">,</span>
                                                 <span class="n">savefile</span><span class="p">,</span>
                                                 <span class="n">reindex</span><span class="p">)</span></div>


<div class="viewcode-block" id="RadianceObj.loadtrackerdict"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.loadtrackerdict.html#bifacial_radiance.RadianceObj.loadtrackerdict">[docs]</a>    <span class="k">def</span> <span class="nf">loadtrackerdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trackerdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use :py:class:`bifacial_radiance.load._loadtrackerdict` </span>
<span class="sd">        to browse the results directory and load back any results saved in there.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trackerdict</span>
<span class="sd">        fileprefix : str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">bifacial_radiance.load</span> <span class="kn">import</span> <span class="n">loadTrackerDict</span>
        <span class="k">if</span> <span class="n">trackerdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span>
        <span class="p">(</span><span class="n">trackerdict</span><span class="p">,</span> <span class="n">totaldict</span><span class="p">)</span> <span class="o">=</span> <span class="n">loadTrackerDict</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">,</span> <span class="n">fileprefix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span> <span class="o">=</span> <span class="n">totaldict</span><span class="p">[</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span> <span class="o">=</span> <span class="n">totaldict</span><span class="p">[</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RadianceObj.returnOctFiles"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.returnOctFiles.html#bifacial_radiance.RadianceObj.returnOctFiles">[docs]</a>    <span class="k">def</span> <span class="nf">returnOctFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return files in the root directory with `.oct` extension</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        oct_files : list</span>
<span class="sd">            List of .oct files</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oct_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.oct&#39;</span><span class="p">)]</span>
        <span class="c1">#self.oct_files = oct_files</span>
        <span class="k">return</span> <span class="n">oct_files</span></div>

<div class="viewcode-block" id="RadianceObj.returnMaterialFiles"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.returnMaterialFiles.html#bifacial_radiance.RadianceObj.returnMaterialFiles">[docs]</a>    <span class="k">def</span> <span class="nf">returnMaterialFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return files in the Materials directory with .rad extension</span>
<span class="sd">        appends materials files to the oconv file list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        material_path : str</span>
<span class="sd">            Optional parameter to point to a specific materials directory.</span>
<span class="sd">            otherwise /materials/ is default</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        material_files : list</span>
<span class="sd">            List of .rad files</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">material_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">material_path</span> <span class="o">=</span> <span class="s1">&#39;materials&#39;</span>

        <span class="n">material_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                             <span class="n">material_path</span><span class="p">))</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.rad&#39;</span><span class="p">)]</span>

        <span class="n">materialfilelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">material_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">material_files</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialfiles</span> <span class="o">=</span> <span class="n">materialfilelist</span>
        <span class="k">return</span> <span class="n">materialfilelist</span></div>

<div class="viewcode-block" id="RadianceObj.setGround"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.setGround.html#bifacial_radiance.RadianceObj.setGround">[docs]</a>    <span class="k">def</span> <span class="nf">setGround</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">material_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Use GroundObj constructor class and return a ground object</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        material : numeric or str</span>
<span class="sd">            If number between 0 and 1 is passed, albedo input is assumed and assigned.    </span>
<span class="sd">            If string is passed with the name of the material desired. e.g. &#39;litesoil&#39;,</span>
<span class="sd">            properties are searched in `material_file`.</span>
<span class="sd">            Default Material names to choose from: litesoil, concrete, white_EPDM, </span>
<span class="sd">            beigeroof, beigeroof_lite, beigeroof_heavy, black, asphalt</span>
<span class="sd">        material_file : str</span>
<span class="sd">            Filename of the material information. Default `ground.rad`</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self.ground : tuple</span>
<span class="sd">            self.ground.normval : numeric</span>
<span class="sd">            Normalized color value</span>
<span class="sd">            self.ground.ReflAvg : numeric</span>
<span class="sd">            Average reflectance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span><span class="o">.</span><span class="n">albedo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span><span class="o">.</span><span class="n">albedo</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Assigned Albedo from metdata.albedo&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">ground</span> <span class="o">=</span> <span class="n">GroundObj</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="n">material_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="RadianceObj.getEPW"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.getEPW.html#bifacial_radiance.RadianceObj.getEPW">[docs]</a>    <span class="k">def</span> <span class="nf">getEPW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">GetAll</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subroutine to download nearest epw files to latitude and longitude provided,</span>
<span class="sd">        into the directory \EPWs\</span>
<span class="sd">        based on github/aahoo.</span>
<span class="sd">        </span>
<span class="sd">        .. warning::</span>
<span class="sd">            verify=false is required to operate within NREL&#39;s network.</span>
<span class="sd">            to avoid annoying warnings, insecurerequestwarning is disabled</span>
<span class="sd">            currently this function is not working within NREL&#39;s network.  annoying!</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lat : decimal </span>
<span class="sd">            Used to find closest EPW file.</span>
<span class="sd">        lon : decimal </span>
<span class="sd">            Longitude value to find closest EPW file.</span>
<span class="sd">        GetAll : boolean </span>
<span class="sd">            Download all available files. Note that no epw file will be loaded into memory</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">re</span>
        <span class="kn">from</span> <span class="nn">requests.packages.urllib3.exceptions</span> <span class="kn">import</span> <span class="n">InsecureRequestWarning</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span> <span class="p">:</span> <span class="s2">&quot;Magic Browser&quot;</span><span class="p">,</span>
               <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#39;</span>
               <span class="p">}</span>

        <span class="n">path_to_save</span> <span class="o">=</span> <span class="s1">&#39;EPWs&#39;</span> <span class="c1"># create a directory and write the name of directory here</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_returnEPWnames</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; return a dataframe with the name, lat, lon, url of available files&#39;&#39;&#39;</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://github.com/NREL/EnergyPlus/raw/develop/weather/master.geojson&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c1">#metadata for available files</span>
            <span class="c1">#download lat/lon and url details for each .epw file into a dataframe</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;url&#39;</span><span class="p">:[],</span> <span class="s1">&#39;lat&#39;</span><span class="p">:[],</span> <span class="s1">&#39;lon&#39;</span><span class="p">:[],</span> <span class="s1">&#39;name&#39;</span><span class="p">:[]})</span>
            <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;href=[</span><span class="se">\&#39;</span><span class="s1">&quot;]?([^</span><span class="se">\&#39;</span><span class="s1">&quot; &gt;]+)&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;epw&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="n">url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="n">lontemp</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lattemp</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dftemp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;url&#39;</span><span class="p">:[</span><span class="n">url</span><span class="p">],</span> <span class="s1">&#39;lat&#39;</span><span class="p">:[</span><span class="n">lattemp</span><span class="p">],</span> <span class="s1">&#39;lon&#39;</span><span class="p">:[</span><span class="n">lontemp</span><span class="p">],</span> <span class="s1">&#39;name&#39;</span><span class="p">:[</span><span class="n">name</span><span class="p">]})</span>
                    <span class="c1">#df = df.append(dftemp, ignore_index=True)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">dftemp</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">def</span> <span class="nf">_findClosestEPW</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="c1">#locate the record with the nearest lat/lon</span>
            <span class="n">errorvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="n">lon</span><span class="p">))</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">errorvec</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">name</span>

        <span class="k">def</span> <span class="nf">_downloadEPWfile</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">hdr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="c1"># py2 and 3 compatible: binary write, encode text first</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; ... OK!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; connection error status code: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span>
                <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Get the list of EPW filenames and lat/lon</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">_returnEPWnames</span><span class="p">()</span>

        <span class="c1"># find the closest EPW file to the given lat/lon</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">GetAll</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_findClosestEPW</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

            <span class="c1"># download the EPW file to the local drive.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting weather file: &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">_downloadEPWfile</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epwfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;EPWs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">GetAll</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Downloading ALL EPW files available. OK? [y/n]&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="c1"># get all of the EPW files</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting weather file: &#39;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">_downloadEPWfile</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">path_to_save</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epwfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nothing returned. Proper usage: epwfile = getEPW(lat,lon)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epwfile</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwfile</span></div>
      
        
<div class="viewcode-block" id="RadianceObj.readWeatherFile"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.readWeatherFile.html#bifacial_radiance.RadianceObj.readWeatherFile">[docs]</a>    <span class="k">def</span> <span class="nf">readWeatherFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weatherFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                        <span class="n">endtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">coerce_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tz_convert_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read either a EPW or a TMY file, calls the functions </span>
<span class="sd">        :py:class:`~bifacial_radiance.readTMY` or</span>
<span class="sd">        :py:class:`~bifacial_radiance.readEPW` </span>
<span class="sd">        according to the weatherfile extention.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weatherFile : str</span>
<span class="sd">            File containing the weather information. EPW, TMY or solargis accepted.</span>
<span class="sd">        starttime : str</span>
<span class="sd">            Limited start time option in &#39;YYYY-mm-dd_HHMM&#39; or &#39;mm_dd_HH&#39; format</span>
<span class="sd">        endtime : str</span>
<span class="sd">            Limited end time option in &#39;YYYY-mm-dd_HHMM&#39; or &#39;mm_dd_HH&#39; format</span>
<span class="sd">        daydate : str  DEPRECATED</span>
<span class="sd">            For single day in &#39;MM/DD&#39; or MM_DD format.  Now use starttime and </span>
<span class="sd">            endtime set to the same date.</span>
<span class="sd">        label : str</span>
<span class="sd">            &#39;left&#39;, &#39;right&#39;, or &#39;center&#39;. For data that is averaged, defines if</span>
<span class="sd">            the timestamp refers to the left edge, the right edge, or the </span>
<span class="sd">            center of the averaging interval, for purposes of calculating </span>
<span class="sd">            sunposition. For example, TMY3 data is right-labeled, so 11 AM data </span>
<span class="sd">            represents data from 10 to 11, and sun position is calculated </span>
<span class="sd">            at 10:30 AM.  Currently SAM and PVSyst use left-labeled interval </span>
<span class="sd">            data and NSRDB uses centered.</span>
<span class="sd">        source : str</span>
<span class="sd">            To help identify different types of .csv files. If None, it assumes</span>
<span class="sd">            it is a TMY3-style formated data. Current options: &#39;TMY3&#39;, </span>
<span class="sd">            &#39;solargis&#39;, &#39;EPW&#39;</span>
<span class="sd">        coerce_year : int</span>
<span class="sd">            Year to coerce weather data to in YYYY format, ie 2021. </span>
<span class="sd">            If more than one year of data in the  weather file, year is NOT coerced.</span>
<span class="sd">        tz_convert_val : int </span>
<span class="sd">            Convert timezone to this fixed value, following ISO standard </span>
<span class="sd">            (negative values indicating West of UTC.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#from datetime import datetime</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        
        <span class="k">if</span> <span class="n">weatherFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;epwfile&#39;</span><span class="p">):</span>
                <span class="n">weatherFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwfile</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">weatherFile</span> <span class="o">=</span> <span class="n">_interactive_load</span><span class="p">(</span><span class="s1">&#39;Select EPW or TMY3 climate file&#39;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Interactive load failed. Tkinter not supported&#39;</span><span class="o">+</span>
                                    <span class="s1">&#39;on this system. Try installing X-Quartz and reloading&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coerce_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coerce_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">coerce_year</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">coerce_year</span><span class="p">)</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Incorrect coerce_year. Setting to None&#39;</span><span class="p">)</span>
                <span class="n">coerce_year</span> <span class="o">=</span> <span class="kc">None</span>
                
        
        <span class="k">def</span> <span class="nf">_parseTimes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">coerce_year</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            parse time input t which could be string mm_dd_HH or YYYY-mm-dd_HHMM</span>
<span class="sd">            or datetime.datetime object.  Return pd.datetime object.  Define</span>
<span class="sd">            hour as hour input if not passed directly.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="kn">import</span> <span class="nn">re</span>
            
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tsplit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-|_| &#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    
                    <span class="c1">#mm_dd format</span>
                    <span class="k">if</span> <span class="n">tsplit</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> 
                        <span class="k">if</span> <span class="n">coerce_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">coerce_year</span> <span class="o">=</span> <span class="mi">2021</span> <span class="c1">#default year. </span>
                        <span class="n">tsplit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">coerce_year</span><span class="p">))</span>
                        <span class="n">tsplit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;00&#39;</span><span class="p">)</span>
                        
                    <span class="c1">#mm_dd_hh or YYYY_mm_dd format</span>
                    <span class="k">elif</span> <span class="n">tsplit</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="n">tsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">coerce_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">coerce_year</span> <span class="o">=</span> <span class="mi">2021</span> <span class="c1">#default year. </span>
                            <span class="n">tsplit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">coerce_year</span><span class="p">))</span>
                        <span class="k">elif</span> <span class="n">tsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">tsplit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;00&#39;</span><span class="p">)</span>
                            
                    <span class="c1">#YYYY-mm-dd_HHMM  format</span>
                    <span class="k">if</span> <span class="n">tsplit</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">tsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">t_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tsplit</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="p">)</span> 
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;incorrect time string passed </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">.&#39;</span>
                                        <span class="s1">&#39;Valid options: mm_dd, mm_dd_HH, &#39;</span>
                                        <span class="s1">&#39;mm_dd_HHMM, YYYY-mm-dd_HHMM&#39;</span><span class="p">)</span>  
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Error for incorrect string passed:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1">#datetime or timestamp</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">t_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ParserError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;incorrect time object passed.  Valid options: &#39;</span>
                          <span class="s1">&#39;string or datetime.datetime or pd.timeIndex. You &#39;</span>
                          <span class="sa">f</span><span class="s1">&#39;passed </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t_out</span><span class="p">,</span> <span class="n">coerce_year</span>
        <span class="c1"># end _parseTimes</span>
        
        <span class="k">def</span> <span class="nf">_tz_convert</span><span class="p">(</span><span class="n">metdata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">tz_convert_val</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            convert metdata to a different local timzone.  Particularly for </span>
<span class="sd">            SolarGIS weather files which are returned in UTC by default.</span>
<span class="sd">            ----------</span>
<span class="sd">            tz_convert_val : int</span>
<span class="sd">                Convert timezone to this fixed value, following ISO standard </span>
<span class="sd">                (negative values indicating West of UTC.)</span>
<span class="sd">            Returns: metdata, metadata  </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="kn">import</span> <span class="nn">pytz</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tz_convert_val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tz_convert_val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;TZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tz_convert_val</span>
                <span class="n">metdata</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">FixedOffset</span><span class="p">(</span><span class="n">tz_convert_val</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">metdata</span><span class="p">,</span> <span class="n">metadata</span>
        <span class="c1"># end _tz_convert</span>

        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    
            <span class="k">if</span> <span class="n">weatherFile</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;epw&#39;</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;EPW&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: CSV file passed for input. Assuming it is TMY3&#39;</span><span class="o">+</span>
                      <span class="s1">&#39;style format&#39;</span><span class="p">)</span> 
                <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;TMY3&#39;</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span> <span class="c1"># EPW and TMY are by deffault right-labeled.</span>

        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;solargis&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
            <span class="n">metdata</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readSOLARGIS</span><span class="p">(</span><span class="n">weatherFile</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;epw&#39;</span><span class="p">:</span>
            <span class="n">metdata</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readEPW</span><span class="p">(</span><span class="n">weatherFile</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;tmy3&#39;</span><span class="p">:</span>
            <span class="n">metdata</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readTMY</span><span class="p">(</span><span class="n">weatherFile</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        
        <span class="n">metdata</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">_tz_convert</span><span class="p">(</span><span class="n">metdata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">tz_convert_val</span><span class="p">)</span>
        <span class="n">tzinfo</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tzinfo</span>
        <span class="n">tempMetDatatitle</span> <span class="o">=</span> <span class="s1">&#39;metdata_temp.csv&#39;</span>

        <span class="c1"># Parse the start and endtime strings. </span>
        <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">starttime</span><span class="p">,</span> <span class="n">coerce_year</span> <span class="o">=</span> <span class="n">_parseTimes</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">coerce_year</span><span class="p">)</span>
            <span class="n">starttime</span> <span class="o">=</span> <span class="n">starttime</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tzinfo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">endtime</span><span class="p">,</span> <span class="n">coerce_year</span> <span class="o">=</span> <span class="n">_parseTimes</span><span class="p">(</span><span class="n">endtime</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="n">coerce_year</span><span class="p">)</span>
            <span class="n">endtime</span> <span class="o">=</span> <span class="n">endtime</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tzinfo</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        #TODO: do we really need this check?</span>
<span class="sd">        if coerce_year is not None and starttime is not None:</span>
<span class="sd">            if coerce_year != starttime.year or coerce_year != endtime.year:</span>
<span class="sd">                print(&quot;Warning: Coerce year does not match requested sampled &quot;+</span>
<span class="sd">                      &quot;date(s)&#39;s years. Setting Coerce year to None.&quot;)</span>
<span class="sd">                coerce_year = None</span>
<span class="sd">        &#39;&#39;&#39;</span>        

        <span class="n">tmydata_trunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveTempTMY</span><span class="p">(</span><span class="n">metdata</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">tempMetDatatitle</span><span class="p">,</span> 
                                          <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="n">endtime</span><span class="p">,</span> 
                                          <span class="n">coerce_year</span><span class="o">=</span><span class="n">coerce_year</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tmydata_trunc</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span> <span class="o">=</span> <span class="n">MetObj</span><span class="p">(</span><span class="n">tmydata_trunc</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Weather file returned zero points for the &#39;</span>
                  <span class="s1">&#39;starttime / endtime  provided&#39;</span><span class="p">)</span>
        
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span></div>

    <span class="k">def</span> <span class="nf">_saveTempTMY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmydata</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">coerce_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        private function to save part or all of tmydata into /EPWs/ for use </span>
<span class="sd">        in gencumsky -G mode and return truncated  tmydata. Gencumsky 8760</span>
<span class="sd">        starts with Jan 1, 1AM and ends Dec 31, 2400</span>
<span class="sd">        </span>
<span class="sd">        starttime:  tz-localized pd.TimeIndex</span>
<span class="sd">        endtime:    tz-localized pd.TimeIndex</span>
<span class="sd">        </span>
<span class="sd">        returns: tmydata_truncated  : subset of tmydata based on start &amp; end</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;temp.csv&#39;</span>
                        
        <span class="n">gencumskydata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">gencumdict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmydata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8760</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;8760 line in WeatherFile. Assuming this is a standard hourly&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; WeatherFile for the year for purposes of saving Gencumulativesky&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; temporary weather files in EPW folder.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">coerce_year</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">coerce_year</span> <span class="o">=</span> <span class="n">starttime</span><span class="o">.</span><span class="n">year</span>

            <span class="k">elif</span> <span class="n">coerce_year</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">coerce_year</span> <span class="o">=</span> <span class="mi">2021</span>                
            
            <span class="k">if</span> <span class="n">coerce_year</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coercing year to </span><span class="si">{</span><span class="n">coerce_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">tz</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz</span>
                <span class="n">year_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tmydata</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">coerce_year</span><span class="p">)</span>
                <span class="n">year_vector</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">coerce_year</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">({</span>
                                    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year_vector</span><span class="p">,</span>
                                    <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                    <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                    <span class="s1">&#39;hour&#39;</span><span class="p">:</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">})</span>
                
                <span class="n">tmydata</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>



            <span class="c1"># FilterDates</span>
            <span class="n">filterdates</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">starttime</span>
                <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">starttime</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">endtime</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">starttime</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">endtime</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">filterdates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering dates&quot;</span><span class="p">)</span>
                <span class="n">tmydata</span><span class="p">[</span><span class="o">~</span><span class="n">filterdates</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
            <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coerce_year</span><span class="p">:</span>
                    <span class="c1"># TODO: check why subhourly data still has 0 entries on the next day on _readTMY3</span>
                    <span class="c1"># in the meantime, let&#39;s make Silvana&#39;s life easy by just deletig 0 entries</span>
                    <span class="n">tmydata</span> <span class="o">=</span> <span class="n">tmydata</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> 
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coercing year to </span><span class="si">{</span><span class="n">coerce_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># TODO: this coercing shows a python warning. Turn it off or find another method? bleh.</span>
                    <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="p">[:]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="p">(</span><span class="n">coerce_year</span><span class="p">))</span>
        
                <span class="c1"># FilterDates</span>
                <span class="n">filterdates</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">starttime</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">endtime</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">starttime</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">endtime</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">filterdates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering dates&quot;</span><span class="p">)</span>
                    <span class="n">tmydata</span><span class="p">[</span><span class="o">~</span><span class="n">filterdates</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
                <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">_subhourlydatatoGencumskyformat</span><span class="p">(</span><span class="n">gencumskydata</span><span class="p">,</span> 
                                                                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coerce_year</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;More than 1 year of data identified. Can&#39;t do coercing&quot;</span><span class="p">)</span>
                
                <span class="c1"># Check if years are consecutive</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Years are not consecutive. Won&#39;t be able to use Gencumsky&quot;</span><span class="o">+</span>
                          <span class="s2">&quot; because who knows what&#39;s going on with this data.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Years are consecutive. For Gencumsky, make sure to select&quot;</span><span class="o">+</span>
                          <span class="s2">&quot; which yearly temporary weather file you want to use&quot;</span><span class="o">+</span>
                          <span class="s2">&quot; else they will all get accumulated to same hour/day&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># FilterDates</span>
                    <span class="n">filterdates</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">starttime</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">endtime</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">starttime</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">filterdates</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">endtime</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">filterdates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering dates&quot;</span><span class="p">)</span>
                        <span class="n">tmydata</span> <span class="o">=</span> <span class="n">tmydata</span><span class="p">[</span><span class="n">filterdates</span><span class="p">]</span> <span class="c1"># Reducing years potentially</span>
        
                    <span class="c1"># Checking if filtering reduced to just 1 year to do usual savin.</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">_subhourlydatatoGencumskyformat</span><span class="p">(</span><span class="n">gencumskydata</span><span class="p">,</span>
                                                                        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gencumdict</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">))]</span>
                        
                        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gencumdict</span><span class="p">)):</span>
                            <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">gencumdict</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                            <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">_subhourlydatatoGencumskyformat</span><span class="p">(</span><span class="n">gencumskydata</span><span class="p">,</span>
                                                                            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
                            <span class="n">gencumdict</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">gencumskydata</span>
                        
                        <span class="n">gencumskydata</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># clearing so that the dictionary style can be activated.</span>
        
        
        <span class="c1"># Let&#39;s save files in EPWs folder for Gencumsky     </span>
        <span class="k">if</span> <span class="n">gencumskydata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">csvfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;EPWs&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving file </span><span class="si">{}</span><span class="s1">, # points: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>
            <span class="n">gencumskydata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GHI&#39;</span><span class="p">,</span><span class="s1">&#39;DHI&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gencumsky_metfile</span> <span class="o">=</span> <span class="n">csvfile</span>
        
        <span class="k">if</span> <span class="n">gencumdict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gencumsky_metfile</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gencumdict</span><span class="p">)):</span>
                <span class="n">gencumskydata</span> <span class="o">=</span> <span class="n">gencumdict</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">newfilename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_year_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span>
                <span class="n">csvfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;EPWs&#39;</span><span class="p">,</span> <span class="n">newfilename</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving file </span><span class="si">{}</span><span class="s1">, # points: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">gencumskydata</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>
                <span class="n">gencumskydata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GHI&#39;</span><span class="p">,</span><span class="s1">&#39;DHI&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gencumsky_metfile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tmydata</span>

        
    <span class="k">def</span> <span class="nf">_readTMY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmyfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">coerce_year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        use pvlib to read in a tmy3 file.</span>
<span class="sd">        Note: pvlib 0.7 does not currently support sub-hourly files. Until</span>
<span class="sd">        then, use _readTMYdate() to create the index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        tmyfile : str</span>
<span class="sd">            Filename of tmy3 to be read with pvlib.tmy.readtmy3</span>
<span class="sd">        label : str</span>
<span class="sd">            &#39;left&#39;, &#39;right&#39;, or &#39;center&#39;. For data that is averaged, defines if</span>
<span class="sd">            the timestamp refers to the left edge, the right edge, or the </span>
<span class="sd">            center of the averaging interval, for purposes of calculating </span>
<span class="sd">            sunposition. For example, TMY3 data is right-labeled, so 11 AM data </span>
<span class="sd">            represents data from 10 to 11, and sun position is calculated </span>
<span class="sd">            at 10:30 AM.  Currently SAM and PVSyst use left-labeled interval </span>
<span class="sd">            data and NSRDB uses centered.</span>
<span class="sd">        coerce_year : int</span>
<span class="sd">            Year to coerce to. Default is 2021. </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        metdata - MetObj collected from TMY3 file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">_convertTMYdate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; requires pvlib 0.8, updated to handle subhourly timestamps &#39;&#39;&#39;</span>
            <span class="c1"># get the date column as a pd.Series of numpy datetime64</span>
            <span class="n">data_ymd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date (MM/DD/YYYY)&#39;</span><span class="p">])</span>
            <span class="c1"># shift the time column so that midnite is 00:00 instead of 24:00</span>
            <span class="n">shifted_hour</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time (HH:MM)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">%</span> <span class="mi">24</span>
            <span class="n">minute</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time (HH:MM)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> 
            <span class="c1"># shift the dates at midnite so they correspond to the next day</span>
            <span class="n">data_ymd</span><span class="p">[</span><span class="n">shifted_hour</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># NOTE: as of pandas&gt;=0.24 the pd.Series.array has a month attribute, but</span>
            <span class="c1"># in pandas-0.18.1, only DatetimeIndex has month, but indices are immutable</span>
            <span class="c1"># so we need to continue to work with the panda series of dates `data_ymd`</span>
            <span class="n">data_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">data_ymd</span><span class="p">)</span>
            <span class="c1"># use indices to check for a leap day and advance it to March 1st</span>
            <span class="n">leapday</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_index</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)</span>
            <span class="n">data_ymd</span><span class="p">[</span><span class="n">leapday</span><span class="p">]</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># shifted_hour is a pd.Series, so use pd.to_timedelta to get a pd.Series of</span>
            <span class="c1"># timedeltas</span>
            <span class="c1"># NOTE: as of pvlib-0.6.3, min req is pandas-0.18.1, so pd.to_timedelta</span>
            <span class="c1"># unit must be in (D,h,m,s,ms,us,ns), but pandas&gt;=0.24 allows unit=&#39;hour&#39;</span>
            <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_ymd</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">shifted_hour</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span> <span class="o">+</span>
                         <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">minute</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span> <span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;TZ&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">))</span>
            
            <span class="k">return</span> <span class="n">data</span>
        
        
        <span class="kn">import</span> <span class="nn">pvlib</span>
        <span class="c1">#(tmydata, metadata) = pvlib.tmy.readtmy3(filename=tmyfile) #pvlib&lt;=0.6</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">tmydata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">iotools</span><span class="o">.</span><span class="n">tmy</span><span class="o">.</span><span class="n">read_tmy3</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tmyfile</span><span class="p">,</span>
                                                          <span class="n">coerce_year</span><span class="o">=</span><span class="n">coerce_year</span><span class="p">,</span>
                                                          <span class="n">map_variables</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># pvlib &lt; 0.10</span>
            <span class="p">(</span><span class="n">tmydata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">iotools</span><span class="o">.</span><span class="n">tmy</span><span class="o">.</span><span class="n">read_tmy3</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tmyfile</span><span class="p">,</span>
                                                          <span class="n">coerce_year</span><span class="o">=</span><span class="n">coerce_year</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmydata</span> <span class="o">=</span> <span class="n">_convertTMYdate</span><span class="p">(</span><span class="n">tmydata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span> 
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PVLib &gt;= 0.8.0 is required for sub-hourly data input&#39;</span><span class="p">)</span>
        
        <span class="n">tmydata</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dni&#39;</span><span class="p">:</span><span class="s1">&#39;DNI&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;dhi&#39;</span><span class="p">:</span><span class="s1">&#39;DHI&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;temp_air&#39;</span><span class="p">:</span><span class="s1">&#39;DryBulb&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;wind_speed&#39;</span><span class="p">:</span><span class="s1">&#39;Wspd&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;ghi&#39;</span><span class="p">:</span><span class="s1">&#39;GHI&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;albedo&#39;</span><span class="p">:</span><span class="s1">&#39;Alb&#39;</span>
                                <span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1">#as of v0.11, PVLib changed tmy3 column names..</span>

        <span class="k">return</span> <span class="n">tmydata</span><span class="p">,</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">_readEPW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epwfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">coerce_year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses readepw from pvlib&gt;0.6.1 but un-do -1hr offset and</span>
<span class="sd">        rename columns to match TMY3: DNI, DHI, GHI, DryBulb, Wspd</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        epwfile : str</span>
<span class="sd">            Direction and filename of the epwfile. If None, opens an interactive</span>
<span class="sd">            loading window.</span>
<span class="sd">        label : str</span>
<span class="sd">            &#39;left&#39;, &#39;right&#39;, or &#39;center&#39;. For data that is averaged, defines if</span>
<span class="sd">            the timestamp refers to the left edge, the right edge, or the </span>
<span class="sd">            center of the averaging interval, for purposes of calculating </span>
<span class="sd">            sunposition. For example, TMY3 data is right-labeled, so 11 AM data </span>
<span class="sd">            represents data from 10 to 11, and sun position is calculated </span>
<span class="sd">            at 10:30 AM.  Currently SAM and PVSyst use left-labeled interval </span>
<span class="sd">            data and NSRDB uses centered.</span>
<span class="sd">        coerce_year : int</span>
<span class="sd">            Year to coerce data to.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">pvlib</span>
        <span class="c1">#import re</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        NOTE: In PVLib &gt; 0.6.1 the new epw.read_epw() function reads in time </span>
<span class="sd">        with a default -1 hour offset.  This is reflected in our existing</span>
<span class="sd">        workflow. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#(tmydata, metadata) = readepw(epwfile) #</span>
        <span class="p">(</span><span class="n">tmydata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">iotools</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">read_epw</span><span class="p">(</span><span class="n">epwfile</span><span class="p">,</span> 
                                                         <span class="n">coerce_year</span><span class="o">=</span><span class="n">coerce_year</span><span class="p">)</span> <span class="c1">#pvlib&gt;0.6.1</span>
        <span class="c1">#pvlib uses -1hr offset that needs to be un-done. </span>
        <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

        <span class="c1"># rename different field parameters to match output from </span>
        <span class="c1"># pvlib.tmy.readtmy: DNI, DHI, DryBulb, Wspd</span>
        <span class="n">tmydata</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dni&#39;</span><span class="p">:</span><span class="s1">&#39;DNI&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;dhi&#39;</span><span class="p">:</span><span class="s1">&#39;DHI&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;temp_air&#39;</span><span class="p">:</span><span class="s1">&#39;DryBulb&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;wind_speed&#39;</span><span class="p">:</span><span class="s1">&#39;Wspd&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;ghi&#39;</span><span class="p">:</span><span class="s1">&#39;GHI&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;albedo&#39;</span><span class="p">:</span><span class="s1">&#39;Alb&#39;</span>
                                <span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    

        <span class="k">return</span> <span class="n">tmydata</span><span class="p">,</span> <span class="n">metadata</span>


    <span class="k">def</span> <span class="nf">_readSOLARGIS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read solarGIS data file which is timestamped in UTC.</span>
<span class="sd">        rename columns to match TMY3: DNI, DHI, GHI, DryBulb, Wspd</span>
<span class="sd">        Timezone is always returned as UTC. Use tz_convert in readWeatherFile</span>
<span class="sd">        to manually convert to local time</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        filename : str</span>
<span class="sd">            filename of the solarGIS file. </span>
<span class="sd">        label : str</span>
<span class="sd">            &#39;left&#39;, &#39;right&#39;, or &#39;center&#39;. For data that is averaged, defines if</span>
<span class="sd">            the timestamp refers to the left edge, the right edge, or the </span>
<span class="sd">            center of the averaging interval. SolarGis default style is center,</span>
<span class="sd">            unless user requests a right label. </span>
<span class="sd">       </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># file format: anything with # preceding is in the header</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">lat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">lon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">elev</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#Latitude:&#39;</span><span class="p">):</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#Longitude:&#39;</span><span class="p">):</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#Elevation:&#39;</span><span class="p">):</span>
                        <span class="n">elev</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#Site name:&#39;</span><span class="p">):</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span>
                    <span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span>
                    <span class="s1">&#39;altitude&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">elev</span><span class="p">),</span>
                    <span class="s1">&#39;Name&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;TZ&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
        <span class="c1"># read in remainder of data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="n">header</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

        <span class="c1"># rename different field parameters to match output from </span>
        <span class="c1"># pvlib.tmy.readtmy: DNI, DHI, DryBulb, Wspd</span>
        <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;DIF&#39;</span><span class="p">:</span><span class="s1">&#39;DHI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;TEMP&#39;</span><span class="p">:</span><span class="s1">&#39;DryBulb&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;WS&#39;</span><span class="p">:</span><span class="s1">&#39;Wspd&#39;</span><span class="p">,</span>
                             <span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    

        <span class="c1"># Generate index from Date (DD.HH.YYYY) and Time</span>
        <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Date</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>  <span class="n">data</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> 
                                    <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">infer_datetime_format</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span>


<div class="viewcode-block" id="RadianceObj.getSingleTimestampTrackerAngle"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.getSingleTimestampTrackerAngle.html#bifacial_radiance.RadianceObj.getSingleTimestampTrackerAngle">[docs]</a>    <span class="k">def</span> <span class="nf">getSingleTimestampTrackerAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metdata</span><span class="p">,</span> <span class="n">timeindex</span><span class="p">,</span> <span class="n">gcr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                       <span class="n">azimuth</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">axis_tilt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                       <span class="n">limit_angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">backtrack</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to calculate a tracker&#39;s angle for use with the </span>
<span class="sd">        fixed tilt routines of bifacial_radiance. It calculates tracker angle for</span>
<span class="sd">        sun position at the timeindex passed (no left or right time offset, </span>
<span class="sd">        label = &#39;center&#39;)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        metdata : :py:class:`~bifacial_radiance.MetObj` </span>
<span class="sd">            Meterological object to set up geometry. Usually set automatically by</span>
<span class="sd">            `bifacial_radiance` after running :py:class:`bifacial_radiance.readepw`. </span>
<span class="sd">            Default = self.metdata</span>
<span class="sd">        timeindex : int</span>
<span class="sd">            Index between 0 to 8760 indicating hour to simulate.</span>
<span class="sd">        gcr : float</span>
<span class="sd">            Ground coverage ratio for calculation backtracking. Defualt [1.0/3.0] </span>
<span class="sd">        azimuth : float or int</span>
<span class="sd">            Orientation axis of tracker torque tube. Default North-South (180 deg)</span>
<span class="sd">        axis_tilt : float or int</span>
<span class="sd">            Default 0. Axis tilt -- not implemented in sensors locations so it&#39;s pointless</span>
<span class="sd">            at this release to change it.</span>
<span class="sd">        limit_angle : float or int</span>
<span class="sd">            Limit angle (+/-) of the 1-axis tracker in degrees. Default 45</span>
<span class="sd">        backtrack : boolean</span>
<span class="sd">            Whether backtracking is enabled (default = True)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        elev = metdata.elevation</span>
<span class="sd">        lat = metdata.latitude</span>
<span class="sd">        lon = metdata.longitude</span>
<span class="sd">        timestamp = metdata.datetime[timeindex]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="kn">import</span> <span class="nn">pvlib</span>
                
        <span class="n">solpos</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">solpos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">timeindex</span><span class="p">]</span>
        <span class="n">sunzen</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">solpos</span><span class="o">.</span><span class="n">apparent_zenith</span><span class="p">)</span>
        <span class="n">sunaz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">solpos</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span> <span class="c1"># not substracting the 180 </span>
        
        <span class="n">trackingdata</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">tracking</span><span class="o">.</span><span class="n">singleaxis</span><span class="p">(</span><span class="n">sunzen</span><span class="p">,</span> <span class="n">sunaz</span><span class="p">,</span>
                                             <span class="n">axis_tilt</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span>
                                             <span class="n">limit_angle</span><span class="p">,</span> <span class="n">backtrack</span><span class="p">,</span> <span class="n">gcr</span><span class="p">)</span>
        
        <span class="n">tracker_theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;tracker_theta&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">tracker_theta</span> <span class="o">=</span> <span class="n">tracker_theta</span><span class="o">*-</span><span class="mi">1</span> <span class="c1"># bifacial_radiance uses East (morning) theta as positive</span>
            
        <span class="k">return</span> <span class="n">tracker_theta</span></div>


<div class="viewcode-block" id="RadianceObj.gendaylit"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.gendaylit.html#bifacial_radiance.RadianceObj.gendaylit">[docs]</a>    <span class="k">def</span> <span class="nf">gendaylit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeindex</span><span class="p">,</span> <span class="n">metdata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets and returns sky information using gendaylit.</span>
<span class="sd">        Uses PVLIB for calculating the sun position angles instead of</span>
<span class="sd">        using Radiance internal sun position calculation (for that use gendaylit function)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeindex : int</span>
<span class="sd">            Index from 0 to ~4000 of the MetObj (daylight hours only)</span>
<span class="sd">        metdata : ``MetObj``</span>
<span class="sd">            MetObj object with list of dni, dhi, ghi and location</span>
<span class="sd">        debug : bool</span>
<span class="sd">            Flag to print output of sky DHI and DNI</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        skyname : str</span>
<span class="sd">            Sets as a self.skyname and returns filename of sky in /skies/ directory. </span>
<span class="sd">            If errors exist, such as DNI = 0 or sun below horizon, this skyname is None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
 
        <span class="k">if</span> <span class="n">metdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;usage: pass metdata, or run after running &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;readWeatherfile() &#39;</span><span class="p">)</span> 
                <span class="k">return</span>

        <span class="n">ground</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground</span>
        
        <span class="n">locName</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">city</span>
        <span class="n">dni</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">dni</span><span class="p">[</span><span class="n">timeindex</span><span class="p">]</span>
        <span class="n">dhi</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">dhi</span><span class="p">[</span><span class="n">timeindex</span><span class="p">]</span>
        <span class="n">ghi</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">ghi</span><span class="p">[</span><span class="n">timeindex</span><span class="p">]</span>
        <span class="n">elev</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">elevation</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">latitude</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">longitude</span>

        <span class="c1"># Assign Albedos</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ground</span><span class="o">.</span><span class="n">ReflAvg</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">metdata</span><span class="o">.</span><span class="n">dni</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="n">groundindex</span> <span class="o">=</span> <span class="n">timeindex</span>  
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground</span><span class="o">.</span><span class="n">ReflAvg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># just 1 entry</span>
                <span class="n">groundindex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Shape of ground Albedos and TMY data do not match.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;usage: make sure to run setGround() before gendaylit()&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sky generated with Gendaylit, with DNI: </span><span class="si">%0.1f</span><span class="s1">, DHI: </span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="n">dhi</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datetime TimeIndex&quot;</span><span class="p">,</span> <span class="n">metdata</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">timeindex</span><span class="p">])</span>



        <span class="c1">#Time conversion to correct format and offset.</span>
        <span class="c1">#datetime = metdata.sunrisesetdata[&#39;corrected_timestamp&#39;][timeindex]</span>
        <span class="c1">#Don&#39;t need any of this any more. Already sunrise/sunset corrected and offset by appropriate interval</span>

        <span class="c1"># get solar position zenith and azimuth based on site metadata</span>
        <span class="c1">#solpos = pvlib.irradiance.solarposition.get_solarposition(datetimetz,lat,lon,elev)</span>
        <span class="n">solpos</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">solpos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">timeindex</span><span class="p">]</span>
        <span class="n">sunalt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">solpos</span><span class="o">.</span><span class="n">elevation</span><span class="p">)</span>
        <span class="c1"># Radiance expects azimuth South = 0, PVlib gives South = 180. Must substract 180 to match.</span>
        <span class="n">sunaz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">solpos</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span><span class="o">-</span><span class="mf">180.0</span>

        <span class="n">sky_path</span> <span class="o">=</span> <span class="s1">&#39;skies&#39;</span>

        <span class="k">if</span> <span class="n">dhi</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># We should already be filtering for elevation &gt;0. But just in case...</span>
        <span class="k">if</span> <span class="n">sunalt</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sunalt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">ghi</span><span class="o">-</span><span class="n">dhi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dni</span><span class="o">+</span><span class="mf">.001</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># reverse engineer elevation from ghi, dhi, dni</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: negative sun elevation at &#39;</span><span class="o">+</span>
                  <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.  &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">metdata</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">timeindex</span><span class="p">])</span><span class="o">+</span>
                  <span class="s1">&#39;Re-calculated elevation: </span><span class="si">{:0.2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sunalt</span><span class="p">))</span>

        <span class="c1"># Note - -W and -O1 option is used to create full spectrum analysis in units of Wm-2</span>
         <span class="c1">#&quot; -L %s %s -g %s \n&quot; %(dni/.0079, dhi/.0079, self.ground.ReflAvg) + \</span>
        <span class="n">skyStr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;# start of sky definition for daylighting studies</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;# location name: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">locName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; LAT: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="o">+</span><span class="s2">&quot; LON: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Elev: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;# Sun position calculated w. PVLib</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;!gendaylit -ang </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">sunalt</span><span class="p">,</span> <span class="n">sunaz</span><span class="p">))</span> <span class="o">+</span> \
            <span class="s2">&quot; -W </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> -g </span><span class="si">%s</span><span class="s2"> -O 1 </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="n">dhi</span><span class="p">,</span> <span class="n">ground</span><span class="o">.</span><span class="n">ReflAvg</span><span class="p">[</span><span class="n">groundindex</span><span class="p">])</span> <span class="o">+</span> \
            <span class="s2">&quot;skyfunc glow sky_mat</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">4 1 1 1 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">sky_mat source sky</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">4 0 0 1 180</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="n">ground</span><span class="o">.</span><span class="n">_makeGroundString</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">groundindex</span><span class="p">,</span> <span class="n">cumulativesky</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">timeindex</span><span class="p">]</span>
        <span class="c1">#filename = str(time)[2:-9].replace(&#39;-&#39;,&#39;_&#39;).replace(&#39; &#39;,&#39;_&#39;).replace(&#39;:&#39;,&#39;_&#39;)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H%M&#39;</span><span class="p">)</span>
        <span class="n">skyname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sky_path</span><span class="p">,</span><span class="s2">&quot;sky2_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">.rad&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

        <span class="n">skyFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">skyname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">skyFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">skyStr</span><span class="p">)</span>
        <span class="n">skyFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">skyname</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">skyname</span></div>

<div class="viewcode-block" id="RadianceObj.gendaylit2manual"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.gendaylit2manual.html#bifacial_radiance.RadianceObj.gendaylit2manual">[docs]</a>    <span class="k">def</span> <span class="nf">gendaylit2manual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dni</span><span class="p">,</span> <span class="n">dhi</span><span class="p">,</span> <span class="n">sunalt</span><span class="p">,</span> <span class="n">sunaz</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets and returns sky information using gendaylit.</span>
<span class="sd">        Uses user-provided data for sun position and irradiance.</span>
<span class="sd">        </span>
<span class="sd">        .. warning::</span>
<span class="sd">            This generates the sky at the sun altitude&amp;azimuth provided, make </span>
<span class="sd">            sure it is the right position relative to how the weather data got</span>
<span class="sd">            created and read (i.e. label right, left or center).</span>
<span class="sd">            </span>
<span class="sd">     </span>
<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        dni: int or float</span>
<span class="sd">           Direct Normal Irradiance (DNI) value, in W/m^2</span>
<span class="sd">        dhi : int or float</span>
<span class="sd">           Diffuse Horizontal Irradiance (DHI) value, in W/m^2 </span>
<span class="sd">        sunalt : int or float</span>
<span class="sd">           Sun altitude (degrees) </span>
<span class="sd">        sunaz : int or float</span>
<span class="sd">           Sun azimuth (degrees) </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        skyname : string</span>
<span class="sd">           Filename of sky in /skies/ directory</span>
<span class="sd">        &quot;&quot;&quot;</span>

        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sky generated with Gendaylit 2 MANUAL, with DNI: </span><span class="si">%0.1f</span><span class="s1">, DHI: </span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="n">dhi</span><span class="p">))</span>

        <span class="n">sky_path</span> <span class="o">=</span> <span class="s1">&#39;skies&#39;</span>

        <span class="k">if</span> <span class="n">sunalt</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dhi</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span>
        
                <span class="c1"># Assign Albedos</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground</span><span class="o">.</span><span class="n">ReflAvg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># just 1 entry</span>
                <span class="n">groundindex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ambiguous albedo entry, Set albedo to single value &quot;</span>
                      <span class="s2">&quot;in setGround()&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;usage: make sure to run setGround() before gendaylit()&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        
        
        <span class="c1"># Note: -W and -O1 are used to create full spectrum analysis in units of Wm-2       </span>
         <span class="c1">#&quot; -L %s %s -g %s \n&quot; %(dni/.0079, dhi/.0079, self.ground.ReflAvg) + \</span>
        <span class="n">skyStr</span> <span class="o">=</span>   <span class="p">(</span><span class="s2">&quot;# start of sky definition for daylighting studies</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;# Manual inputs of DNI, DHI, SunAlt and SunAZ into Gendaylit used </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;!gendaylit -ang </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">sunalt</span><span class="p">,</span> <span class="n">sunaz</span><span class="p">))</span> <span class="o">+</span> \
            <span class="s2">&quot; -W </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> -g </span><span class="si">%s</span><span class="s2"> -O 1 </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="n">dhi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground</span><span class="o">.</span><span class="n">ReflAvg</span><span class="p">[</span><span class="n">groundindex</span><span class="p">])</span> <span class="o">+</span> \
            <span class="s2">&quot;skyfunc glow sky_mat</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">4 1 1 1 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">sky_mat source sky</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">4 0 0 1 180</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">ground</span><span class="o">.</span><span class="n">_makeGroundString</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">groundindex</span><span class="p">,</span> <span class="n">cumulativesky</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">skyname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sky_path</span><span class="p">,</span> <span class="s2">&quot;sky2_</span><span class="si">%s</span><span class="s2">.rad&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">skyFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">skyname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">skyFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">skyStr</span><span class="p">)</span>
        <span class="n">skyFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">skyname</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">skyname</span></div>

<div class="viewcode-block" id="RadianceObj.genCumSky"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.genCumSky.html#bifacial_radiance.RadianceObj.genCumSky">[docs]</a>    <span class="k">def</span> <span class="nf">genCumSky</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gencumsky_metfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Generate Skydome using gencumsky. </span>
<span class="sd">        </span>
<span class="sd">        .. warning::</span>
<span class="sd">            gencumulativesky.exe is required to be installed,</span>
<span class="sd">            which is not a standard radiance distribution.</span>
<span class="sd">            You can find the program in the bifacial_radiance distribution directory</span>
<span class="sd">            in \Lib\site-packages\bifacial_radiance\data</span>
<span class="sd">            </span>
<span class="sd"> </span>
<span class="sd">        Use :func:`readWeatherFile(filename, starttime=&#39;YYYY-mm-dd_HHMM&#39;, endtime=&#39;YYYY-mm-dd_HHMM&#39;)` </span>
<span class="sd">        to limit gencumsky simulations instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        gencumsky_metfile : str</span>
<span class="sd">            Filename with path to temporary created meteorological file usually created</span>
<span class="sd">            in EPWs folder. This csv file has no headers, no index, and two</span>
<span class="sd">            space separated columns with values for GHI and DNI for each hour </span>
<span class="sd">            in the year, and MUST have 8760 entries long otherwise gencumulativesky.exe cries. </span>
<span class="sd">        savefile : string</span>
<span class="sd">            If savefile is None, defaults to &quot;cumulative&quot;</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        skyname : str</span>
<span class="sd">            Filename of the .rad file containing cumulativesky info</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># TODO:  error checking and auto-install of gencumulativesky.exe</span>
        <span class="c1"># TODO: add check if readWeatherfile has not be done</span>
        <span class="c1"># TODO: check if it fails if gcc module has been loaded? (common hpc issue)</span>
        
        <span class="c1">#import datetime</span>
        
        <span class="k">if</span> <span class="n">gencumsky_metfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gencumsky_metfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gencumsky_metfile</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gencumsky_metfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded &quot;</span><span class="p">,</span> <span class="n">gencumsky_metfile</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gencumsky_metfile</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are more than 1 year of gencumsky temporal weather file saved.&quot;</span><span class="o">+</span>
                  <span class="s2">&quot;You can pass which file you want with gencumsky_metfile input. Since &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;No year was selected, defaulting to using the first year of the list&quot;</span><span class="p">)</span>
            <span class="n">gencumsky_metfile</span> <span class="o">=</span> <span class="n">gencumsky_metfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded &quot;</span><span class="p">,</span> <span class="n">gencumsky_metfile</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">savefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">savefile</span> <span class="o">=</span> <span class="s2">&quot;cumulative&quot;</span>
        <span class="n">sky_path</span> <span class="o">=</span> <span class="s1">&#39;skies&#39;</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span><span class="o">.</span><span class="n">latitude</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span><span class="o">.</span><span class="n">longitude</span>
        <span class="n">timeZone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span><span class="o">.</span><span class="n">timezone</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        cmd = &quot;gencumulativesky +s1 -h 0 -a %s -o %s -m %s %s &quot; %(lat, lon, float(timeZone)*15, filetype) +\</span>
<span class="sd">            &quot;-time %s %s -date %s %s %s %s %s&quot; % (startdt.hour, enddt.hour+1,</span>
<span class="sd">                                                  startdt.month, startdt.day,</span>
<span class="sd">                                                  enddt.month, enddt.day,</span>
<span class="sd">                                                  gencumsky_metfile)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gencumulativesky +s1 -h 0 -a </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2"> -m &quot;</span>
               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">timeZone</span><span class="p">)</span><span class="o">*</span><span class="mi">15</span><span class="si">}</span><span class="s2"> -G </span><span class="si">{</span><span class="n">gencumsky_metfile</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
               
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="o">+</span><span class="s2">&quot;.cal&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c1"># Assign Albedos</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">groundstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground</span><span class="o">.</span><span class="n">_makeGroundString</span><span class="p">(</span><span class="n">cumulativesky</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error: ground reflection not defined.  &#39;</span>
                            <span class="s1">&#39;Run RadianceObj.setGround() first&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        


        <span class="n">skyStr</span> <span class="o">=</span> <span class="s2">&quot;#Cumulative Sky Definition</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;void brightfunc skyfunc</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;2 skybright &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.cal</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">savefile</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">skyfunc glow sky_glow</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;4 1 1 1 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">sky_glow source sky</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;4 0 0 1 180</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="n">groundstring</span>
            
        <span class="n">skyname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sky_path</span><span class="p">,</span> <span class="n">savefile</span><span class="o">+</span><span class="s2">&quot;.rad&quot;</span><span class="p">)</span>

        <span class="n">skyFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">skyname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">skyFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">skyStr</span><span class="p">)</span>
        <span class="n">skyFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">skyname</span><span class="p">]</span><span class="c1">#, &#39;SunFile.rad&#39; ]</span>

        <span class="k">return</span> <span class="n">skyname</span></div>

<div class="viewcode-block" id="RadianceObj.set1axis"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.set1axis.html#bifacial_radiance.RadianceObj.set1axis">[docs]</a>    <span class="k">def</span> <span class="nf">set1axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metdata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">limit_angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
                 <span class="n">angledelta</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">backtrack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gcr</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">cumulativesky</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">fixed_tilt_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">useMeasuredTrackerAngle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">axis_azimuth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up geometry for 1-axis tracking.  Pull in tracking angle details from</span>
<span class="sd">        pvlib, create multiple 8760 metdata sub-files where datetime of met data</span>
<span class="sd">        matches the tracking angle.  Returns &#39;trackerdict&#39; which has keys equal to</span>
<span class="sd">        either the tracker angles (gencumsky workflow) or timestamps (gendaylit hourly</span>
<span class="sd">        workflow)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">         metdata : :py:class:`~bifacial_radiance.MetObj` </span>
<span class="sd">            Meterological object to set up geometry. Usually set automatically by</span>
<span class="sd">            `bifacial_radiance` after running :py:class:`bifacial_radiance.readepw`. </span>
<span class="sd">            Default = self.metdata</span>
<span class="sd">        azimuth : numeric</span>
<span class="sd">            Orientation axis of tracker torque tube. Default North-South (180 deg).</span>
<span class="sd">            For fixed-tilt configuration, input is fixed azimuth (180 is south)</span>
<span class="sd">        limit_angle : numeric</span>
<span class="sd">            Limit angle (+/-) of the 1-axis tracker in degrees. Default 45</span>
<span class="sd">        angledelta : numeric</span>
<span class="sd">            Degree of rotation increment to parse irradiance bins. Default 5 degrees.</span>
<span class="sd">            (0.4 % error for DNI).  Other options: 4 (.25%), 2.5 (0.1%).</span>
<span class="sd">            Note: the smaller the angledelta, the more simulations must be run.</span>
<span class="sd">        backtrack : bool</span>
<span class="sd">            Whether backtracking is enabled (default = True)</span>
<span class="sd">        gcr : float</span>
<span class="sd">            Ground coverage ratio for calculation backtracking. Defualt [1.0/3.0] </span>
<span class="sd">        cumulativesky : bool</span>
<span class="sd">            [True] Wether individual csv files are</span>
<span class="sd">            created with constant tilt angle for the cumulativesky approach.</span>
<span class="sd">            if false, the gendaylit tracking approach must be used.</span>
<span class="sd">        fixed_tilt_angle : numeric</span>
<span class="sd">            If passed, this changes to a fixed tilt simulation where each hour </span>
<span class="sd">            uses fixed_tilt_angle and axis_azimuth as the tilt and azimuth</span>
<span class="sd">        useMeasuredTrackerAngle: Bool</span>
<span class="sd">            If True, and data for tracker angles has been passed by being included</span>
<span class="sd">            in the WeatherFile object (column name &#39;Tracker Angle (degrees)&#39;),</span>
<span class="sd">            then tracker angles will be set to these values instead of being calculated.</span>
<span class="sd">            NOTE that the value for azimuth passed to set1axis must be surface </span>
<span class="sd">            azimuth in the morning and not the axis_azimuth </span>
<span class="sd">            (i.e. for a N-S HSAT, azimuth = 90).</span>
<span class="sd">        axis_azimuth : numeric</span>
<span class="sd">            DEPRECATED.  returns deprecation warning. Pass the tracker </span>
<span class="sd">            axis_azimuth through to azimuth input instead.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        trackerdict : dictionary </span>
<span class="sd">            Keys represent tracker tilt angles (gencumsky) or timestamps (gendaylit)</span>
<span class="sd">            and list of csv metfile, and datetimes at that angle</span>
<span class="sd">            trackerdict[angle][&#39;csvfile&#39;;&#39;surf_azm&#39;;&#39;surf_tilt&#39;;&#39;UTCtime&#39;]</span>
<span class="sd">            - or -</span>
<span class="sd">            trackerdict[time][&#39;tracker_theta&#39;;&#39;surf_azm&#39;;&#39;surf_tilt&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Documentation check:</span>
        <span class="c1"># Removed         Internal variables</span>
        <span class="c1"># -------</span>
        <span class="c1"># metdata.solpos          dataframe with solar position data</span>
        <span class="c1"># metdata.surface_azimuth list of tracker azimuth data</span>
        <span class="c1"># metdata.surface_tilt    list of tracker surface tilt data</span>
        <span class="c1"># metdata.tracker_theta   list of tracker tilt angle</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        
        <span class="k">if</span> <span class="n">metdata</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span>

        <span class="k">if</span> <span class="n">metdata</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;metdata doesnt exist yet.  &quot;</span><span class="o">+</span>
                            <span class="s2">&quot;Run RadianceObj.readWeatherFile() &quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axis_azimuth</span><span class="p">:</span>
            <span class="n">azimuth</span> <span class="o">=</span> <span class="n">axis_azimuth</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;axis_azimuth is deprecated in set1axis; use azimuth &quot;</span>
                          <span class="s2">&quot;input instead.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            
        <span class="c1">#backtrack = True   # include backtracking support in later version</span>
        <span class="c1">#gcr = 1.0/3.0       # default value - not used if backtrack = False.</span>


        <span class="c1"># get 1-axis tracker angles for this location, rounded to nearest &#39;angledelta&#39;</span>
        <span class="n">trackerdict</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">_set1axis</span><span class="p">(</span><span class="n">cumulativesky</span><span class="o">=</span><span class="n">cumulativesky</span><span class="p">,</span>
                                       <span class="n">azimuth</span><span class="o">=</span><span class="n">azimuth</span><span class="p">,</span>
                                       <span class="n">limit_angle</span><span class="o">=</span><span class="n">limit_angle</span><span class="p">,</span>
                                       <span class="n">angledelta</span><span class="o">=</span><span class="n">angledelta</span><span class="p">,</span>
                                       <span class="n">backtrack</span><span class="o">=</span><span class="n">backtrack</span><span class="p">,</span>
                                       <span class="n">gcr</span><span class="o">=</span><span class="n">gcr</span><span class="p">,</span>
                                       <span class="n">fixed_tilt_angle</span><span class="o">=</span><span class="n">fixed_tilt_angle</span><span class="p">,</span>
                                       <span class="n">useMeasuredTrackerAngle</span><span class="o">=</span><span class="n">useMeasuredTrackerAngle</span>
                                       <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span> <span class="o">=</span> <span class="n">trackerdict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumulativesky</span> <span class="o">=</span> <span class="n">cumulativesky</span>

        <span class="k">return</span> <span class="n">trackerdict</span></div>

<div class="viewcode-block" id="RadianceObj.gendaylit1axis"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.gendaylit1axis.html#bifacial_radiance.RadianceObj.gendaylit1axis">[docs]</a>    <span class="k">def</span> <span class="nf">gendaylit1axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metdata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trackerdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">startdate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">enddate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        1-axis tracking implementation of gendaylit.</span>
<span class="sd">        Creates multiple sky files, one for each time of day.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        metdata</span>
<span class="sd">            MetObj output from readWeatherFile.  Needs to have </span>
<span class="sd">            RadianceObj.set1axis() run on it first.</span>
<span class="sd">        startdate : str </span>
<span class="sd">            DEPRECATED, does not do anything now.</span>
<span class="sd">            Recommended to downselect metdata when reading Weather File.</span>
<span class="sd">        enddate : str</span>
<span class="sd">            DEPRECATED, does not do anything now.</span>
<span class="sd">            Recommended to downselect metdata when reading Weather File.</span>
<span class="sd">        trackerdict : dictionary</span>
<span class="sd">            Dictionary with keys for tracker tilt angles (gencumsky) or timestamps (gendaylit)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Updated trackerdict dictionary </span>
<span class="sd">            Dictionary with keys for tracker tilt angles (gencumsky) or timestamps (gendaylit)</span>
<span class="sd">            with the additional dictionary value [&#39;skyfile&#39;] added</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">metdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metdata</span>
        <span class="k">if</span> <span class="n">trackerdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trackerdict value passed or available in self&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">startdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">enddate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deprecation Warning: gendyalit1axis no longer downselects&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; entries by stardate and enddate. Downselect your data&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; when loading with readWeatherFile&quot;</span><span class="p">)</span>
            <span class="k">return</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metdata</span><span class="o">.</span><span class="n">tracker_theta</span>  <span class="c1"># this may not exist</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;metdata.tracker_theta doesn&#39;t exist. Run RadianceObj.set1axis() first&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating ~</span><span class="si">%d</span><span class="s1"> skyfiles. &#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trackerdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># counter to get number of skyfiles created, just for giggles</span>

        <span class="n">trackerdict2</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trackerdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">time</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>  <span class="c1">#out of range error</span>
                <span class="k">break</span>  <span class="c1"># </span>
            <span class="c1">#filename = str(time)[5:-12].replace(&#39;-&#39;,&#39;_&#39;).replace(&#39; &#39;,&#39;_&#39;)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H%M&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span>

            <span class="c1">#check for GHI &gt; 0</span>
            <span class="c1">#if metdata.ghi[i] &gt; 0:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">metdata</span><span class="o">.</span><span class="n">ghi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">metdata</span><span class="o">.</span><span class="n">tracker_theta</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>  
                <span class="n">skyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gendaylit</span><span class="p">(</span><span class="n">metdata</span><span class="o">=</span><span class="n">metdata</span><span class="p">,</span><span class="n">timeindex</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
                <span class="c1"># trackerdict2 reduces the dict to only the range specified.</span>
                <span class="n">trackerdict2</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>  
                <span class="n">trackerdict2</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;skyfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">skyfile</span>
                <span class="n">count</span> <span class="o">+=</span><span class="mi">1</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Created </span><span class="si">{}</span><span class="s1"> skyfiles in /skies/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span> <span class="o">=</span> <span class="n">trackerdict2</span>
        <span class="k">return</span> <span class="n">trackerdict2</span></div>

<div class="viewcode-block" id="RadianceObj.genCumSky1axis"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.genCumSky1axis.html#bifacial_radiance.RadianceObj.genCumSky1axis">[docs]</a>    <span class="k">def</span> <span class="nf">genCumSky1axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trackerdict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        1-axis tracking implementation of gencumulativesky.</span>
<span class="sd">        Creates multiple .cal files and .rad files, one for each tracker angle.</span>

<span class="sd">        Use :func:`readWeatherFile` to limit gencumsky simulations</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        trackerdict : dictionary</span>
<span class="sd">            Trackerdict generated as output by RadianceObj.set1axis()</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        trackerdict : dictionary</span>
<span class="sd">            Trackerdict dictionary with new entry trackerdict.skyfile  </span>
<span class="sd">            Appends &#39;skyfile&#39;  to the 1-axis dict with the location of the sky .radfile</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">trackerdict</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trackerdict value passed or available in self&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">):</span>  
            <span class="c1"># call gencumulativesky with a new .cal and .rad name</span>
            <span class="n">csvfile</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;csvfile&#39;</span><span class="p">]</span>
            <span class="n">savefile</span> <span class="o">=</span> <span class="s1">&#39;1axis_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>  <span class="c1">#prefix for .cal file and skies\*.rad file</span>
            <span class="n">skyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genCumSky</span><span class="p">(</span><span class="n">gencumsky_metfile</span><span class="o">=</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="n">savefile</span><span class="p">)</span>
            <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;skyfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">skyfile</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Created skyfile </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">skyfile</span><span class="p">))</span>
        <span class="c1"># delete default skyfile (not strictly necessary)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skyfiles</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span> <span class="o">=</span> <span class="n">trackerdict</span>
        <span class="k">return</span> <span class="n">trackerdict</span></div>


<div class="viewcode-block" id="RadianceObj.makeOct"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.makeOct.html#bifacial_radiance.RadianceObj.makeOct">[docs]</a>    <span class="k">def</span> <span class="nf">makeOct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">octname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combine everything together into a .oct file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filelist : list </span>
<span class="sd">            Files to include.  otherwise takes self.filelist</span>
<span class="sd">        octname : str</span>
<span class="sd">            filename (without .oct extension)</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        octname : str</span>
<span class="sd">            filename of .oct file in root directory including extension</span>
<span class="sd">        err : str</span>
<span class="sd">            Error message returned from oconv (if any)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">filelist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getfilelist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">octname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">octname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#JSS. With the way that the break is handled now, this will wait the 10 for all the hours</span>
        <span class="c1"># that were not generated sky files.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span> <span class="p">:</span>
            <span class="kn">import</span> <span class="nn">time</span>
            <span class="n">time_to_wait</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">time_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HPC Checking for file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">))</span>
                <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>  <span class="c1"># are we missing any files? abort!</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Missing files, skipping...&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">octfile</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="c1">#Filesky is being saved as &#39;none&#39;, so it crashes !</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">time_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">time_counter</span> <span class="o">&gt;</span> <span class="n">time_to_wait</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;filenotfound&quot;</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="c1">#os.system(&#39;oconv &#39;+ &#39; &#39;.join(filelist) + &#39; &gt; %s.oct&#39; % (octname))</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>  <span class="c1"># are we missing any files? abort!</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Missing files, skipping...&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">octfile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1">#cmd = &#39;oconv &#39; + &#39; &#39;.join(filelist)</span>
        <span class="n">filelist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;oconv&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.oct&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">octname</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="c1">#TODO:  exception handling for no sun up</span>
            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="mi">9</span><span class="p">:],</span> <span class="ne">Warning</span><span class="p">)</span>
                    

        <span class="c1">#use rvu to see if everything looks good. </span>
        <span class="c1"># use cmd for this since it locks out the terminal.</span>
        <span class="c1">#&#39;rvu -vf views\side.vp -e .01 monopanel_test.oct&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Created </span><span class="si">%s</span><span class="s2">.oct&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">octname</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">octfile</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.oct&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">octname</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.oct&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">octname</span><span class="p">)</span></div>

<div class="viewcode-block" id="RadianceObj.makeOct1axis"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.makeOct1axis.html#bifacial_radiance.RadianceObj.makeOct1axis">[docs]</a>    <span class="k">def</span> <span class="nf">makeOct1axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trackerdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">singleindex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">customname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combine files listed in trackerdict into multiple .oct files</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        trackerdict </span>
<span class="sd">            Output from :py:class:`~bifacial_radiance.RadianceObj.makeScene1axis`</span>
<span class="sd">        singleindex : str</span>
<span class="sd">            Single index for trackerdict to run makeOct1axis in single-value mode,</span>
<span class="sd">            format &#39;YYYY-MM-DD_HHMM&#39;.</span>
<span class="sd">        customname : str </span>
<span class="sd">            Custom text string added to the end of the OCT file name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        trackerdict</span>
<span class="sd">            Append &#39;octfile&#39;  to the 1-axis dict with the location of the scene .octfile</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">customname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">customname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">trackerdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trackerdict value passed or available in self&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">singleindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># loop through all values in the tracker dictionary</span>
            <span class="n">indexlist</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># just loop through one single index in tracker dictionary</span>
            <span class="n">indexlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">singleindex</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Making </span><span class="si">{}</span><span class="s1"> octfiles in root directory.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">indexlist</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indexlist</span><span class="p">):</span>  <span class="c1"># run through either entire key list of trackerdict, or just a single value</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialfiles</span> <span class="o">+</span> <span class="p">[</span><span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;skyfile&#39;</span><span class="p">],</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;radfile&#39;</span><span class="p">]]</span>
                <span class="n">octname</span> <span class="o">=</span> <span class="s1">&#39;1axis_</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">customname</span><span class="p">)</span>
                <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;octfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeOct</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">octname</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trackerdict key error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">trackerdict</span></div>

    
<div class="viewcode-block" id="RadianceObj.makeModule"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.makeModule.html#bifacial_radiance.RadianceObj.makeModule">[docs]</a>    <span class="k">def</span> <span class="nf">makeModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">modulefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">customtext</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="n">xgap</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ygap</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
                 <span class="n">zgap</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">numpanels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewriteModulefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">glass</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">modulematerial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bifi</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pass module generation details into ModuleObj(). See ModuleObj() </span>
<span class="sd">        docstring for more details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">bifacial_radiance</span> <span class="kn">import</span> <span class="n">ModuleObj</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;usage:  makeModule(name,x,y,z, modulefile = &#39;\objects\*.rad&#39;, &quot;</span><span class="o">+</span>
                  <span class="s2">&quot; zgap = 0.1 (module offset)&quot;</span><span class="o">+</span>
                  <span class="s2">&quot;numpanels = 1 (# of panels in portrait), ygap = 0.05 &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;(slope distance between panels when arrayed), &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;rewriteModulefile = True (or False), bifi = 1&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You can also override module_type info by passing &#39;text&#39;&quot;</span><span class="o">+</span>
                  <span class="s2">&quot;variable, or add on at the end for racking details with &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;&#39;customtext&#39;. See function definition for more details&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optional: tubeParams=</span><span class="si">{}</span><span class="s2"> (torque tube details including &quot;</span>
                  <span class="s2">&quot;diameter (torque tube dia. in meters), tubetype=&#39;Round&#39; &quot;</span>
                  <span class="s2">&quot;(or &#39;square&#39;, &#39;hex&#39;), material=&#39;Metal_Grey&#39; (or &#39;black&#39;)&quot;</span>
                  <span class="s2">&quot;, axisofrotation=True (does scene rotate around tube)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optional: cellModule=</span><span class="si">{}</span><span class="s2"> (create cell-level module by &quot;</span><span class="o">+</span>
                  <span class="s2">&quot; passing in dictionary with keys &#39;numcellsx&#39;6 (#cells in &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;X-dir.), &#39;numcellsy&#39;, &#39;xcell&#39; (cell size in X-dir. in meters),&quot;</span><span class="o">+</span>
                  <span class="s2">&quot;&#39;ycell&#39;, &#39;xcellgap&#39; (spacing between cells in X-dir.), &#39;ycellgap&#39;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optional: omegaParams=</span><span class="si">{}</span><span class="s2"> (create the support structure omega by &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;passing in dictionary with keys &#39;omega_material&#39; (the material of &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;omega), &#39;mod_overlap&#39;(the length of the module adjacent piece of&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; omega that overlaps with the module),&#39;x_omega1&#39;, &#39;y_omega&#39; (ideally same&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; for all the parts of omega),&#39;z_omega1&#39;, &#39;x_omega2&#39; (X-dir length of the&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; vertical piece), &#39;x_omega3&#39;, z_omega3&quot;</span><span class="p">)</span>

            <span class="k">return</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # TODO: check for deprecated torquetube and axisofrotationTorqueTube in</span>
<span class="sd">          kwargs.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;tubeParams&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tubeParams</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tubeParams&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tubeParams</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;torquetube&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">torquetube</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;torquetube&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: boolean input `torquetube` passed into makeModule&quot;</span>
                  <span class="s2">&quot;. Starting in v0.4.0 this boolean parameter is deprecated.&quot;</span>
                  <span class="s2">&quot; Use module.addTorquetube() with `visible` parameter instead.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tubeParams</span><span class="p">:</span>
                <span class="n">tubeParams</span><span class="p">[</span><span class="s1">&#39;visible&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">torquetube</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">tubeParams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">torquetube</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">tubeParams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span> <span class="c1"># create default TT</span>
            
        <span class="k">if</span> <span class="s1">&#39;axisofrotationTorqueTube&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">axisofrotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axisofrotationTorqueTube&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: input boolean `axisofrotationTorqueTube` passed &quot;</span>
                <span class="s2">&quot;into makeModule. Starting in v0.4.0 this boolean parameter is&quot;</span>
                <span class="s2">&quot; deprecated. Use module.addTorquetube() with `axisofrotation`&quot;</span>
                <span class="s2">&quot;parameter instead.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tubeParams</span><span class="p">:</span>  <span class="c1">#this kwarg only does somehting if there&#39;s a TT.</span>
                <span class="n">tubeParams</span><span class="p">[</span><span class="s1">&#39;axisofrotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axisofrotation</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span><span class="p">:</span>  <span class="c1"># trigger HPC simulation in ModuleObj</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hpc&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">ModuleObj</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">bifi</span><span class="o">=</span><span class="n">bifi</span><span class="p">,</span> <span class="n">modulefile</span><span class="o">=</span><span class="n">modulefile</span><span class="p">,</span>
                   <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">customtext</span><span class="o">=</span><span class="n">customtext</span><span class="p">,</span> <span class="n">xgap</span><span class="o">=</span><span class="n">xgap</span><span class="p">,</span> <span class="n">ygap</span><span class="o">=</span><span class="n">ygap</span><span class="p">,</span> 
                   <span class="n">zgap</span><span class="o">=</span><span class="n">zgap</span><span class="p">,</span> <span class="n">numpanels</span><span class="o">=</span><span class="n">numpanels</span><span class="p">,</span> 
                   <span class="n">rewriteModulefile</span><span class="o">=</span><span class="n">rewriteModulefile</span><span class="p">,</span> <span class="n">glass</span><span class="o">=</span><span class="n">glass</span><span class="p">,</span> 
                   <span class="n">modulematerial</span><span class="o">=</span><span class="n">modulematerial</span><span class="p">,</span> <span class="n">tubeParams</span><span class="o">=</span><span class="n">tubeParams</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span></div>
    
    
    
<div class="viewcode-block" id="RadianceObj.makeCustomObject"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.makeCustomObject.html#bifacial_radiance.RadianceObj.makeCustomObject">[docs]</a>    <span class="k">def</span> <span class="nf">makeCustomObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for development and experimenting with extraneous objects in the scene.</span>
<span class="sd">        This function creates a `name.rad` textfile in the objects folder</span>
<span class="sd">        with whatever text that is passed to it.</span>
<span class="sd">        It is up to the user to pass the correct radiance format.</span>
<span class="sd">        </span>
<span class="sd">        For example, to create a box at coordinates 0,0 (with its bottom surface</span>
<span class="sd">        on the plane z=0):</span>
<span class="sd">            </span>
<span class="sd">        .. code-block:</span>
<span class="sd">        </span>
<span class="sd">            name = &#39;box&#39;</span>
<span class="sd">            text=&#39;! genbox black PVmodule 0.5 0.5 0.5 | xform -t -0.25 -0.25 0&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            String input to name the module type</span>
<span class="sd">        text : str</span>
<span class="sd">            Text used in the radfile to generate the module</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">customradfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;objects&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.rad&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="c1"># update in 0.2.3 to shorten radnames</span>
        <span class="c1"># py2 and 3 compatible: binary write, encode text first</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">customradfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Custom Object Name&quot;</span><span class="p">,</span> <span class="n">customradfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customradfile</span> <span class="o">=</span> <span class="n">customradfile</span>
        <span class="k">return</span> <span class="n">customradfile</span></div>


    <span class="k">def</span> <span class="nf">printModules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print available module types from ModuleObj</span>
        <span class="kn">from</span> <span class="nn">bifacial_radiance</span> <span class="kn">import</span> <span class="n">ModuleObj</span>
        <span class="n">modulenames</span> <span class="o">=</span> <span class="n">ModuleObj</span><span class="p">()</span><span class="o">.</span><span class="n">readModule</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available module names: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">modulenames</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">modulenames</span>
    
<div class="viewcode-block" id="RadianceObj.makeScene"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.makeScene.html#bifacial_radiance.RadianceObj.makeScene">[docs]</a>    <span class="k">def</span> <span class="nf">makeScene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sceneDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">moduletype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a SceneObj which contains details of the PV system configuration including</span>
<span class="sd">        tilt, row pitch, height, nMods per row, nRows in the system...</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        module : str or ModuleObj</span>
<span class="sd">            String name of module created with makeModule()</span>
<span class="sd">        sceneDict : dictionary</span>
<span class="sd">            Dictionary with keys: `tilt`, `clearance_height`*, `pitch`,</span>
<span class="sd">            `azimuth`, `nMods`, `nRows`, `hub_height`*, `height`*</span>
<span class="sd">            * height deprecated from sceneDict. For makeScene (fixed systems)</span>
<span class="sd">            if passed it is assumed it reffers to clearance_height.</span>
<span class="sd">            `clearance_height` recommended for fixed_tracking systems.</span>
<span class="sd">            `hub_height` can also be passed as a possibility.</span>
<span class="sd">        radname : str</span>
<span class="sd">            Gives a custom name to the scene file. Useful when parallelizing.</span>
<span class="sd">        moduletype: DEPRECATED. use the `module` kwarg instead.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SceneObj </span>
<span class="sd">            &#39;scene&#39; with configuration details</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">moduletype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">moduletype</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning:  input `moduletype` is deprecated. Use kwarg &quot;</span>
                  <span class="s2">&quot;`module` instead&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using last saved module, name: </span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;makeScene(module, sceneDict, nMods, nRows).  &#39;</span><span class="o">+</span>\
                          <span class="s1">&#39;Available moduletypes: &#39;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printModules</span><span class="p">()</span> <span class="c1">#print available module types</span>
                <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">SceneObj</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">hpc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span>  <span class="c1">#pass HPC mode from parent</span>

        <span class="k">if</span> <span class="n">sceneDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;makeScene(moduletype, sceneDict, nMods, nRows).  &#39;</span><span class="o">+</span>\
                  <span class="s1">&#39;sceneDict inputs: .tilt .clearance_height .pitch .azimuth&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span>

        <span class="k">if</span> <span class="s1">&#39;azimuth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span>

        <span class="k">if</span> <span class="s1">&#39;nRows&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nRows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="k">if</span> <span class="s1">&#39;nMods&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nMods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="c1"># Fixed tilt routine</span>
        <span class="c1"># Preferred: clearance_height,</span>
        <span class="c1"># If only height is passed, it is assumed to be clearance_height.</span>
        
        <span class="n">sceneDict</span><span class="p">,</span> <span class="n">use_clearanceheight</span>  <span class="o">=</span> <span class="n">_heightCasesSwitcher</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">,</span> 
                                                                <span class="n">preferred</span><span class="o">=</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">,</span> 
                                                                <span class="n">nonpreferred</span><span class="o">=</span><span class="s1">&#39;hub_height&#39;</span><span class="p">)</span>
        
        <span class="c1">#self.nMods = sceneDict[&#39;nMods&#39;]</span>
        <span class="c1">#self.nRows = sceneDict[&#39;nRows&#39;]</span>
        <span class="n">sceneRAD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">_makeSceneNxR</span><span class="p">(</span><span class="n">sceneDict</span><span class="o">=</span><span class="n">sceneDict</span><span class="p">,</span>
                                                 <span class="n">radname</span><span class="o">=</span><span class="n">radname</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;appendRadfile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">appendRadfile</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">appendRadfile</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;appendRadfile&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">appendRadfile</span><span class="p">:</span>
            <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sceneRAD</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Radfile APPENDED!&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1">#TODO: Manage situation where radfile was created with</span>
                <span class="c1">#appendRadfile to False first..</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sceneRAD</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Radfile APPENDAGE created!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">sceneRAD</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span></div>

<div class="viewcode-block" id="RadianceObj.appendtoScene"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.appendtoScene.html#bifacial_radiance.RadianceObj.appendtoScene">[docs]</a>    <span class="k">def</span> <span class="nf">appendtoScene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">customObject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends to the `Scene radfile` in folder `\objects` the text command in Radiance</span>
<span class="sd">        lingo created by the user.</span>
<span class="sd">        Useful when using addCustomObject to the scene.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        radfile: str</span>
<span class="sd">            Directory and name of where .rad scene file is stored</span>
<span class="sd">        customObject : str</span>
<span class="sd">            Directory and name of custom object .rad file is stored</span>
<span class="sd">        text : str </span>
<span class="sd">            Command to be appended to the radfile. Do not leave empty spaces</span>
<span class="sd">            at the end.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Nothing, the radfile must already be created and assigned when running this.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#TODO: Add a custom name and replace radfile name</span>

        <span class="c1"># py2 and 3 compatible: binary write, encode text first</span>
        <span class="n">text2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">customObject</span>
        
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">text2</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">radfile</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span></div>



    
<div class="viewcode-block" id="RadianceObj.makeScene1axis"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.makeScene1axis.html#bifacial_radiance.RadianceObj.makeScene1axis">[docs]</a>    <span class="k">def</span> <span class="nf">makeScene1axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trackerdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sceneDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">cumulativesky</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">moduletype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a SceneObj for each tracking angle which contains details of the PV</span>
<span class="sd">        system configuration including row pitch, hub_height, nMods per row, nRows in the system...</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        trackerdict</span>
<span class="sd">            Output from GenCumSky1axis</span>
<span class="sd">        module : str or ModuleObj</span>
<span class="sd">            Name or ModuleObj created with makeModule()</span>
<span class="sd">        sceneDict : </span>
<span class="sd">            Dictionary with keys:`tilt`, `hub_height`, `pitch`, `azimuth`</span>
<span class="sd">        cumulativesky : bool</span>
<span class="sd">            Defines if sky will be generated with cumulativesky or gendaylit.</span>
<span class="sd">        moduletype: DEPRECATED. use the `module` kwarg instead.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        trackerdict </span>
<span class="sd">            Append the following keys</span>
<span class="sd">                &#39;radfile&#39;</span>
<span class="sd">                    directory where .rad scene file is stored</span>
<span class="sd">                &#39;scene&#39;</span>
<span class="sd">                    SceneObj for each tracker theta</span>
<span class="sd">                &#39;clearance_height&#39;</span>
<span class="sd">                    Calculated ground clearance based on</span>
<span class="sd">                    `hub height`, `tilt` angle and overall collector width `sceney`</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">math</span>

        <span class="k">if</span> <span class="n">sceneDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;usage: makeScene1axis(module, sceneDict, nMods, nRows).&#39;</span><span class="o">+</span>
                  <span class="s1">&#39;sceneDict inputs: .hub_height .azimuth .nMods .nRows&#39;</span><span class="o">+</span>
                  <span class="s1">&#39;and .pitch or .gcr&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># If no nRows or nMods assigned on deprecated variable or dictionary,</span>
        <span class="c1"># assign default.</span>
        <span class="k">if</span> <span class="s1">&#39;nRows&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nRows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="s1">&#39;nMods&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nMods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="k">if</span> <span class="n">trackerdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trackerdict value passed or available in self&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># see if cumulativesky = False was set earlier,</span>
                <span class="c1"># e.g. in RadianceObj.set1axis</span>
                <span class="n">cumulativesky</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulativesky</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># default cumulativesky = true to maintain backward compatibility.</span>
                <span class="n">cumulativesky</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="k">if</span> <span class="n">moduletype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">moduletype</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning:  input `moduletype` is deprecated. Use kwarg &quot;</span>
                  <span class="s2">&quot;`module` instead&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using last saved module, name: </span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;usage:  makeScene1axis(trackerdict, module, &#39;</span><span class="o">+</span>
                      <span class="s1">&#39;sceneDict, nMods, nRows). &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printModules</span><span class="p">()</span> <span class="c1">#print available module types</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;orientation&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> ERROR: Orientation format has been &#39;</span>
                <span class="s1">&#39;deprecated since version 0.2.4. If you want to flip your &#39;</span>
                <span class="s1">&#39;modules, on makeModule switch the x and y values.</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
       
        <span class="c1"># 1axis routine</span>
        <span class="c1"># Preferred hub_height</span>
        <span class="n">sceneDict</span><span class="p">,</span> <span class="n">use_clearanceheight</span> <span class="o">=</span> <span class="n">_heightCasesSwitcher</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">,</span> 
                                                        <span class="n">preferred</span><span class="o">=</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> 
                                                        <span class="n">nonpreferred</span><span class="o">=</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_clearanceheight</span><span class="p">:</span>
            <span class="n">simplefix</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">hubheight</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">]</span> <span class="c1"># Not really, but this is the fastest </span>
            <span class="c1"># to make it work with the simplefix as below the actual clearnace height</span>
            <span class="c1"># gets calculated and the 0 sets the cosine correction to 0. </span>
            <span class="c1"># TODO CLEAN THIS UP.</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#the hub height is the tracker height at center of rotation.</span>
            <span class="n">hubheight</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span>
            <span class="n">simplefix</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># we no longer need sceneDict[&#39;hub_height&#39;] - it&#39;ll be replaced by &#39;clearance_height&#39; below</span>
        <span class="n">sceneDict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>        <span class="c1"># cumulativesky workflow</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Making .rad files for cumulativesky 1-axis workflow&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">trackerdict</span><span class="p">:</span>
                <span class="n">scene</span> <span class="o">=</span> <span class="n">SceneObj</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">180</span><span class="p">:</span>
                    <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">180</span>
                    <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_tilt&#39;</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span>
                <span class="n">radname</span> <span class="o">=</span> <span class="s1">&#39;1axis</span><span class="si">%s</span><span class="s1">_&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">theta</span><span class="p">,)</span>

                <span class="c1"># Calculating clearance height for this theta.</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">hubheight</span> <span class="o">-</span> <span class="n">simplefix</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> \
                        <span class="o">*</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sceney</span> <span class="o">+</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">offsetfromaxis</span> \
                        <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
                <span class="c1"># Calculate the ground clearance height based on the hub height. Add abs(theta) to avoid negative tilt angle errors</span>
                <span class="c1">#trackerdict[theta][&#39;clearance_height&#39;] = height</span>

                <span class="n">sceneDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;tilt&#39;</span> <span class="p">:</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_tilt&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;clearance_height&#39;</span> <span class="p">:</span>  <span class="n">height</span><span class="p">,</span>
                                 <span class="s1">&#39;azimuth&#39;</span> <span class="p">:</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;modulez&#39;</span> <span class="p">:</span>  <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">z</span><span class="p">})</span>

                <span class="n">radfile</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">_makeSceneNxR</span><span class="p">(</span><span class="n">sceneDict</span><span class="o">=</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">),</span>
                                             <span class="n">radname</span><span class="o">=</span><span class="n">radname</span><span class="p">,</span> <span class="n">addhubheight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;radfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radfile</span>
                <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scene</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Radfiles created in /objects/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trackerdict</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1">#gendaylit workflow</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Making ~</span><span class="si">%s</span><span class="s1"> .rad files for gendaylit 1-axis workflow (this takes a minute..)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">)))</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">trackerdict</span><span class="p">:</span>
                <span class="n">scene</span> <span class="o">=</span> <span class="n">SceneObj</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">180</span><span class="p">:</span>
                    <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">180</span>
                    <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;surf_tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;surf_tilt&#39;</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>
                <span class="n">radname</span> <span class="o">=</span> <span class="s1">&#39;1axis</span><span class="si">%s</span><span class="s1">_&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="p">,)</span>

                <span class="c1"># Calculating clearance height for this time.</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">hubheight</span> <span class="o">-</span> <span class="n">simplefix</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> \
                        <span class="o">*</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sceney</span> <span class="o">+</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">offsetfromaxis</span> \
                        <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;ghi&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#trackerdict[time][&#39;clearance_height&#39;] = height</span>

                    <span class="n">sceneDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;tilt&#39;</span> <span class="p">:</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;surf_tilt&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;clearance_height&#39;</span> <span class="p">:</span>  <span class="n">height</span><span class="p">,</span>
                                     <span class="s1">&#39;azimuth&#39;</span> <span class="p">:</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;modulez&#39;</span> <span class="p">:</span>  <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">z</span><span class="p">})</span>

                    <span class="c1"># if sceneDict isn&#39;t copied, it will change inside the SceneObj since dicts are mutable!</span>
                    <span class="n">radfile</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">_makeSceneNxR</span><span class="p">(</span><span class="n">sceneDict</span><span class="o">=</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">),</span>
                                                 <span class="n">radname</span><span class="o">=</span><span class="n">radname</span><span class="p">,</span> <span class="n">addhubheight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;radfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radfile</span>
                    <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scene</span>
                    <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Radfiles created in /objects/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span> <span class="o">=</span> <span class="n">trackerdict</span>
        <span class="c1">#self.nMods = sceneDict[&#39;nMods&#39;]  #assign nMods and nRows to RadianceObj</span>
        <span class="c1">#self.nRows = sceneDict[&#39;nRows&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hub_height</span> <span class="o">=</span> <span class="n">hubheight</span>
        
        <span class="k">return</span> <span class="n">trackerdict</span></div>


<div class="viewcode-block" id="RadianceObj.analysis1axis"><a class="viewcode-back" href="../../generated/bifacial_radiance.RadianceObj.analysis1axis.html#bifacial_radiance.RadianceObj.analysis1axis">[docs]</a>    <span class="k">def</span> <span class="nf">analysis1axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trackerdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">singleindex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">,</span>
                      <span class="n">customname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modWanted</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rowWanted</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                      <span class="n">sensorsy</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">sensorsx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
                      <span class="n">modscanfront</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modscanback</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                      <span class="n">debug</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loop through trackerdict and runs linescans for each scene and scan in there.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        trackerdict </span>
<span class="sd">        singleindex : str</span>
<span class="sd">            For single-index mode, just the one index we want to run (new in 0.2.3).</span>
<span class="sd">            Example format &#39;21_06_14_12_30&#39; for 2021 June 14th 12:30 pm</span>
<span class="sd">        accuracy : str</span>
<span class="sd">            &#39;low&#39; or &#39;high&#39;, resolution option used during _irrPlot and rtrace</span>
<span class="sd">        customname : str</span>
<span class="sd">            Custom text string to be added to the file name for the results .CSV files</span>
<span class="sd">        modWanted : int </span>
<span class="sd">            Module to be sampled. Index starts at 1.</span>
<span class="sd">        rowWanted : int</span>
<span class="sd">            Row to be sampled. Index starts at 1. (row 1)</span>
<span class="sd">        sensorsy : int or list </span>
<span class="sd">            Number of &#39;sensors&#39; or scanning points along the collector width </span>
<span class="sd">            (CW) of the module(s). If multiple values are passed, first value</span>
<span class="sd">            represents number of front sensors, second value is number of back sensors</span>
<span class="sd">        sensorsx : int or list </span>
<span class="sd">            Number of &#39;sensors&#39; or scanning points along the length, the side perpendicular </span>
<span class="sd">            to the collector width (CW) of the module(s) for the back side of the module. </span>
<span class="sd">            If multiple values are passed, first value represents number of </span>
<span class="sd">            front sensors, second value is number of back sensors.</span>
<span class="sd">        modscanfront : dict</span>
<span class="sd">            dictionary with one or more of the following key: xstart, ystart, zstart, </span>
<span class="sd">            xinc, yinc, zinc, Nx, Ny, Nz, orient. All of these keys are ints or </span>
<span class="sd">            floats except for &#39;orient&#39; which takes x y z values as string &#39;x y z&#39;</span>
<span class="sd">            for example &#39;0 0 -1&#39;. These values will overwrite the internally</span>
<span class="sd">            calculated frontscan dictionary for the module &amp; row selected. If modifying </span>
<span class="sd">            Nx, Ny or Nz, make sure to modify on modscanback to avoid issues on </span>
<span class="sd">            results writing stage. </span>
<span class="sd">        modscanback : dict</span>
<span class="sd">            dictionary with one or more of the following key: xstart, ystart, zstart, </span>
<span class="sd">            xinc, yinc, zinc, Nx, Ny, Nz, orient. All of these keys are ints or </span>
<span class="sd">            floats except for &#39;orient&#39; which takes x y z values as string &#39;x y z&#39;</span>
<span class="sd">            for example &#39;0 0 -1&#39;. These values will overwrite the internally</span>
<span class="sd">            calculated frontscan dictionary for the module &amp; row selected.  If modifying </span>
<span class="sd">            Nx, Ny or Nz, make sure to modify on modscanback to avoid issues on </span>
<span class="sd">            results writing stage. </span>
<span class="sd">        relative : Bool</span>
<span class="sd">            if passing modscanfront and modscanback to modify dictionarie of positions,</span>
<span class="sd">            this sets if the values passed to be updated are relative or absolute. </span>
<span class="sd">            Default is absolute value (relative=False)</span>
<span class="sd">        debug : Bool</span>
<span class="sd">            Activates internal printing of the function to help debugging.</span>
<span class="sd"> </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        trackerdict with new keys:</span>
<span class="sd">            </span>
<span class="sd">            &#39;AnalysisObj&#39;  : analysis object for this tracker theta</span>
<span class="sd">            &#39;Wm2Front&#39;     : list of front Wm-2 irradiances, len=sensorsy_back</span>
<span class="sd">            &#39;Wm2Back&#39;      : list of rear Wm-2 irradiances, len=sensorsy_back</span>
<span class="sd">            &#39;backRatio&#39;    : list of rear irradiance ratios, len=sensorsy_back</span>
<span class="sd">        RadianceObj with new appended values: </span>
<span class="sd">            &#39;Wm2Front&#39;     : np Array with front irradiance cumulative</span>
<span class="sd">            &#39;Wm2Back&#39;      : np Array with rear irradiance cumulative</span>
<span class="sd">            &#39;backRatio&#39;    : np Array with rear irradiance ratios</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">warnings</span>

        <span class="k">if</span> <span class="n">customname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">customname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">trackerdict</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackerdict</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trackerdict value passed or available in self&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">singleindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># run over all values in trackerdict</span>
            <span class="n">trackerkeys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">trackerdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>                   <span class="c1"># run in single index mode.</span>
            <span class="n">trackerkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">singleindex</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">modWanted</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modWanted</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">[</span><span class="n">trackerkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nMods&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1.99</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rowWanted</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rowWanted</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">[</span><span class="n">trackerkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nRows&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1.99</span><span class="p">)</span>

       
        <span class="n">frontWm2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># container for tracking front irradiance across module chord. Dynamically size based on first analysis run</span>
        <span class="n">backWm2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># container for tracking rear irradiance across module chord.</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">trackerkeys</span><span class="p">:</span>   <span class="c1"># either full list of trackerdict keys, or single index</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;1axis_</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">customname</span><span class="p">)</span>
            <span class="n">octfile</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;octfile&#39;</span><span class="p">]</span>
            <span class="n">scene</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">octfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># don&#39;t run analysis if the octfile is none</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># look for missing data</span>
                <span class="n">analysis</span> <span class="o">=</span> <span class="n">AnalysisObj</span><span class="p">(</span><span class="n">octfile</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;1axis_</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">customname</span><span class="p">,)</span>
                <span class="n">frontscanind</span><span class="p">,</span> <span class="n">backscanind</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">moduleAnalysis</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="n">scene</span><span class="p">,</span> <span class="n">modWanted</span><span class="o">=</span><span class="n">modWanted</span><span class="p">,</span> 
                                                <span class="n">rowWanted</span><span class="o">=</span><span class="n">rowWanted</span><span class="p">,</span> 
                                                <span class="n">sensorsy</span><span class="o">=</span><span class="n">sensorsy</span><span class="p">,</span> 
                                                <span class="n">sensorsx</span><span class="o">=</span><span class="n">sensorsx</span><span class="p">,</span> 
                                                <span class="n">modscanfront</span><span class="o">=</span><span class="n">modscanfront</span><span class="p">,</span> <span class="n">modscanback</span><span class="o">=</span><span class="n">modscanback</span><span class="p">,</span>
                                                <span class="n">relative</span><span class="o">=</span><span class="n">relative</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">analysis</span><span class="p">(</span><span class="n">octfile</span><span class="o">=</span><span class="n">octfile</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">frontscan</span><span class="o">=</span><span class="n">frontscanind</span><span class="p">,</span><span class="n">backscan</span><span class="o">=</span><span class="n">backscanind</span><span class="p">,</span><span class="n">accuracy</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>                
                <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;AnalysisObj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1"># problem with file. TODO: only catch specific error types here.</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Index: </span><span class="si">{}</span><span class="s1">. Problem with file. Error: </span><span class="si">{}</span><span class="s1">. Skipping&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">e</span><span class="p">),</span> <span class="ne">Warning</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1">#combine cumulative front and back irradiance for each tracker angle</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1">#on error, trackerdict[index] is returned empty</span>
                <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Front</span>
                <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Back</span>
                <span class="n">trackerdict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;backRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">backRatio</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span>  <span class="n">e</span><span class="p">:</span>  <span class="c1"># no key Wm2Front.</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Index: </span><span class="si">{}</span><span class="s1">. Trackerdict key not found: </span><span class="si">{}</span><span class="s1">. Skipping&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">e</span><span class="p">),</span> <span class="ne">Warning</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">frontWm2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># define frontWm2 the first time through</span>
                <span class="n">frontWm2</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Front</span><span class="p">)</span>
                <span class="n">backWm2</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Back</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frontWm2</span> <span class="o">+=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Front</span><span class="p">)</span>
                <span class="n">backWm2</span> <span class="o">+=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Back</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Index: </span><span class="si">{}</span><span class="s1">. Wm2Front: </span><span class="si">{}</span><span class="s1">. Wm2Back: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Front</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Back</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span> <span class="o">=</span> <span class="n">frontWm2</span>   <span class="c1"># these are accumulated over all indices passed in.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span> <span class="o">=</span> <span class="n">backWm2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span> <span class="o">+=</span> <span class="n">frontWm2</span>   <span class="c1"># these are accumulated over all indices passed in.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span> <span class="o">+=</span> <span class="n">backWm2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backRatio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">backWm2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">frontWm2</span><span class="o">+</span><span class="mf">.001</span><span class="p">)</span>

        <span class="c1"># Save compiled results using _saveresults</span>
        <span class="k">if</span> <span class="n">singleindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Saving a cumulative-results file in the main simulation folder.&quot;</span> <span class="o">+</span>
                   <span class="s2">&quot;This adds up by sensor location the irradiance over all hours &quot;</span> <span class="o">+</span>
                   <span class="s2">&quot;or configurations considered.&quot;</span> <span class="o">+</span>
                   <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: This file saving routine does not clean results, so &quot;</span><span class="o">+</span>
                   <span class="s2">&quot;if your setup has ygaps, or 2+modules or torque tubes, doing &quot;</span><span class="o">+</span>
                   <span class="s2">&quot;a deeper cleaning and working with the individual results &quot;</span><span class="o">+</span>
                   <span class="s2">&quot;files in the results folder is highly suggested.&quot;</span><span class="p">)</span>
            <span class="n">cumfilename</span> <span class="o">=</span> <span class="s1">&#39;cumulative_results_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">customname</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> 
                <span class="n">frontcum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">rearcum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">temptrackerdict</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;AnalysisObj&#39;</span><span class="p">]</span>
                <span class="c1">#temptrackerdict = trackerdict[0.0][&#39;AnalysisObj&#39;]</span>
                <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">x</span>
                <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">y</span>
                <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">z</span>
                <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">mattype</span>
                <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span>
                <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">x</span>
                <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">x</span>
                <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">rearZ</span>
                <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temptrackerdict</span><span class="o">.</span><span class="n">rearMat</span>
                <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span>
                <span class="n">cumanalysisobj</span> <span class="o">=</span> <span class="n">AnalysisObj</span><span class="p">()</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Saving Cumulative results&quot;</span> <span class="p">)</span>
                <span class="n">cumanalysisobj</span><span class="o">.</span><span class="n">_saveResultsCumulative</span><span class="p">(</span><span class="n">frontcum</span><span class="p">,</span> <span class="n">rearcum</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="n">cumfilename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># trackerkeys are day/hour/min, and there&#39;s no easy way to find a </span>
                <span class="c1"># tilt of 0, so making a fake linepoint object for tilt 0 </span>
                <span class="c1"># and then saving.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cumscene</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">trackerkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span>
                    <span class="n">cumscene</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">cumscene</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hub_height</span>
                    <span class="n">cumanalysisobj</span> <span class="o">=</span> <span class="n">AnalysisObj</span><span class="p">()</span>
                    <span class="n">frontscancum</span><span class="p">,</span> <span class="n">backscancum</span> <span class="o">=</span> <span class="n">cumanalysisobj</span><span class="o">.</span><span class="n">moduleAnalysis</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="n">cumscene</span><span class="p">,</span> <span class="n">modWanted</span><span class="o">=</span><span class="n">modWanted</span><span class="p">,</span> 
                                                <span class="n">rowWanted</span><span class="o">=</span><span class="n">rowWanted</span><span class="p">,</span> 
                                                <span class="n">sensorsy</span><span class="o">=</span><span class="n">sensorsy</span><span class="p">,</span> 
                                                <span class="n">sensorsx</span><span class="o">=</span><span class="n">sensorsx</span><span class="p">,</span>
                                                <span class="n">modscanfront</span><span class="o">=</span><span class="n">modscanfront</span><span class="p">,</span> <span class="n">modscanback</span><span class="o">=</span><span class="n">modscanback</span><span class="p">,</span>
                                                <span class="n">relative</span><span class="o">=</span><span class="n">relative</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
                    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">cumanalysisobj</span><span class="o">.</span><span class="n">_linePtsArray</span><span class="p">(</span><span class="n">frontscancum</span><span class="p">)</span>
                    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">rearz</span> <span class="o">=</span> <span class="n">cumanalysisobj</span><span class="o">.</span><span class="n">_linePtsArray</span><span class="p">(</span><span class="n">backscancum</span><span class="p">)</span>
        
                    <span class="n">frontcum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                    <span class="n">rearcum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                    <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                    <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
                    <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">trackerkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;AnalysisObj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mattype</span>
                    <span class="n">frontcum</span> <span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span>
                    <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                    <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rearz</span>
                    <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackerdict</span><span class="p">[</span><span class="n">trackerkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;AnalysisObj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rearMat</span>
                    <span class="n">rearcum</span> <span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Saving Cumulative results&quot;</span> <span class="p">)</span>
                    <span class="n">cumanalysisobj</span><span class="o">.</span><span class="n">_saveResultsCumulative</span><span class="p">(</span><span class="n">frontcum</span><span class="p">,</span> <span class="n">rearcum</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="n">cumfilename</span><span class="p">)</span>            
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not able to save a cumulative result for this simulation.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trackerdict</span></div></div>



<span class="c1"># End RadianceObj definition</span>

<div class="viewcode-block" id="GroundObj"><a class="viewcode-back" href="../../generated/bifacial_radiance.GroundObj.html#bifacial_radiance.GroundObj">[docs]</a><span class="k">class</span> <span class="nc">GroundObj</span><span class="p">(</span><span class="n">SuperClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to set and return details for the ground surface materials and reflectance.</span>
<span class="sd">    If 1 albedo value is passed, it is used as default.</span>
<span class="sd">    If 3 albedo values are passed, they are assigned to each of the three wavelength placeholders (RGB),</span>
<span class="sd">    </span>
<span class="sd">    If material type is known, it is used to get reflectance info.  </span>
<span class="sd">    if material type isn&#39;t known, material_info.list is returned</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    materialOrAlbedo : numeric or str</span>
<span class="sd">        If number between 0 and 1 is passed, albedo input is assumed and assigned.    </span>
<span class="sd">        If string is passed with the name of the material desired. e.g. &#39;litesoil&#39;,</span>
<span class="sd">        properties are searched in `material_file`.</span>
<span class="sd">        Default Material names to choose from: litesoil, concrete, white_EPDM, </span>
<span class="sd">        beigeroof, beigeroof_lite, beigeroof_heavy, black, asphalt</span>
<span class="sd">    material_file : str</span>
<span class="sd">        Filename of the material information. Default `ground.rad`</span>
<span class="sd">    silent       :  bool   </span>
<span class="sd">        suppress print statements. Default False  </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
   
<div class="viewcode-block" id="GroundObj.__init__"><a class="viewcode-back" href="../../generated/bifacial_radiance.GroundObj.html#bifacial_radiance.GroundObj.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materialOrAlbedo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">material_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">normval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReflAvg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rrefl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Grefl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Brefl</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ground_type</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>        

        <span class="k">if</span> <span class="n">material_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">material_file</span> <span class="o">=</span> <span class="s1">&#39;ground.rad&#39;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">material_file</span> <span class="o">=</span> <span class="n">material_file</span>           
        <span class="k">if</span> <span class="n">materialOrAlbedo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Case where it&#39;s none.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Input albedo 0-1, or string from ground.printGroundMaterials().&#39;</span>
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Alternatively, run setGround after readWeatherData()&#39;</span>
            <span class="s1">&#39;and setGround will read metdata.albedo if available&#39;</span><span class="p">)</span>
            <span class="k">return</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ground_type</span> <span class="o">=</span> <span class="n">materialOrAlbedo</span>  
            <span class="c1"># Return the RGB albedo for material ground_type</span>
            <span class="n">materialOrAlbedo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printGroundMaterials</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ground_type</span><span class="p">)</span>
            
        <span class="c1"># Check for double and int. </span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">materialOrAlbedo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">materialOrAlbedo</span><span class="p">,</span> 
                                          <span class="n">materialOrAlbedo</span><span class="p">,</span> <span class="n">materialOrAlbedo</span><span class="p">]])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">materialOrAlbedo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">)</span>
        
        <span class="c1"># By this point, materialOrAlbedo should be a np.ndarray:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">materialOrAlbedo</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># numpy array of one single value, i.e. np.array(0.62)</span>
            <span class="c1"># after this if, np.array([0.62])</span>
                <span class="n">materialOrAlbedo</span> <span class="o">=</span> <span class="n">materialOrAlbedo</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">materialOrAlbedo</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># If np.array is ([0.62]), this repeats it so at the end it&#39;s</span>
            <span class="c1"># np.array ([0.62, 0.62, 0.62])</span>
                <span class="n">materialOrAlbedo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">materialOrAlbedo</span><span class="p">]),</span> 
                                             <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                                                     <span class="nb">len</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">materialOrAlbedo</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">materialOrAlbedo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">):</span> 
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Radiance only raytraces 3 wavelengths at &quot;</span>
                                  <span class="s2">&quot;a time. Trimming albedo np.array input to &quot;</span>
                                  <span class="s2">&quot;3 wavelengths.&quot;</span><span class="p">)</span>
                    <span class="n">materialOrAlbedo</span> <span class="o">=</span> <span class="n">materialOrAlbedo</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="c1"># By this point we should have np.array of dim=2 and shape[1] = 3.        </span>
        <span class="c1"># Check for invalid values</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">materialOrAlbedo</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">materialOrAlbedo</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: albedo values greater than 1 or less than 0. &#39;</span>
                      <span class="s1">&#39;Constraining to [0..1]&#39;</span><span class="p">)</span>
            <span class="n">materialOrAlbedo</span> <span class="o">=</span> <span class="n">materialOrAlbedo</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rrefl</span> <span class="o">=</span> <span class="n">materialOrAlbedo</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Grefl</span> <span class="o">=</span> <span class="n">materialOrAlbedo</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Brefl</span> <span class="o">=</span> <span class="n">materialOrAlbedo</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normval</span> <span class="o">=</span> <span class="n">_normRGB</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">materialOrAlbedo</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">materialOrAlbedo</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReflAvg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">materialOrAlbedo</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading albedo, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ReflAvg</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="si">}</span><span class="s1"> value(s), &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonzeromean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ReflAvg</span><span class="p">)</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1"> avg</span><span class="se">\n</span><span class="s1">&#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ReflAvg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ReflAvg</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="si">}</span><span class="s1"> nonzero albedo values.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;albedo.shape should be 3 column (N x 3)&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span></div>
    
    <span class="k">def</span> <span class="nf">printGroundMaterials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materialString</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        printGroundMaterials(materialString=None)</span>
<span class="sd">        </span>
<span class="sd">        input: None or materialString.  If None, return list of acceptable</span>
<span class="sd">        material types from ground.rad.  If valid string, return RGB albedo</span>
<span class="sd">        of the material type selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">material_path</span> <span class="o">=</span> <span class="s1">&#39;materials&#39;</span>
        
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">material_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_file</span><span class="p">))</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#list of material key names</span>
        <span class="n">Rreflall</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Greflall</span><span class="o">=</span><span class="p">[];</span> <span class="n">Breflall</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#RGB material reflectance  </span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1">#return indices for &#39;plastic&#39; definition</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">_findme</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="s1">&#39;plastic&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="c1"># after plastic comes the material name</span>
            <span class="n">Rreflall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]))</span><span class="c1">#RGB reflectance comes a few more down the list</span>
            <span class="n">Greflall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">]))</span>
            <span class="n">Breflall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">]))</span>
        
        <span class="k">if</span> <span class="n">materialString</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">_findme</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">materialString</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Error - materialString not in &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">material_file</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">materialString</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Rreflall</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">Greflall</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">Breflall</span><span class="p">[</span><span class="n">index</span><span class="p">]]]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">_nonzeromean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;  array mean excluding zero. return zero if everything&#39;s zero&#39;&#39;&#39;</span>
        <span class="n">tempmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tempmean</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tempmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">val</span> <span class="o">!=</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tempmean</span>     
        
    <span class="k">def</span> <span class="nf">_makeGroundString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cumulativesky</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        create string with ground reflectance parameters for use in </span>
<span class="sd">        gendaylit and gencumsky.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        index : integer</span>
<span class="sd">            Index of time for time-series albedo. Default 0</span>
<span class="sd">        cumulativesky:  Boolean</span>
<span class="sd">            If true, set albedo to average of time series values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        groundstring:  text with albedo details to append to sky.rad in</span>
<span class="sd">                       gendaylit</span>
<span class="sd">        &#39;&#39;&#39;</span>
         
        
        <span class="k">try</span><span class="p">:</span>  
            <span class="k">if</span> <span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">Rrefl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonzeromean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rrefl</span><span class="p">)</span> 
                <span class="n">Grefl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonzeromean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Grefl</span><span class="p">)</span> 
                <span class="n">Brefl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonzeromean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Brefl</span><span class="p">)</span>
                <span class="n">normval</span> <span class="o">=</span> <span class="n">_normRGB</span><span class="p">(</span><span class="n">Rrefl</span><span class="p">,</span> <span class="n">Grefl</span><span class="p">,</span> <span class="n">Brefl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Rrefl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rrefl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">Grefl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Grefl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">Brefl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Brefl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">normval</span> <span class="o">=</span> <span class="n">_normRGB</span><span class="p">(</span><span class="n">Rrefl</span><span class="p">,</span> <span class="n">Grefl</span><span class="p">,</span> <span class="n">Brefl</span><span class="p">)</span>

            <span class="c1"># Check for all zero albedo case</span>
            <span class="k">if</span> <span class="n">normval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">normval</span> <span class="o">=</span> <span class="mi">1</span>
            
            <span class="n">groundstring</span> <span class="o">=</span> <span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">skyfunc glow ground_glow</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">4 &#39;</span> 
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Rrefl</span><span class="o">/</span><span class="n">normval</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">Grefl</span><span class="o">/</span><span class="n">normval</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">Brefl</span><span class="o">/</span><span class="n">normval</span><span class="si">}</span><span class="s1"> 0</span><span class="se">\n</span><span class="s1">&#39;</span> 
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ground_glow source ground</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">4 0 0 -1 180</span><span class="se">\n</span><span class="s1">&#39;</span> 
                <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">void plastic </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ground_type</span><span class="si">}</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">5 &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Rrefl</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">Grefl</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">Brefl</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1"> 0 0</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ground_type</span><span class="si">}</span><span class="s2"> ring groundplane</span><span class="se">\n</span><span class="s2">&quot;</span> 
                <span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">8</span><span class="se">\n</span><span class="s1">0 0 -.01</span><span class="se">\n</span><span class="s1">0 0 1</span><span class="se">\n</span><span class="s1">0 100&#39;</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1"> passed to albedo with only &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Rrefl</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="si">}</span><span class="s1"> values.&#39;</span>   <span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span>
        <span class="k">return</span> <span class="n">groundstring</span></div>

        

<div class="viewcode-block" id="SceneObj"><a class="viewcode-back" href="../../generated/bifacial_radiance.SceneObj.html#bifacial_radiance.SceneObj">[docs]</a><span class="k">class</span> <span class="nc">SceneObj</span><span class="p">(</span><span class="n">SuperClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scene information including PV module type, bifaciality, array info</span>
<span class="sd">    pv module orientation defaults: Azimuth = 180 (south)</span>
<span class="sd">    pv module origin: z = 0 bottom of frame. y = 0 lower edge of frame. </span>
<span class="sd">    x = 0 vertical centerline of module</span>

<span class="sd">    scene includes module details (x,y,bifi, sceney (collector_width), scenex)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    module : str or ModuleObj</span>
<span class="sd">            String name of module created with makeModule()</span>
<span class="sd">    name : str</span>
<span class="sd">           Identifier of scene in case of multiple scenes. Default `Scene0&#39;.</span>
<span class="sd">           Automatically increments if makeScene is run multiple times.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="SceneObj.__init__"><a class="viewcode-back" href="../../generated/bifacial_radiance.SceneObj.html#bifacial_radiance.SceneObj.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; initialize SceneObj</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">bifacial_radiance</span> <span class="kn">import</span> <span class="n">ModuleObj</span>
        <span class="c1"># should sceneDict be initialized here? This is set in _makeSceneNxR</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">ModuleObj</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>


        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="o">==</span> <span class="n">ModuleObj</span><span class="p">:</span> <span class="c1"># try moduleObj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>

        <span class="c1">#self.moduleDict = self.module.getDataDict()</span>
        <span class="c1">#self.scenex = self.module.scenex</span>
        <span class="c1">#self.sceney = self.module.sceney</span>
        <span class="c1">#self.offsetfromaxis = self.moduleDict[&#39;offsetfromaxis&#39;]</span>
        <span class="c1">#TODO: get rid of these 4 values</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">modulefile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">modulefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#default False.  Set True by makeScene after sceneobj created.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Scene0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

    <span class="k">def</span> <span class="nf">_makeSceneNxR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modulename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sceneDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">addhubheight</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arrange module defined in :py:class:`bifacial_radiance.SceneObj` into a N x R array.</span>
<span class="sd">        Returns a :py:class:`bifacial_radiance.SceneObj` which contains details </span>
<span class="sd">        of the PV system configuration including `tilt`, `row pitch`, `hub_height`</span>
<span class="sd">        or `clearance_height`, `nMod`s per row, `nRows` in the system.</span>

<span class="sd">        The returned scene has (0,0) coordinates centered at the module at the</span>
<span class="sd">        center of the array. For 5 rows, that is row 3, for 4 rows, that is</span>
<span class="sd">        row 2 also (rounds down). For 5 modules in the row, that is module 3,</span>
<span class="sd">        for 4 modules in the row, that is module 2 also (rounds down)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        modulename: str </span>
<span class="sd">            Name of module created with :py:class:`~bifacial_radiance.RadianceObj.makeModule`.</span>
<span class="sd">        sceneDict : dictionary </span>
<span class="sd">            Dictionary of scene parameters.</span>
<span class="sd">                clearance_height : numeric</span>
<span class="sd">                    (meters). </span>
<span class="sd">                pitch : numeric</span>
<span class="sd">                    Separation between rows</span>
<span class="sd">                tilt : numeric </span>
<span class="sd">                    Valid input ranges -90 to 90 degrees</span>
<span class="sd">                azimuth : numeric </span>
<span class="sd">                    A value denoting the compass direction along which the</span>
<span class="sd">                    axis of rotation lies. Measured in decimal degrees East</span>
<span class="sd">                    of North. [0 to 180) possible.</span>
<span class="sd">                nMods : int </span>
<span class="sd">                    Number of modules per row (default = 20)</span>
<span class="sd">                nRows : int </span>
<span class="sd">                    Number of rows in system (default = 7)</span>
<span class="sd">        radname : str</span>
<span class="sd">            String for name for radfile.</span>
<span class="sd">        addhubheight : Bool, default False</span>
<span class="sd">            Add hubheight back to the sceneDict since it was stripped out </span>
<span class="sd">            by makeScene1axis</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        radfile : str</span>
<span class="sd">             Filename of .RAD scene in /objects/</span>
<span class="sd">        scene : :py:class:`~bifacial_radiance.SceneObj `</span>
<span class="sd">             Returns a `SceneObject` &#39;scene&#39; with configuration details</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">copy</span>
        
        <span class="k">if</span> <span class="n">modulename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modulename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">sceneDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;makeScene(modulename, sceneDict, nMods, nRows).  sceneDict&#39;</span>
                  <span class="s1">&#39; inputs: .tilt .azimuth .nMods .nRows&#39;</span> 
                  <span class="s1">&#39; AND .tilt or .gcr ; AND .hub_height or .clearance_height&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">sceneDict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">)</span>


        <span class="k">if</span> <span class="s1">&#39;orientation&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> ERROR: Orientation format has been &#39;</span>
                <span class="s1">&#39;deprecated since version 0.2.4. If you want to flip your &#39;</span>
                <span class="s1">&#39;modules, on makeModule switch the x and y values.</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;azimuth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span>

        <span class="k">if</span> <span class="s1">&#39;axis_tilt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;axis_tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="s1">&#39;originx&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;originx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="s1">&#39;originy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;originy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">radname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">radname</span> <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="c1"># loading variables</span>
        <span class="n">tilt</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span>
        <span class="n">azimuth</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span>
        <span class="n">nMods</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nMods&#39;</span><span class="p">]</span>
        <span class="n">nRows</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nRows&#39;</span><span class="p">]</span>
        <span class="n">axis_tilt</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;axis_tilt&#39;</span><span class="p">]</span>
        <span class="n">originx</span> <span class="o">=</span> <span class="n">sceneDict</span> <span class="p">[</span><span class="s1">&#39;originx&#39;</span><span class="p">]</span>
        <span class="n">originy</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;originy&#39;</span><span class="p">]</span>

        <span class="c1"># hub_height, clearance_height and height logic.</span>
        <span class="c1"># this routine uses hub_height to move the panels up so it&#39;s important </span>
        <span class="c1"># to have a value for that, either obtianing from clearance_height </span>
        <span class="c1"># (if coming from makeScene) or from hub_height itself.</span>
        <span class="c1"># it is assumed that if no clearance_height or hub_height is passed,</span>
        <span class="c1"># hub_height = height.</span>

        
        <span class="n">sceneDict</span><span class="p">,</span> <span class="n">use_clearanceheight</span>  <span class="o">=</span> <span class="n">_heightCasesSwitcher</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">,</span> <span class="n">preferred</span><span class="o">=</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> 
                                                     <span class="n">nonpreferred</span><span class="o">=</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">use_clearanceheight</span> <span class="p">:</span>
            <span class="n">hubheight</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> \
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sceney</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">offsetfromaxis</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

            <span class="n">title_clearance_height</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">]</span> 
            <span class="k">if</span> <span class="n">addhubheight</span><span class="p">:</span>
                <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hubheight</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hubheight</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span> 
            <span class="c1"># this calculates clearance_height, used for the title</span>
            <span class="n">title_clearance_height</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> \
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sceney</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">offsetfromaxis</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">pitch</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;default to gcr&#39;</span><span class="p">)</span>
            
        <span class="k">except</span><span class="p">:</span>

            <span class="k">if</span> <span class="s1">&#39;gcr&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
                <span class="n">pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sceney</span><span class="o">/</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;gcr&#39;</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No valid `pitch` or `gcr` in sceneDict&#39;</span><span class="p">)</span>



<span class="w">        </span><span class="sd">&#39;&#39;&#39; INITIALIZE VARIABLES &#39;&#39;&#39;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;!xform &#39;</span>

        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;-rx </span><span class="si">%s</span><span class="s1"> -t </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hubheight</span><span class="p">)</span>
        
        <span class="c1"># create nMods-element array along x, nRows along y. 1cm module gap.</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;-a </span><span class="si">%s</span><span class="s1"> -t </span><span class="si">%s</span><span class="s1"> 0 0 -a </span><span class="si">%s</span><span class="s1"> -t 0 </span><span class="si">%s</span><span class="s1"> 0 &#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">nMods</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">scenex</span><span class="p">,</span> <span class="n">nRows</span><span class="p">,</span> <span class="n">pitch</span><span class="p">)</span>

        <span class="c1"># azimuth rotation of the entire shebang. Select the row to scan here based on y-translation.</span>
        <span class="c1"># Modifying so center row is centered in the array. (i.e. 3 rows, row 2. 4 rows, row 2 too)</span>
        <span class="c1"># Since the array is already centered on row 1, module 1, we need to increment by Nrows/2-1 and Nmods/2-1</span>

        <span class="n">text</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-i 1 -t </span><span class="si">{</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">scenex</span><span class="o">*</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nMods</span><span class="o">/</span><span class="mf">1.999</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1"> &#39;</span>
                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="o">-</span><span class="n">pitch</span><span class="o">*</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nRows</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.999</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1"> 0 -rz </span><span class="si">{</span><span class="mi">180</span><span class="o">-</span><span class="n">azimuth</span><span class="si">}</span><span class="s1"> &#39;</span>
                 <span class="sa">f</span><span class="s1">&#39;-t </span><span class="si">{</span><span class="n">originx</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">originy</span><span class="si">}</span><span class="s1"> 0 &#39;</span> <span class="p">)</span>
        
        <span class="c1">#axis tilt only working for N-S trackers</span>
        <span class="k">if</span> <span class="n">axis_tilt</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">azimuth</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>  
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Axis_Tilt is still under development. The scene will be &quot;</span>
                  <span class="s2">&quot;created with the proper axis tilt, and the tracking angle&quot;</span>
                  <span class="s2">&quot;will consider the axis_tilt, but the sensors for the &quot;</span>
                  <span class="s2">&quot;analysis might not fall in the correct surfaces unless you&quot;</span>
                  <span class="s2">&quot; manually position them for this version. Sorry! :D &quot;</span><span class="p">)</span>
                  
            <span class="n">text</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-rx </span><span class="si">{</span><span class="n">axis_tilt</span><span class="si">}</span><span class="s1"> -t 0 0 %s &#39;</span> <span class="o">%</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">scenex</span><span class="o">*</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nMods</span><span class="o">/</span><span class="mf">1.99</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                        <span class="n">axis_tilt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">radname</span><span class="si">}</span><span class="s1">_C_</span><span class="si">{</span><span class="n">title_clearance_height</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">_rtr_</span><span class="si">{</span><span class="n">pitch</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">_tilt_</span><span class="si">{</span><span class="n">tilt</span><span class="si">:</span><span class="s1">0.0f</span><span class="si">}</span><span class="s1">_&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">nMods</span><span class="si">}</span><span class="s1">modsx</span><span class="si">{</span><span class="n">nRows</span><span class="si">}</span><span class="s1">rows_origin</span><span class="si">{</span><span class="n">originx</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">originy</span><span class="si">}</span><span class="s1">.rad&#39;</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">modulefile</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="n">radfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;objects&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modulefile</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="n">radfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;objects&#39;</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># py2 and 3 compatible: binary write, encode text first</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">radfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sceney</span> <span class="o">/</span> <span class="n">pitch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span> <span class="o">=</span> <span class="n">radfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sceneDict</span> <span class="o">=</span> <span class="n">sceneDict</span>
<span class="c1">#        self.hub_height = hubheight</span>
        <span class="k">return</span> <span class="n">radfile</span>
    
   
<div class="viewcode-block" id="SceneObj.showScene"><a class="viewcode-back" href="../../generated/bifacial_radiance.SceneObj.showScene.html#bifacial_radiance.SceneObj.showScene">[docs]</a>    <span class="k">def</span> <span class="nf">showScene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Method to call objview on the scene included in self</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;objview </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">,</span> <span class="s1">&#39;ground.rad&#39;</span><span class="p">),</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rendering scene. This may take a moment...&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;possible solution: install radwinexe binary package from &#39;</span>
                  <span class="s1">&#39;http://www.jaloxa.eu/resources/radiance/radwinexe.shtml&#39;</span>
                  <span class="s1">&#39; into your RADIANCE binaries path&#39;</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="SceneObj.saveImage"><a class="viewcode-back" href="../../generated/bifacial_radiance.SceneObj.saveImage.html#bifacial_radiance.SceneObj.saveImage">[docs]</a>    <span class="k">def</span> <span class="nf">saveImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save an image of the scene to /images/. A default ground (concrete material) </span>
<span class="sd">        and sun (due East or West azimuth and 65 elevation) are created. </span>

<span class="sd">        Parameters:    </span>
<span class="sd">            filename : string, optional. name for image file, defaults to scene name</span>
<span class="sd">            view     : string, optional.  name for view file in /views. default to &#39;side.vp&#39;  </span>
<span class="sd">                      Input of &#39;XYZ&#39; into view will do a zoomed out view of the whole scene              </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tempfile</span>
        
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
            
        <span class="k">if</span> <span class="n">view</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">view</span> <span class="o">=</span> <span class="s1">&#39;side.vp&#39;</span>

        <span class="c1"># fake lighting temporary .radfile.  Use 65 elevation and +/- 90 azimuth</span>
        <span class="c1"># use a concrete ground surface</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">100</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">sunaz</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sunaz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">ground</span> <span class="o">=</span> <span class="n">GroundObj</span><span class="p">(</span><span class="s1">&#39;concrete&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
        <span class="n">ltfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;lt</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s1">.rad&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ltfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;!gensky -ang </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> +s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="n">sunaz</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s2">&quot;skyfunc glow sky_mat</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">4 1 1 1 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">sky_mat source sky</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">4 0 0 1 180</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="n">ground</span><span class="o">.</span><span class="n">_makeGroundString</span><span class="p">()</span> <span class="p">)</span>
        
        <span class="c1"># make .rif and run RAD</span>
        <span class="n">riffile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ov</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s1">.rif&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">riffile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;scene= materials/ground.rad &quot;</span> <span class="o">+</span>\
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">radfiles</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">ltfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span>\
                    <span class="sa">f</span><span class="s2">&quot;EXPOSURE= .5</span><span class="se">\n</span><span class="s2">UP= Z</span><span class="se">\n</span><span class="s2">view= </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.vp&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> -vf views/</span><span class="si">{</span><span class="n">view</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
                    <span class="sa">f</span><span class="s2">&quot;oconv= -f</span><span class="se">\n</span><span class="s2">PICT= images/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">([</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span><span class="n">riffile</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scene image saved: images/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.vp&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.hdr&quot;</span><span class="p">)</span>
        
        <span class="n">temp_dir</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span></div></div>

<span class="c1"># end of SceneObj</span>


        
<div class="viewcode-block" id="MetObj"><a class="viewcode-back" href="../../generated/bifacial_radiance.MetObj.html#bifacial_radiance.MetObj">[docs]</a><span class="k">class</span> <span class="nc">MetObj</span><span class="p">(</span><span class="n">SuperClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Meteorological data from EPW file.</span>

<span class="sd">    Initialize the MetObj from tmy data already read in. </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    tmydata : DataFrame</span>
<span class="sd">        TMY3 output from :py:class:`~bifacial_radiance.RadianceObj.readTMY` or </span>
<span class="sd">        from :py:class:`~bifacial_radiance.RadianceObj.readEPW`.</span>
<span class="sd">    metadata : Dictionary</span>
<span class="sd">        Metadata output from output from :py:class:`~bifacial_radiance.RadianceObj.readTMY`` </span>
<span class="sd">        or from :py:class:`~bifacial_radiance.RadianceObj.readEPW`.</span>
<span class="sd">    label : str</span>
<span class="sd">        label : str</span>
<span class="sd">        &#39;left&#39;, &#39;right&#39;, or &#39;center&#39;. For data that is averaged, defines if the</span>
<span class="sd">        timestamp refers to the left edge, the right edge, or the center of the</span>
<span class="sd">        averaging interval, for purposes of calculating sunposition. For</span>
<span class="sd">        example, TMY3 data is right-labeled, so 11 AM data represents data from</span>
<span class="sd">        10 to 11, and sun position should be calculated at 10:30 AM.  Currently</span>
<span class="sd">        SAM and PVSyst use left-labeled interval data and NSRDB uses centered.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tmydata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ghi&#39;</span><span class="p">,</span> <span class="s1">&#39;dhi&#39;</span><span class="p">,</span> <span class="s1">&#39;dni&#39;</span><span class="p">,</span> <span class="s1">&#39;albedo&#39;</span><span class="p">,</span> <span class="s1">&#39;dewpoint&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;temp_air&#39;</span><span class="p">,</span> <span class="s1">&#39;wind_speed&#39;</span><span class="p">,</span> <span class="s1">&#39;meastracker_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;tracker_theta&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;surface_tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;surface_azimuth&#39;</span><span class="p">]</span> 
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">key</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="p">},</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;timezone&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;timezone&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span> 
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return metadata and tmydata stats...</span>
        <span class="kn">import</span> <span class="nn">io</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmydata</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">memory_usage</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
        <span class="n">tmyinfo</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;class &#39;bifacial_radiance.main.MetObj&#39;&gt;.metadata:</span><span class="se">\n</span><span class="s2">&quot;</span>\
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="se">\n</span><span class="s2">&lt;class &#39;bifacial_radiance.main.MetObj&#39;&gt;.tmydata:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">tmyinfo</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="MetObj.__init__"><a class="viewcode-back" href="../../generated/bifacial_radiance.MetObj.html#bifacial_radiance.MetObj.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmydata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">):</span>

        <span class="kn">import</span> <span class="nn">pytz</span>
        <span class="kn">import</span> <span class="nn">pvlib</span>
        <span class="c1">#import numpy as np</span>
        
        <span class="c1">#First prune all GHI = 0 timepoints.  New as of 0.4.0</span>
        <span class="c1"># TODO: is this a good idea?  This changes default behavior...</span>
        <span class="n">tmydata</span> <span class="o">=</span> <span class="n">tmydata</span><span class="p">[</span><span class="n">tmydata</span><span class="o">.</span><span class="n">GHI</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1">#  location data.  so far needed:</span>
        <span class="c1"># latitude, longitude, elevation, timezone, city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">];</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">];</span> <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">];</span> <span class="n">elev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;TZ&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="c1"># readepw version</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">]</span> <span class="c1"># pvlib version</span>
        <span class="c1">#self.location.state_province_region = metadata[&#39;State&#39;] # unecessary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">tmydata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># this is tz-aware.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ghi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">GHI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dhi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">DHI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">DNI</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="o">.</span><span class="n">Alb</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># no TMY albedo data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedo</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># Try and retrieve dewpoint and pressure</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dewpoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="p">[</span><span class="s1">&#39;temp_dew&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dewpoint</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="p">[</span><span class="s1">&#39;atmospheric_pressure&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_air</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="p">[</span><span class="s1">&#39;temp_air&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_air</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_air</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_air</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="p">[</span><span class="s1">&#39;DryBulb&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_air</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="p">[</span><span class="s1">&#39;wind_speed&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="p">[</span><span class="s1">&#39;Wspd&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="c1"># Try and retrieve TrackerAngle</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meastracker_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmydata</span><span class="p">[</span><span class="s1">&#39;Tracker Angle (degrees)&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meastracker_angle</span><span class="o">=</span> <span class="kc">None</span>
            
            
        <span class="c1">#v0.2.5: initialize MetObj with solpos, sunrise/set and corrected time</span>
        <span class="n">datetimetz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># make sure the data is tz-localized.</span>
            <span class="n">datetimetz</span> <span class="o">=</span> <span class="n">datetimetz</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">FixedOffset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span><span class="c1">#  use pytz.FixedOffset (in minutes)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># data is tz-localized already. Just put it in local time.</span>
            <span class="n">datetimetz</span> <span class="o">=</span> <span class="n">datetimetz</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">FixedOffset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>
        <span class="c1">#check for data interval. default 1h.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="n">datetimetz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">datetimetz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span> <span class="c1"># ISSUE: if 1 datapoint is passed, are we sure it&#39;s hourly data?</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: TMY interval was unable to be defined, so setting it to 1h.&quot;</span><span class="p">)</span>
        <span class="c1"># TODO:  Refactor this into a subfunction. first calculate minutedelta </span>
        <span class="c1"># based on label and interval (-30, 0, +30, +7.5 etc) then correct all.        </span>
        <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating Sun position for center labeled data, at exact timestamp in input Weather File&quot;</span><span class="p">)</span>
            <span class="n">sunup</span><span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">solarposition</span><span class="o">.</span><span class="n">sun_rise_set_transit_spa</span><span class="p">(</span><span class="n">datetimetz</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span> <span class="c1">#new for pvlib &gt;= 0.6.1</span>
            <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;corrected_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetimetz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">interval</span><span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating Sun position for Metdata that is right-labeled &quot;</span><span class="p">,</span> 
                          <span class="s2">&quot;with a delta of -30 mins. i.e. 12 is 11:30 sunpos&quot;</span><span class="p">)</span>
                    <span class="n">sunup</span><span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">solarposition</span><span class="o">.</span><span class="n">sun_rise_set_transit_spa</span><span class="p">(</span><span class="n">datetimetz</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span> <span class="c1">#new for pvlib &gt;= 0.6.1</span>
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval</span><span class="o">.</span><span class="n">seconds</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># default sun angle 30 minutes before timestamp</span>
                    <span class="c1"># vector update of minutedelta at sunrise</span>
                    <span class="n">sunrisemask</span> <span class="o">=</span> <span class="n">sunup</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">-</span><span class="mi">1</span><span class="o">==</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">sunrisemask</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="mi">60</span><span class="o">-</span><span class="p">(</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                    <span class="c1"># vector update of minutedelta at sunset</span>
                    <span class="n">sunsetmask</span> <span class="o">=</span> <span class="n">sunup</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">-</span><span class="mi">1</span><span class="o">==</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">sunsetmask</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="mi">60</span><span class="o">-</span><span class="p">(</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                    <span class="c1"># save corrected timestamp</span>
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;corrected_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sunup</span><span class="o">.</span><span class="n">index</span><span class="o">-</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        
                <span class="k">elif</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>        
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating Sun position for Metdata that is left-labeled &quot;</span><span class="p">,</span>
                          <span class="s2">&quot;with a delta of +30 mins. i.e. 12 is 12:30 sunpos.&quot;</span><span class="p">)</span>
                    <span class="n">sunup</span><span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">solarposition</span><span class="o">.</span><span class="n">sun_rise_set_transit_spa</span><span class="p">(</span><span class="n">datetimetz</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span> 
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval</span><span class="o">.</span><span class="n">seconds</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># default sun angle 30 minutes after timestamp</span>
                    <span class="c1"># vector update of minutedelta at sunrise</span>
                    <span class="n">sunrisemask</span> <span class="o">=</span> <span class="n">sunup</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">==</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">sunrisemask</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="mi">60</span><span class="o">+</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                    <span class="c1"># vector update of minutedelta at sunset</span>
                    <span class="n">sunsetmask</span> <span class="o">=</span> <span class="n">sunup</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">==</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">sunsetmask</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="mi">60</span><span class="o">+</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                    <span class="c1"># save corrected timestamp</span>
                    <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;corrected_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sunup</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;minutedelta&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: invalid weather label passed. Valid inputs: right, left or center&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minutedelta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval</span><span class="o">.</span><span class="n">seconds</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interval in weather data is less than 1 hr, calculating&quot;</span>
                      <span class="sa">f</span><span class="s2">&quot; Sun position with a delta of -</span><span class="si">{</span><span class="n">minutedelta</span><span class="si">}</span><span class="s2"> minutes.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;If you want no delta for sunposition, use &quot;</span>
                      <span class="s2">&quot;readWeatherFile( label=&#39;center&#39;).&quot;</span><span class="p">)</span>
                <span class="c1">#datetimetz=datetimetz-pd.Timedelta(minutes = minutedelta)   # This doesn&#39;t check for Sunrise or Sunset</span>
                <span class="c1">#sunup= pvlib.irradiance.solarposition.get_sun_rise_set_transit(datetimetz, lat, lon) # deprecated in pvlib 0.6.1</span>
                <span class="n">sunup</span><span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">solarposition</span><span class="o">.</span><span class="n">sun_rise_set_transit_spa</span><span class="p">(</span><span class="n">datetimetz</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span> <span class="c1">#new for pvlib &gt;= 0.6.1</span>
                <span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;corrected_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sunup</span><span class="o">.</span><span class="n">index</span><span class="o">-</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">minutedelta</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">solpos</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">solarposition</span><span class="o">.</span><span class="n">get_solarposition</span><span class="p">(</span><span class="n">sunup</span><span class="p">[</span><span class="s1">&#39;corrected_timestamp&#39;</span><span class="p">],</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">elev</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sunrisesetdata</span><span class="o">=</span><span class="n">sunup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span></div>


    <span class="k">def</span> <span class="nf">_set1axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">limit_angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">angledelta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                  <span class="n">backtrack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gcr</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">cumulativesky</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">fixed_tilt_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_tilt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">useMeasuredTrackerAngle</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up geometry for 1-axis tracking cumulativesky.  Solpos data</span>
<span class="sd">        already stored in `metdata.solpos`. Pull in tracking angle details from</span>
<span class="sd">        pvlib, create multiple 8760 metdata sub-files where datetime of met</span>
<span class="sd">        data matches the tracking angle.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        cumulativesky : bool</span>
<span class="sd">            Whether individual csv files are created</span>
<span class="sd">            with constant tilt angle for the cumulativesky approach.</span>
<span class="sd">            if false, the gendaylit tracking approach must be used.</span>
<span class="sd">        azimuth : numerical</span>
<span class="sd">            orientation axis of tracker torque tube. Default North-South (180 deg)</span>
<span class="sd">            For fixed tilt simulations  this is the orientation azimuth</span>
<span class="sd">        limit_angle : numerical</span>
<span class="sd">            +/- limit angle of the 1-axis tracker in degrees. Default 45</span>
<span class="sd">        angledelta : numerical</span>
<span class="sd">            Degree of rotation increment to parse irradiance bins.</span>
<span class="sd">            Default 5 degrees (0.4 % error for DNI).</span>
<span class="sd">            Other options: 4 (.25%), 2.5 (0.1%).</span>
<span class="sd">            (the smaller the angledelta, the more simulations)</span>
<span class="sd">        backtrack : bool</span>
<span class="sd">            Whether backtracking is enabled (default = True)</span>
<span class="sd">        gcr : float</span>
<span class="sd">            Ground coverage ratio for calculation backtracking. Defualt [1.0/3.0] </span>
<span class="sd">        axis_tilt : float</span>
<span class="sd">            Tilt of the axis. While it can be considered for the tracking calculation,</span>
<span class="sd">            the scene geometry creation of the trackers does not support tilte</span>
<span class="sd">            axis_trackers yet (but can be done manuallyish. See Tutorials)</span>
<span class="sd">        fixed_tilt_angle : numeric</span>
<span class="sd">            If passed, this changes to a fixed tilt simulation where each hour</span>
<span class="sd">            uses fixed_tilt_angle and azimuth as the tilt and azimuth</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        trackerdict : dictionary </span>
<span class="sd">            Keys for tracker tilt angles and</span>
<span class="sd">            list of csv metfile, and datetimes at that angle</span>
<span class="sd">            trackerdict[angle][&#39;csvfile&#39;;&#39;surf_azm&#39;;&#39;surf_tilt&#39;;&#39;UTCtime&#39;]</span>
<span class="sd">        metdata.solpos : dataframe</span>
<span class="sd">            Dataframe with output from pvlib solar position for each timestep</span>
<span class="sd">        metdata.sunrisesetdata :</span>
<span class="sd">            Pandas dataframe with sunrise, sunset and adjusted time data.</span>
<span class="sd">        metdata.tracker_theta : list</span>
<span class="sd">            Tracker tilt angle from pvlib for each timestep</span>
<span class="sd">        metdata.surface_tilt : list</span>
<span class="sd">            Tracker surface tilt angle from pvlib for each timestep</span>
<span class="sd">        metdata.surface_azimuth : list</span>
<span class="sd">            Tracker surface azimuth angle from pvlib for each timestep</span>
<span class="sd">        &quot;&quot;&quot;</span>
          
        <span class="c1">#axis_tilt = 0       # only support 0 tilt trackers for now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumulativesky</span> <span class="o">=</span> <span class="n">cumulativesky</span>   <span class="c1"># track whether we&#39;re using cumulativesky or gendaylit</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">angledelta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">angledelta</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># round angle to 5 degrees for cumulativesky</span>

        <span class="c1"># get 1-axis tracker angles for this location,</span>
        <span class="c1"># round to nearest &#39;angledelta&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meastracker_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">useMeasuredTrackerAngle</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tracking Data: Reading from provided Tracker Angles&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">meastracker_angle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">useMeasuredTrackerAngle</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">useMeasuredTrackerAngle</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Using Measured Tracker Angles was specified but DATA&quot;</span><span class="o">+</span>
                  <span class="s2">&quot; for trackers has not yet been assigned. &quot;</span><span class="o">+</span>
                  <span class="s2">&quot; Assign it by making it a column on your Weatherdata File &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;named &#39;Tracker Angle (degrees)&#39; and run ReadWeatherFile again&quot;</span><span class="p">)</span>

        <span class="n">trackingdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTrackingAngles</span><span class="p">(</span><span class="n">azimuth</span><span class="p">,</span>
                                               <span class="n">limit_angle</span><span class="p">,</span>
                                               <span class="n">angledelta</span><span class="p">,</span>
                                               <span class="n">axis_tilt</span> <span class="o">=</span> <span class="n">axis_tilt</span><span class="p">,</span>
                                               <span class="n">backtrack</span> <span class="o">=</span> <span class="n">backtrack</span><span class="p">,</span>
                                               <span class="n">gcr</span> <span class="o">=</span> <span class="n">gcr</span><span class="p">,</span>
                                               <span class="n">fixed_tilt_angle</span><span class="o">=</span><span class="n">fixed_tilt_angle</span><span class="p">,</span>
                                               <span class="n">useMeasuredTrackerAngle</span><span class="o">=</span><span class="n">useMeasuredTrackerAngle</span><span class="p">)</span>

        <span class="c1"># get list of unique rounded tracker angles</span>
        <span class="n">theta_list</span> <span class="o">=</span> <span class="n">trackingdata</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s1">&#39;theta_round&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cumulativesky</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># create a separate metfile for each unique tracker theta angle.</span>
            <span class="c1"># return dict of filenames and details</span>
            <span class="n">trackerdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeTrackerCSV</span><span class="p">(</span><span class="n">theta_list</span><span class="p">,</span><span class="n">trackingdata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># trackerdict uses timestamp as keys. return azimuth</span>
            <span class="c1"># and tilt for each timestamp</span>
            <span class="c1">#times = [str(i)[5:-12].replace(&#39;-&#39;,&#39;_&#39;).replace(&#39; &#39;,&#39;_&#39;) for i in self.datetime]</span>
            <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H%M&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span>
            <span class="c1">#trackerdict = dict.fromkeys(times)</span>
            <span class="n">trackerdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="p">:</span>
                <span class="c1"># remove NaN tracker theta from trackerdict</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ghi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracker_theta</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                    <span class="n">trackerdict</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                        <span class="s1">&#39;surf_azm&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;surf_tilt&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;theta&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tracker_theta</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;dni&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">dni</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;ghi&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ghi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;dhi&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">dhi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;temp_air&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_air</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="s1">&#39;wind_speed&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                        <span class="p">}</span>

        <span class="k">return</span> <span class="n">trackerdict</span>


    <span class="k">def</span> <span class="nf">_getTrackingAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">limit_angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
                           <span class="n">angledelta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_tilt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">backtrack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">gcr</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">fixed_tilt_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">useMeasuredTrackerAngle</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Helper subroutine to return 1-axis tracker tilt and azimuth data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        same as pvlib.tracking.singleaxis, plus:</span>
<span class="sd">        angledelta : degrees</span>
<span class="sd">            Angle to round tracker_theta to.  This is for</span>
<span class="sd">            cumulativesky simulations. Other input options: None (no </span>
<span class="sd">            rounding of tracker angle) </span>
<span class="sd">        fixed_tilt_angle : (Optional) degrees</span>
<span class="sd">            This changes to a fixed tilt simulation where each hour uses </span>
<span class="sd">            fixed_tilt_angle and azimuth as the tilt and azimuth</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrame with the following columns:</span>
<span class="sd">            * tracker_theta: The rotation angle of the tracker.</span>
<span class="sd">                tracker_theta = 0 is horizontal, and positive rotation angles </span>
<span class="sd">                are clockwise.</span>
<span class="sd">            * aoi: The angle-of-incidence of direct irradiance onto the</span>
<span class="sd">                rotated panel surface.</span>
<span class="sd">            * surface_tilt: The angle between the panel surface and the earth</span>
<span class="sd">                surface, accounting for panel rotation.</span>
<span class="sd">            * surface_azimuth: The azimuth of the rotated panel, determined by</span>
<span class="sd">                projecting the vector normal to the panel&#39;s surface to the </span>
<span class="sd">                earth&#39;s  surface.</span>
<span class="sd">            * &#39;theta_round&#39; : tracker_theta rounded to the nearest &#39;angledelta&#39;</span>
<span class="sd">            If no angledelta is specified, it is rounded to the nearest degree.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">pvlib</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="kn">from</span> <span class="nn">pvlib.irradiance</span> <span class="kn">import</span> <span class="n">aoi</span> 
        <span class="c1">#import numpy as np</span>
        <span class="c1">#import pandas as pd</span>
        
        <span class="n">solpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solpos</span>
        
        <span class="c1">#New as of 0.3.2:  pass fixed_tilt_angle and switches to FIXED TILT mode</span>

        <span class="k">if</span> <span class="n">fixed_tilt_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># system with fixed tilt = fixed_tilt_angle </span>
            <span class="n">surface_tilt</span><span class="o">=</span><span class="n">fixed_tilt_angle</span>
            <span class="n">surface_azimuth</span><span class="o">=</span><span class="n">azimuth</span> 
            <span class="c1"># trackingdata keys: &#39;tracker_theta&#39;, &#39;aoi&#39;, &#39;surface_azimuth&#39;, &#39;surface_tilt&#39;</span>
            <span class="n">trackingdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;tracker_theta&#39;</span><span class="p">:</span><span class="n">fixed_tilt_angle</span><span class="p">,</span>
                                         <span class="s1">&#39;aoi&#39;</span><span class="p">:</span><span class="n">aoi</span><span class="p">(</span><span class="n">surface_tilt</span><span class="p">,</span> <span class="n">surface_azimuth</span><span class="p">,</span>
                                                   <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;zenith&#39;</span><span class="p">],</span> 
                                                   <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]),</span>
                                         <span class="s1">&#39;surface_azimuth&#39;</span><span class="p">:</span><span class="n">azimuth</span><span class="p">,</span>
                                         <span class="s1">&#39;surface_tilt&#39;</span><span class="p">:</span><span class="n">fixed_tilt_angle</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">useMeasuredTrackerAngle</span><span class="p">:</span>           
            <span class="c1"># tracked system</span>
            <span class="n">surface_tilt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meastracker_angle</span>
            <span class="n">surface_azimuth</span><span class="o">=</span><span class="n">azimuth</span>

            <span class="n">trackingdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;tracker_theta&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">meastracker_angle</span><span class="p">,</span>
                                         <span class="s1">&#39;aoi&#39;</span><span class="p">:</span><span class="n">aoi</span><span class="p">(</span><span class="n">surface_tilt</span><span class="p">,</span> <span class="n">surface_azimuth</span><span class="p">,</span>
                                                   <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;zenith&#39;</span><span class="p">],</span> 
                                                   <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]),</span>
                                         <span class="s1">&#39;surface_azimuth&#39;</span><span class="p">:</span><span class="n">azimuth</span><span class="p">,</span>
                                         <span class="s1">&#39;surface_tilt&#39;</span><span class="p">:</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meastracker_angle</span><span class="p">)})</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get 1-axis tracker tracker_theta, surface_tilt and surface_azimuth</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
                <span class="n">trackingdata</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">tracking</span><span class="o">.</span><span class="n">singleaxis</span><span class="p">(</span><span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;zenith&#39;</span><span class="p">],</span>
                                                     <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">],</span>
                                                     <span class="n">axis_tilt</span><span class="p">,</span>
                                                     <span class="n">azimuth</span><span class="p">,</span>
                                                     <span class="n">limit_angle</span><span class="p">,</span>
                                                     <span class="n">backtrack</span><span class="p">,</span>
                                                     <span class="n">gcr</span><span class="p">)</span>
            
        <span class="c1"># save tracker tilt information to metdata.tracker_theta,</span>
        <span class="c1"># metdata.surface_tilt and metdata.surface_azimuth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;tracker_theta&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;surface_tilt&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;surface_azimuth&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># undo the  timestamp offset put in by solpos.</span>
        <span class="c1">#trackingdata.index = trackingdata.index + pd.Timedelta(minutes = 30)</span>
        <span class="c1"># It may not be exactly 30 minutes any more...</span>
        <span class="n">trackingdata</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrisesetdata</span><span class="o">.</span><span class="n">index</span>  <span class="c1">#this has the original time data in it</span>

        <span class="c1"># round tracker_theta to increments of angledelta for use in cumulativesky</span>
        <span class="k">def</span> <span class="nf">_roundArbitrary</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">angledelta</span><span class="p">):</span>
            <span class="c1"># round to nearest &#39;base&#39; value.</span>
            <span class="c1"># mask NaN&#39;s to avoid rounding error message</span>
            <span class="k">return</span> <span class="n">base</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">base</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">angledelta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s1">&#39;Angledelta = 0. Use None instead&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">angledelta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># don&#39;t round theta</span>
            <span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;theta_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;tracker_theta&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># round theta</span>
            <span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;theta_round&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">_roundArbitrary</span><span class="p">(</span><span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;tracker_theta&#39;</span><span class="p">],</span> <span class="n">angledelta</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">trackingdata</span>

    <span class="k">def</span> <span class="nf">_makeTrackerCSV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">trackingdata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create multiple new irradiance csv files with data for each unique</span>
<span class="sd">        rounded tracker angle. Return a dictionary with the new csv filenames</span>
<span class="sd">        and other details, Used for cumulativesky tracking</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        theta_list : array</span>
<span class="sd">             Array of unique tracker angle values</span>

<span class="sd">        trackingdata : Pandas </span>
<span class="sd">             Pandas Series with hourly tracker angles from</span>
<span class="sd">             :pvlib.tracking.singleaxis</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        trackerdict : dictionary</span>
<span class="sd">              keys: *theta_round tracker angle  (default: -45 to +45 in</span>
<span class="sd">                                                 5 degree increments).</span>
<span class="sd">              sub-array keys:</span>
<span class="sd">                  *datetime:  array of datetime strings in this group of angles</span>
<span class="sd">                  *count:  number of datapoints in this group of angles</span>
<span class="sd">                  *surf_azm:  tracker surface azimuth during this group of angles</span>
<span class="sd">                  *surf_tilt:  tilt angle average during this group of angles</span>
<span class="sd">                  *csvfile:  name of csv met data file saved in /EPWs/</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>

        <span class="n">trackerdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">theta_list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">trackerdict</span><span class="p">):</span>  
            <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">csvfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;EPWs&#39;</span><span class="p">,</span> <span class="s1">&#39;1axis_</span><span class="si">{}</span><span class="s1">.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
            <span class="n">tempdata</span> <span class="o">=</span> <span class="n">trackingdata</span><span class="p">[</span><span class="n">trackingdata</span><span class="p">[</span><span class="s1">&#39;theta_round&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">theta</span><span class="p">]</span>

            <span class="c1">#Set up trackerdict output for each value of theta</span>
            <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;csvfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csvfile</span>
            <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_azm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempdata</span><span class="p">[</span><span class="s1">&#39;surface_azimuth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;surf_tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">datetimetemp</span> <span class="o">=</span> <span class="n">tempdata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span> <span class="c1">#local time</span>
            <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetimetemp</span>
            <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetimetemp</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
            <span class="c1">#Create new temp csv file with zero values for all times not equal to datetimetemp</span>
            <span class="c1"># write 8760 2-column csv:  GHI,DHI</span>
            <span class="n">dni_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ghi_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dhi_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ghi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dhi</span><span class="p">,</span>
                                  <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)):</span>

                <span class="c1"># is this time included in a particular theta_round angle?</span>
                <span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">datetimetemp</span><span class="p">:</span>
                    <span class="n">ghi_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                    <span class="n">dhi_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># mask out irradiance at this time, since it</span>
                    <span class="c1"># belongs to a different bin</span>
                    <span class="n">ghi_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">dhi_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="c1"># save in 2-column GHI,DHI format for gencumulativesky -G</span>
            <span class="n">savedata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;GHI&#39;</span><span class="p">:</span><span class="n">ghi_temp</span><span class="p">,</span> <span class="s1">&#39;DHI&#39;</span><span class="p">:</span><span class="n">dhi_temp</span><span class="p">},</span>
                                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Fill partial year. Requires 2021 measurement year.</span>
            <span class="n">savedata</span> <span class="o">=</span> <span class="n">_subhourlydatatoGencumskyformat</span><span class="p">(</span><span class="n">savedata</span><span class="p">,</span> 
                                                       <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving file </span><span class="si">{}</span><span class="s1">, # points: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                  <span class="n">trackerdict</span><span class="p">[</span><span class="n">theta</span><span class="p">][</span><span class="s1">&#39;csvfile&#39;</span><span class="p">],</span> <span class="n">datetimetemp</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>

            <span class="n">savedata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span>
                            <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GHI&#39;</span><span class="p">,</span><span class="s1">&#39;DHI&#39;</span><span class="p">])</span>


        <span class="k">return</span> <span class="n">trackerdict</span></div>


<div class="viewcode-block" id="AnalysisObj"><a class="viewcode-back" href="../../generated/bifacial_radiance.AnalysisObj.html#bifacial_radiance.AnalysisObj">[docs]</a><span class="k">class</span> <span class="nc">AnalysisObj</span><span class="p">(</span><span class="n">SuperClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analysis class for performing raytrace to obtain irradiance measurements</span>
<span class="sd">    at the array, as well plotting and reporting results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__printval__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
                       
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">({</span><span class="n">key</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">__printval__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>  
<div class="viewcode-block" id="AnalysisObj.__init__"><a class="viewcode-back" href="../../generated/bifacial_radiance.AnalysisObj.html#bifacial_radiance.AnalysisObj.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hpc</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize AnalysisObj by pointing to the octfile.  Scan information</span>
<span class="sd">        is defined separately by passing scene details into AnalysisObj.moduleAnalysis()</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        octfile : string</span>
<span class="sd">            Filename and extension of .oct file</span>
<span class="sd">        name    :</span>
<span class="sd">        hpc     : boolean, default False. Waits for octfile for a</span>
<span class="sd">                  longer time if parallel processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">octfile</span> <span class="o">=</span> <span class="n">octfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span> <span class="o">=</span> <span class="n">hpc</span></div>

<div class="viewcode-block" id="AnalysisObj.makeImage"><a class="viewcode-back" href="../../generated/bifacial_radiance.AnalysisObj.makeImage.html#bifacial_radiance.AnalysisObj.makeImage">[docs]</a>    <span class="k">def</span> <span class="nf">makeImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewfile</span><span class="p">,</span> <span class="n">octfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a visible image (rendering) of octfile, viewfile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">time</span>

        <span class="k">if</span> <span class="n">octfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">octfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">octfile</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="c1">#TODO: update this for cross-platform compatibility w/ os.path.join</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span> <span class="p">:</span>
            <span class="n">time_to_wait</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">time_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">octfile</span><span class="p">,</span> <span class="s2">&quot;views/&quot;</span><span class="o">+</span><span class="n">viewfile</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">time_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">time_counter</span> <span class="o">&gt;</span> <span class="n">time_to_wait</span><span class="p">:</span><span class="k">break</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generating visible render of scene&#39;</span><span class="p">)</span>
        <span class="c1">#TODO: update this for cross-platform compatibility w os.path.join</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rpict -dp 256 -ar 48 -ms 1 -ds .2 -dj .9 -dt .1 &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;-dc .5 -dr 1 -ss 1 -st .1 -ab 3  -aa .1 &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;-ad 1536 -as 392 -av 25 25 25 -lr 8 -lw 1e-4 -vf views/&quot;</span>
                  <span class="o">+</span><span class="n">viewfile</span><span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">octfile</span> <span class="o">+</span>
                  <span class="s2">&quot; &gt; images/&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="n">viewfile</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;.hdr&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisObj.makeFalseColor"><a class="viewcode-back" href="../../generated/bifacial_radiance.AnalysisObj.makeFalseColor.html#bifacial_radiance.AnalysisObj.makeFalseColor">[docs]</a>    <span class="k">def</span> <span class="nf">makeFalseColor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewfile</span><span class="p">,</span> <span class="n">octfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a false-color plot of octfile, viewfile</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            For Windows requires installation of falsecolor.exe,</span>
<span class="sd">            which is part of radwinexe-5.0.a.8-win64.zip found at</span>
<span class="sd">            http://www.jaloxa.eu/resources/radiance/radwinexe.shtml</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: error checking for installation of falsecolor.exe </span>
        
        <span class="k">if</span> <span class="n">octfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">octfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">octfile</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generating scene in WM-2. This may take some time.&#39;</span><span class="p">)</span>
        <span class="c1">#TODO: update and test this for cross-platform compatibility using os.path.join</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;rpict -i -dp 256 -ar 48 -ms 1 -ds .2 -dj .9 -dt .1 &quot;</span><span class="o">+</span>\
              <span class="s2">&quot;-dc .5 -dr 1 -ss 1 -st .1 -ab 3  -aa .1 -ad 1536 -as 392 &quot;</span> <span class="o">+</span>\
              <span class="s2">&quot;-av 25 25 25 -lr 8 -lw 1e-4 -vf views/&quot;</span><span class="o">+</span><span class="n">viewfile</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">octfile</span>

        <span class="n">WM2_out</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="c1"># determine the extreme maximum value to help with falsecolor autoscale</span>
        <span class="n">extrm_out</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">(</span><span class="s2">&quot;pextrem&quot;</span><span class="p">,</span><span class="n">WM2_out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">))</span>
        <span class="c1"># cast the pextrem string as a float and find the max value</span>
        <span class="n">WM2max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">extrm_out</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving scene in false color&#39;</span><span class="p">)</span>
        <span class="c1">#auto scale false color map</span>
        <span class="k">if</span> <span class="n">WM2max</span> <span class="o">&lt;</span> <span class="mi">1100</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;falsecolor -l W/m2 -m 1 -s 1100 -n 11&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;falsecolor -l W/m2 -m 1 -s </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">WM2max</span><span class="p">,)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">_FC.hdr&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">viewfile</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">WM2_out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">),</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;possible solution: install radwinexe binary package from &#39;</span>
                      <span class="s1">&#39;http://www.jaloxa.eu/resources/radiance/radwinexe.shtml&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_linePtsArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linePtsDict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to just print the x y and z values in an array format,</span>
<span class="sd">        just like they will show in the .csv result files.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xstart</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;xstart&#39;</span><span class="p">]</span>
        <span class="n">ystart</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;ystart&#39;</span><span class="p">]</span>
        <span class="n">zstart</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;zstart&#39;</span><span class="p">]</span>
        <span class="n">xinc</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;xinc&#39;</span><span class="p">]</span>
        <span class="n">yinc</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;yinc&#39;</span><span class="p">]</span>
        <span class="n">zinc</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;zinc&#39;</span><span class="p">]</span>
        <span class="n">sx_xinc</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;sx_xinc&#39;</span><span class="p">]</span>
        <span class="n">sx_yinc</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;sx_yinc&#39;</span><span class="p">]</span>
        <span class="n">sx_zinc</span> <span class="o">=</span> <span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;sx_zinc&#39;</span><span class="p">]</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">])</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">])</span>
        <span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linePtsDict</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nz</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nx</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Ny</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">.</span> <span class="n">append</span><span class="p">(</span><span class="n">xstart</span><span class="o">+</span><span class="n">iy</span><span class="o">*</span><span class="n">xinc</span><span class="o">+</span><span class="n">ix</span><span class="o">*</span><span class="n">sx_xinc</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">.</span> <span class="n">append</span><span class="p">(</span><span class="n">ystart</span><span class="o">+</span><span class="n">iy</span><span class="o">*</span><span class="n">yinc</span><span class="o">+</span><span class="n">ix</span><span class="o">*</span><span class="n">sx_yinc</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">.</span> <span class="n">append</span><span class="p">(</span><span class="n">zstart</span><span class="o">+</span><span class="n">iy</span><span class="o">*</span><span class="n">zinc</span><span class="o">+</span><span class="n">ix</span><span class="o">*</span><span class="n">sx_zinc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
        
    <span class="k">def</span> <span class="nf">_linePtsMakeDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linePtsDict</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">linePtsDict</span>
        <span class="n">linepts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linePtsMake3D</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;xstart&#39;</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;ystart&#39;</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;zstart&#39;</span><span class="p">],</span>
                            <span class="n">a</span><span class="p">[</span><span class="s1">&#39;xinc&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;yinc&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;zinc&#39;</span><span class="p">],</span>
                            <span class="n">a</span><span class="p">[</span><span class="s1">&#39;sx_xinc&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;sx_yinc&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;sx_zinc&#39;</span><span class="p">],</span>
                            <span class="n">a</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;orient&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">linepts</span>

    <span class="k">def</span> <span class="nf">_linePtsMake3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">zstart</span><span class="p">,</span> <span class="n">xinc</span><span class="p">,</span> <span class="n">yinc</span><span class="p">,</span> <span class="n">zinc</span><span class="p">,</span>
                       <span class="n">sx_xinc</span><span class="p">,</span> <span class="n">sx_yinc</span><span class="p">,</span> <span class="n">sx_zinc</span><span class="p">,</span>
                      <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">orient</span><span class="p">):</span>
        <span class="c1">#create linepts text input with variable x,y,z.</span>
        <span class="c1">#If you don&#39;t want to iterate over a variable, inc = 0, N = 1.</span>

        <span class="n">linepts</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># make sure Nx, Ny, Nz are ints.</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="p">)</span>
        <span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nz</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nz</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nx</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Ny</span><span class="p">):</span>
                    <span class="n">xpos</span> <span class="o">=</span> <span class="n">xstart</span><span class="o">+</span><span class="n">iy</span><span class="o">*</span><span class="n">xinc</span><span class="o">+</span><span class="n">ix</span><span class="o">*</span><span class="n">sx_xinc</span>
                    <span class="n">ypos</span> <span class="o">=</span> <span class="n">ystart</span><span class="o">+</span><span class="n">iy</span><span class="o">*</span><span class="n">yinc</span><span class="o">+</span><span class="n">ix</span><span class="o">*</span><span class="n">sx_yinc</span>
                    <span class="n">zpos</span> <span class="o">=</span> <span class="n">zstart</span><span class="o">+</span><span class="n">iy</span><span class="o">*</span><span class="n">zinc</span><span class="o">+</span><span class="n">ix</span><span class="o">*</span><span class="n">sx_zinc</span>
                    <span class="n">linepts</span> <span class="o">=</span> <span class="n">linepts</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ypos</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">zpos</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">orient</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="se">\r</span><span class="s2">&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">linepts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_irrPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octfile</span><span class="p">,</span> <span class="n">linepts</span><span class="p">,</span> <span class="n">mytitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotflag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">accuracy</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (plotdict) = _irrPlot(linepts,title,time,plotflag, accuracy)</span>
<span class="sd">        irradiance plotting using rtrace</span>
<span class="sd">        pass in the linepts structure of the view along with a title string</span>
<span class="sd">        for the plots.  </span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        octfile : string</span>
<span class="sd">            Filename and extension of .oct file</span>
<span class="sd">        linepts : </span>
<span class="sd">            Output from :py:class:`bifacial_radiance.AnalysisObj._linePtsMake3D`</span>
<span class="sd">        mytitle : string</span>
<span class="sd">            Title to append to results files</span>
<span class="sd">        plotflag : Boolean</span>
<span class="sd">            Include plot of resulting irradiance</span>
<span class="sd">        accuracy : string</span>
<span class="sd">            Either &#39;low&#39; (default - faster) or &#39;high&#39;</span>
<span class="sd">            (better for low light)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : dictionary</span>
<span class="sd">            out.x,y,z  - coordinates of point</span>
<span class="sd">            .r,g,b     - r,g,b values in Wm-2</span>
<span class="sd">            .Wm2            - equal-weight irradiance</span>
<span class="sd">            .mattype        - material intersected</span>
<span class="sd">            .title      - title passed in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">mytitle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mytitle</span> <span class="o">=</span> <span class="n">octfile</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">plotflag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotflag</span> <span class="o">=</span> <span class="kc">False</span>

        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpc</span> <span class="p">:</span>
            <span class="kn">import</span> <span class="nn">time</span>
            <span class="n">time_to_wait</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">time_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">octfile</span><span class="p">):</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">time_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">time_counter</span> <span class="o">&gt;</span> <span class="n">time_to_wait</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: OCTFILE NOT FOUND&#39;</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">octfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Analysis aborted. octfile = None&#39;</span> <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
        <span class="c1">#out = dict.fromkeys([&#39;Wm2&#39;,&#39;x&#39;,&#39;y&#39;,&#39;z&#39;,&#39;r&#39;,&#39;g&#39;,&#39;b&#39;,&#39;mattype&#39;,&#39;title&#39;])</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mytitle</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Linescan in process: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">mytitle</span><span class="p">))</span>
        <span class="c1">#rtrace ambient values set for &#39;very accurate&#39;:</span>
        <span class="c1">#cmd = &quot;rtrace -i -ab 5 -aa .08 -ar 512 -ad 2048 -as 512 -h -oovs &quot;+ octfile</span>

        <span class="k">if</span> <span class="n">accuracy</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span>
            <span class="c1">#rtrace optimized for faster scans: (ab2, others 96 is too coarse)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;rtrace -i -ab 2 -aa .1 -ar 256 -ad 2048 -as 256 -h -oovs &quot;</span><span class="o">+</span> <span class="n">octfile</span>
        <span class="k">elif</span> <span class="n">accuracy</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span>
            <span class="c1">#rtrace ambient values set for &#39;very accurate&#39;:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;rtrace -i -ab 5 -aa .08 -ar 512 -ad 2048 -as 512 -h -oovs &quot;</span><span class="o">+</span> <span class="n">octfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_irrPlot accuracy options: &quot;low&quot; or &quot;high&quot;&#39;</span><span class="p">)</span>
            <span class="k">return</span><span class="p">({})</span>



        <span class="n">temp_out</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">_popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">linepts</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c1"># when file errors occur, temp_out is None, and err message is printed.</span>
        <span class="k">if</span> <span class="n">temp_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">temp_out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]])</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">plotflag</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Wm2 irradiance&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">mytitle</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># return empty if error message.</span>

        <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_saveResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reardata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">RGB</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to save output from _irrPlot</span>
<span class="sd">        If rearvals is passed in, back ratio is saved</span>
<span class="sd">        If data = None then only reardata is saved.</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        savefile : str</span>
<span class="sd">            If set to None, will write to default .csv filename in results folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">savefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">savefile</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
        
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">reardata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># only rear data is passed.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">reardata</span>
            <span class="n">reardata</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># run process like normal but swap labels at the end</span>
            <span class="n">rearswapflag</span> <span class="o">=</span> <span class="kc">True</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rearswapflag</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="c1"># make savefile dataframe and set self.attributes</span>
        
        <span class="k">if</span> <span class="n">RGB</span><span class="p">:</span>
            <span class="n">data_sub</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;mattype&#39;</span><span class="p">,</span> <span class="s1">&#39;Wm2&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_sub</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;mattype&#39;</span><span class="p">,</span><span class="s1">&#39;Wm2&#39;</span> <span class="p">]}</span>
            
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_sub</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Wm2&#39;</span><span class="p">:</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">})</span>
        
        <span class="k">if</span> <span class="n">reardata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;rearZ&#39;</span><span class="p">,</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;rearMat&#39;</span><span class="p">,</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;Wm2Back&#39;</span><span class="p">,</span>  <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">])</span>
            <span class="c1"># add 1mW/m2 to avoid dividebyzero</span>
            <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Back/FrontRatio&#39;</span><span class="p">,</span>  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">.001</span><span class="p">))</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;backRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Back/FrontRatio&#39;</span><span class="p">]</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rearX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rearY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">RGB</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rearR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rearG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rearB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
                
        <span class="c1"># rename columns if only rear data was originally passed</span>
        <span class="k">if</span> <span class="n">rearswapflag</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">:</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">,</span><span class="s1">&#39;mattype&#39;</span><span class="p">:</span><span class="s1">&#39;rearMat&#39;</span><span class="p">})</span>
        <span class="c1"># set attributes of analysis to equal columns of df</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>    
        <span class="c1"># only save a subset</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rearX&#39;</span><span class="p">,</span><span class="s1">&#39;rearY&#39;</span><span class="p">,</span><span class="s1">&#39;backRatio&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">savefile</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
                           <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%0.3f</span><span class="s1">&#39;</span><span class="p">)</span>


        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">savefile</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">savefile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_saveResultsCumulative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">reardata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TEMPORARY FUNCTION -- this is a fix to save ONE cumulative results csv</span>
<span class="sd">        in the main working folder for when doing multiple entries in a </span>
<span class="sd">        tracker dict.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        savefile : str</span>
<span class="sd">            If set to None, will write to default .csv filename in results folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">savefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">savefile</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
        <span class="c1"># make dataframe from results</span>
        <span class="n">data_sub</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;Wm2&#39;</span><span class="p">,</span> <span class="s1">&#39;mattype&#39;</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mattype</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span>
        <span class="c1">#TODO: data_sub front values don&#39;t seem to be saved to self.</span>
        <span class="k">if</span> <span class="n">reardata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rearX</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rearY</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rearMat</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span>
            <span class="n">data_sub</span><span class="p">[</span><span class="s1">&#39;rearMat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rearMat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rearZ</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">data_sub</span><span class="p">[</span><span class="s1">&#39;rearZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rearZ</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span> <span class="o">=</span> <span class="n">data_sub</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Wm2&#39;</span><span class="p">)</span>
            <span class="n">data_sub</span><span class="p">[</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span> <span class="o">=</span> <span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span>
            <span class="n">data_sub</span><span class="p">[</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backRatio</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="mf">.001</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reardata</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">])]</span> <span class="c1"># add 1mW/m2 to avoid dividebyzero</span>
            <span class="n">data_sub</span><span class="p">[</span><span class="s1">&#39;Back/FrontRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backRatio</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_sub</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
                      <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;rearZ&#39;</span><span class="p">,</span><span class="s1">&#39;mattype&#39;</span><span class="p">,</span><span class="s1">&#39;rearMat&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;Wm2Front&#39;</span><span class="p">,</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">,</span><span class="s1">&#39;Back/FrontRatio&#39;</span><span class="p">],</span>
                                 <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%0.3f</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># new in 0.2.3</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_sub</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%0.3f</span><span class="s1">&#39;</span><span class="p">,</span>
                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;mattype&#39;</span><span class="p">,</span><span class="s1">&#39;Wm2&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">savefile</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">savefile</span><span class="p">)</span>   

<div class="viewcode-block" id="AnalysisObj.moduleAnalysis"><a class="viewcode-back" href="../../generated/bifacial_radiance.AnalysisObj.moduleAnalysis.html#bifacial_radiance.AnalysisObj.moduleAnalysis">[docs]</a>    <span class="k">def</span> <span class="nf">moduleAnalysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">modWanted</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rowWanted</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">sensorsy</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">sensorsx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                       <span class="n">frontsurfaceoffset</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">backsurfaceoffset</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> 
                       <span class="n">modscanfront</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modscanback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                       <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler function that decides how to handle different number of front</span>
<span class="sd">        and back sensors. If number for front sensors is not provided or is </span>
<span class="sd">        the same as for the back, _moduleAnalysis</span>
<span class="sd">        is called only once. Else it is called twice to get the different front</span>
<span class="sd">        and back dictionary. </span>
<span class="sd">                  </span>
<span class="sd">        This function defines the scan points to be used in the </span>
<span class="sd">        :py:class:`~bifacial_radiance.AnalysisObj.analysis` function,</span>
<span class="sd">        to perform the raytrace through Radiance function `rtrace`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        scene : ``SceneObj``</span>
<span class="sd">            Generated with :py:class:`~bifacial_radiance.RadianceObj.makeScene`.</span>
<span class="sd">        modWanted : int</span>
<span class="sd">            Module wanted to sample. If none, defaults to center module (rounding down)</span>
<span class="sd">        rowWanted : int</span>
<span class="sd">            Row wanted to sample. If none, defaults to center row (rounding down)</span>
<span class="sd">        sensorsy : int or list </span>
<span class="sd">            Number of &#39;sensors&#39; or scanning points along the collector width </span>
<span class="sd">            (CW) of the module(s). If multiple values are passed, first value</span>
<span class="sd">            represents number of front sensors, second value is number of back sensors</span>
<span class="sd">        sensorsx : int or list </span>
<span class="sd">            Number of &#39;sensors&#39; or scanning points along the length, the side perpendicular </span>
<span class="sd">            to the collector width (CW) of the module(s) for the back side of the module. </span>
<span class="sd">            If multiple values are passed, first value represents number of </span>
<span class="sd">            front sensors, second value is number of back sensors.</span>
<span class="sd">        debug : bool</span>
<span class="sd">            Activates various print statemetns for debugging this function.</span>
<span class="sd">        modscanfront : dict</span>
<span class="sd">            Dictionary to modify the fronstcan values established by this routine </span>
<span class="sd">            and set a specific value. Keys possible are &#39;xstart&#39;, &#39;ystart&#39;, &#39;zstart&#39;,</span>
<span class="sd">            &#39;xinc&#39;, &#39;yinc&#39;, &#39;zinc&#39;, &#39;Nx&#39;, &#39;Ny&#39;, &#39;Nz&#39;, and &#39;orient&#39;. If modifying </span>
<span class="sd">            Nx, Ny or Nz, make sure to modify on modscanback to avoid issues on </span>
<span class="sd">            results writing stage. All of these keys are ints or </span>
<span class="sd">            floats except for &#39;orient&#39; which takes x y z values as string &#39;x y z&#39;</span>
<span class="sd">            for example &#39;0 0 -1&#39;. These values will overwrite the internally</span>
<span class="sd">            calculated frontscan dictionary for the module &amp; row selected.</span>
<span class="sd">        modscanback: dict</span>
<span class="sd">            Dictionary to modify the backscan values established by this routine </span>
<span class="sd">            and set a specific value. Keys possible are &#39;xstart&#39;, &#39;ystart&#39;, &#39;zstart&#39;,</span>
<span class="sd">            &#39;xinc&#39;, &#39;yinc&#39;, &#39;zinc&#39;, &#39;Nx&#39;, &#39;Ny&#39;, &#39;Nz&#39;, and &#39;orient&#39;. If modifying </span>
<span class="sd">            Nx, Ny or Nz, make sure to modify on modscanback to avoid issues on </span>
<span class="sd">            results writing stage. All of these keys are ints or </span>
<span class="sd">            floats except for &#39;orient&#39; which takes x y z values as string &#39;x y z&#39;</span>
<span class="sd">            for example &#39;0 0 -1&#39;. These values will overwrite the internally</span>
<span class="sd">            calculated frontscan dictionary for the module &amp; row selected.    </span>
<span class="sd">        relative : Bool</span>
<span class="sd">            if passing modscanfront and modscanback to modify dictionarie of positions,</span>
<span class="sd">            this sets if the values passed to be updated are relative or absolute. </span>
<span class="sd">            Default is absolute value (relative=False)</span>
<span class="sd">   </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        frontscan : dictionary</span>
<span class="sd">            Scan dictionary for module&#39;s front side. Used to pass into </span>
<span class="sd">            :py:class:`~bifacial_radiance.AnalysisObj.analysis` function</span>
<span class="sd">        backscan : dictionary </span>
<span class="sd">            Scan dictionary for module&#39;s back side. Used to pass into </span>
<span class="sd">            :py:class:`~bifacial_radiance.AnalysisObj.analysis` function</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Height:  clearance height for fixed tilt systems, or torque tube</span>
        <span class="c1">#           height for single-axis tracked systems.</span>
        <span class="c1">#   Single axis tracked systems will consider the offset to calculate the final height.</span>
        
        <span class="k">def</span> <span class="nf">_checkSensors</span><span class="p">(</span><span class="n">sensors</span><span class="p">):</span>
            <span class="c1"># Checking Sensors input data for list or tuple</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span><span class="o">==</span><span class="nb">tuple</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sensors_back</span> <span class="o">=</span> <span class="n">sensors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">sensors_front</span> <span class="o">=</span> <span class="n">sensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="c1"># only 1 value passed??</span>
                    <span class="n">sensors_back</span> <span class="o">=</span> <span class="n">sensors_front</span> <span class="o">=</span> <span class="n">sensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">):</span>
                <span class="c1"># Ensure sensors are positive int values.</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;input sensorsy must be numeric &gt;0&#39;</span><span class="p">)</span>
                <span class="n">sensors_back</span> <span class="o">=</span> <span class="n">sensors_front</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: invalid value passed for sensors. Setting = 1&#39;</span><span class="p">)</span>
                <span class="n">sensors_back</span> <span class="o">=</span> <span class="n">sensors_front</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">sensors_front</span><span class="p">,</span> <span class="n">sensors_back</span>
            
        <span class="n">sensorsy_front</span><span class="p">,</span> <span class="n">sensorsy_back</span> <span class="o">=</span> <span class="n">_checkSensors</span><span class="p">(</span><span class="n">sensorsy</span><span class="p">)</span>
        <span class="n">sensorsx_front</span><span class="p">,</span> <span class="n">sensorsx_back</span> <span class="o">=</span> <span class="n">_checkSensors</span><span class="p">(</span><span class="n">sensorsx</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">sensorsx_back</span> <span class="o">!=</span> <span class="n">sensorsx_front</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sensorsy_back</span> <span class="o">!=</span> <span class="n">sensorsy_front</span><span class="p">):</span>
            <span class="n">sensors_diff</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sensors_diff</span> <span class="o">=</span> <span class="kc">False</span>
          
        <span class="n">dtor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>

        <span class="c1"># Internal scene parameters are stored in scene.sceneDict. Load these into local variables</span>
        <span class="n">sceneDict</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">sceneDict</span>

        <span class="n">azimuth</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span>
        <span class="n">tilt</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span>
        <span class="n">nMods</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nMods&#39;</span><span class="p">]</span>
        <span class="n">nRows</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nRows&#39;</span><span class="p">]</span>
        <span class="n">originx</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;originx&#39;</span><span class="p">]</span>
        <span class="n">originy</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;originy&#39;</span><span class="p">]</span>

       <span class="c1"># offset = moduleDict[&#39;offsetfromaxis&#39;]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">offsetfromaxis</span>
        <span class="n">sceney</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sceney</span>
        <span class="n">scenex</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">scenex</span>

        <span class="c1"># x needed for sensorsx&gt;1 case</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">x</span>
        
        <span class="c1">## Check for proper input variables in sceneDict</span>
        <span class="k">if</span> <span class="s1">&#39;pitch&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;gcr&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="n">sceney</span> <span class="o">/</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;gcr&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error: no &#39;pitch&#39; or &#39;gcr&#39; passed in sceneDict&quot;</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;axis_tilt&#39;</span> <span class="ow">in</span> <span class="n">sceneDict</span><span class="p">:</span>
            <span class="n">axis_tilt</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;axis_tilt&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis_tilt</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">):</span>
            <span class="n">modulez</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">z</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Module&#39;s z not set on sceneDict internal dictionary. Setting to default&quot;</span><span class="p">)</span>
            <span class="n">modulez</span> <span class="o">=</span> <span class="mf">0.02</span>
            
        <span class="k">if</span> <span class="n">frontsurfaceoffset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frontsurfaceoffset</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">if</span> <span class="n">backsurfaceoffset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backsurfaceoffset</span> <span class="o">=</span> <span class="mf">0.001</span>
        
        <span class="c1"># The Sensor routine below needs a &quot;hub-height&quot;, not a clearance height.</span>
        <span class="c1"># The below complicated check checks to see if height (deprecated) is passed,</span>
        <span class="c1"># and if clearance_height or hub_height is passed as well.</span>

        <span class="n">sceneDict</span><span class="p">,</span> <span class="n">use_clearanceheight</span>  <span class="o">=</span> <span class="n">_heightCasesSwitcher</span><span class="p">(</span><span class="n">sceneDict</span><span class="p">,</span> 
                                                               <span class="n">preferred</span> <span class="o">=</span> <span class="s1">&#39;hub_height&#39;</span><span class="p">,</span>
                                                               <span class="n">nonpreferred</span> <span class="o">=</span> <span class="s1">&#39;clearance_height&#39;</span><span class="p">,</span>
                                                               <span class="n">suppress_warning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">use_clearanceheight</span> <span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> \
                <span class="n">sceney</span> <span class="o">-</span> <span class="n">offset</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For debug:</span><span class="se">\n</span><span class="s2"> hub_height, Azimuth, Tilt, nMods, nRows, &quot;</span>
                  <span class="s2">&quot;Pitch, Offset, SceneY, SceneX&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">nMods</span><span class="p">,</span> <span class="n">nRows</span><span class="p">,</span>
                  <span class="n">pitch</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">sceney</span><span class="p">,</span> <span class="n">scenex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modWanted</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot; FYI Modules and Rows start at index 1. &quot;</span>
                  <span class="s2">&quot;Reindexing to modWanted 1&quot;</span>  <span class="p">)</span>
            <span class="n">modWanted</span> <span class="o">=</span> <span class="n">modWanted</span><span class="o">+</span><span class="mi">1</span>  <span class="c1"># otherwise it gives results on Space.</span>

        <span class="k">if</span> <span class="n">rowWanted</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot; FYI Modules and Rows start at index 1. &quot;</span>
                  <span class="s2">&quot;Reindexing to rowWanted 1&quot;</span>  <span class="p">)</span>
            <span class="n">rowWanted</span> <span class="o">=</span> <span class="n">rowWanted</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">modWanted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modWanted</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">nMods</span> <span class="o">/</span> <span class="mf">1.99</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rowWanted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rowWanted</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">nRows</span> <span class="o">/</span> <span class="mf">1.99</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;Sampling: modWanted </span><span class="si">{</span><span class="n">modWanted</span><span class="si">}</span><span class="s2">, rowWanted </span><span class="si">{</span><span class="n">rowWanted</span><span class="si">}</span><span class="s2"> &quot;</span>
                  <span class="s2">&quot;out of </span><span class="si">{nMods}</span><span class="s2"> modules, </span><span class="si">{nRows}</span><span class="s2"> rows&quot;</span> <span class="p">)</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">modWanted</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">scenex</span> <span class="o">-</span> <span class="p">(</span><span class="n">scenex</span><span class="o">*</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nMods</span><span class="o">/</span><span class="mf">1.99</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">rowWanted</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pitch</span> <span class="o">-</span> <span class="p">(</span><span class="n">pitch</span><span class="o">*</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nRows</span> <span class="o">/</span> <span class="mf">1.99</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span> <span class="p">((</span><span class="mi">180</span><span class="o">-</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">-</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">180</span><span class="o">-</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span> <span class="p">((</span><span class="mi">180</span><span class="o">-</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">180</span><span class="o">-</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">axis_tilt</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">azimuth</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;fixing height for axis_tilt&quot;</span><span class="p">)</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="p">(</span><span class="n">modWanted</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">scenex</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">axis_tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>

        <span class="c1"># Edge of Panel</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>


        <span class="c1"># Axis of rotation Offset (if offset is not 0) for the front of the module</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">modulez</span> <span class="o">+</span> <span class="n">frontsurfaceoffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">modulez</span> <span class="o">+</span> <span class="n">frontsurfaceoffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">modulez</span> <span class="o">+</span> <span class="n">frontsurfaceoffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>

        <span class="c1"># Axis of rotation Offset, for the back of the module </span>
        <span class="n">x4</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">backsurfaceoffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">backsurfaceoffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">z4</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">backsurfaceoffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>

        <span class="n">xstartfront</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">x3</span> <span class="o">+</span> <span class="n">originx</span>
        <span class="n">xstartback</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">x4</span> <span class="o">+</span> <span class="n">originx</span>

        <span class="n">ystartfront</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">y3</span> <span class="o">+</span> <span class="n">originy</span>
        <span class="n">ystartback</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">y4</span> <span class="o">+</span> <span class="n">originy</span>

        <span class="n">zstartfront</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">z2</span> <span class="o">+</span> <span class="n">z3</span>
        <span class="n">zstartback</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">z2</span> <span class="o">+</span> <span class="n">z4</span>

        <span class="c1">#Adjust orientation of scan depending on tilt &amp; azimuth</span>
        <span class="n">zdir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">ydir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">xdir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
        <span class="n">front_orient</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%0.3f</span><span class="s1"> </span><span class="si">%0.3f</span><span class="s1"> </span><span class="si">%0.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="o">-</span><span class="n">xdir</span><span class="p">,</span> <span class="o">-</span><span class="n">ydir</span><span class="p">,</span> <span class="o">-</span><span class="n">zdir</span><span class="p">)</span>
        <span class="n">back_orient</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%0.3f</span><span class="s1"> </span><span class="si">%0.3f</span><span class="s1"> </span><span class="si">%0.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xdir</span><span class="p">,</span> <span class="n">ydir</span><span class="p">,</span> <span class="n">zdir</span><span class="p">)</span>
    
        <span class="c1">#IF cellmodule:</span>
        <span class="c1">#TODO: Add check for sensorsx_back</span>
        <span class="c1">#temp = scene.moduleDict.get(&#39;cellModule&#39;) #error-free way to query it</span>
        <span class="c1">#if ((temp is not None) and</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;cellModule&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">sensorsy_back</span> <span class="o">==</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cellModule</span><span class="o">.</span><span class="n">numcellsy</span><span class="p">)):</span>
            <span class="n">ycell</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cellModule</span><span class="o">.</span><span class="n">ycell</span>
            <span class="n">xinc_back</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">sceney</span> <span class="o">-</span> <span class="n">ycell</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cellModule</span><span class="o">.</span><span class="n">numcellsy</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">yinc_back</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">sceney</span> <span class="o">-</span> <span class="n">ycell</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cellModule</span><span class="o">.</span><span class="n">numcellsy</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">zinc_back</span> <span class="o">=</span> <span class="p">((</span><span class="n">sceney</span> <span class="o">-</span> <span class="n">ycell</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cellModule</span><span class="o">.</span><span class="n">numcellsy</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">firstsensorxstartfront</span> <span class="o">=</span> <span class="n">xstartfront</span> <span class="o">-</span> <span class="n">scene</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cellModule</span><span class="o">.</span><span class="n">ycell</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">firstsensorxstartback</span> <span class="o">=</span> <span class="n">xstartback</span>  <span class="o">-</span> <span class="n">ycell</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">firstsensorystartfront</span> <span class="o">=</span> <span class="n">ystartfront</span> <span class="o">-</span> <span class="n">ycell</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">firstsensorystartback</span> <span class="o">=</span> <span class="n">ystartback</span> <span class="o">-</span> <span class="n">ycell</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">firstsensorzstartfront</span> <span class="o">=</span> <span class="n">zstartfront</span> <span class="o">+</span> <span class="n">ycell</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">firstsensorzstartback</span> <span class="o">=</span> <span class="n">zstartback</span> <span class="o">+</span> <span class="n">ycell</span><span class="o">/</span><span class="mi">2</span>  <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">xinc_front</span> <span class="o">=</span> <span class="n">xinc_back</span>
            <span class="n">yinc_front</span> <span class="o">=</span> <span class="n">yinc_back</span>
            <span class="n">zinc_front</span> <span class="o">=</span> <span class="n">zinc_back</span>
            
            <span class="n">sx_xinc_front</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sx_yinc_front</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sx_zinc_front</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sx_xinc_back</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sx_yinc_back</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sx_zinc_back</span> <span class="o">=</span> <span class="mf">0.0</span>
        
            <span class="k">if</span> <span class="p">(</span><span class="n">sensorsx_back</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Cell-level module analysis for sensorsx &gt; 1 not &quot;</span><span class="o">+</span>
                      <span class="s2">&quot;fine-tuned yet. Use at own risk, some of the x positions &quot;</span><span class="o">+</span>
                      <span class="s2">&quot;might fall in spacing between cells.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="n">xinc_back</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsy_back</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">yinc_back</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsy_back</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            <span class="n">zinc_back</span> <span class="o">=</span> <span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsy_back</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
            
            
            <span class="k">if</span> <span class="n">sensors_diff</span><span class="p">:</span>
                <span class="n">xinc_front</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsy_front</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
                <span class="n">yinc_front</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsy_front</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
                <span class="n">zinc_front</span> <span class="o">=</span> <span class="p">(</span><span class="n">sceney</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsy_front</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xinc_front</span> <span class="o">=</span> <span class="n">xinc_back</span>
                <span class="n">yinc_front</span> <span class="o">=</span> <span class="n">yinc_back</span>
                <span class="n">zinc_front</span> <span class="o">=</span> <span class="n">zinc_back</span>
                
            <span class="n">firstsensorxstartfront</span> <span class="o">=</span> <span class="n">xstartfront</span><span class="o">+</span><span class="n">xinc_front</span>
            <span class="n">firstsensorxstartback</span> <span class="o">=</span> <span class="n">xstartback</span><span class="o">+</span><span class="n">xinc_back</span>
            <span class="n">firstsensorystartfront</span> <span class="o">=</span> <span class="n">ystartfront</span><span class="o">+</span><span class="n">yinc_front</span>
            <span class="n">firstsensorystartback</span> <span class="o">=</span> <span class="n">ystartback</span><span class="o">+</span><span class="n">yinc_back</span>
            <span class="n">firstsensorzstartfront</span> <span class="o">=</span> <span class="n">zstartfront</span> <span class="o">+</span> <span class="n">zinc_front</span>
            <span class="n">firstsensorzstartback</span> <span class="o">=</span> <span class="n">zstartback</span> <span class="o">+</span> <span class="n">zinc_back</span>
        
            <span class="c1">## Correct positions for sensorsx other than 1</span>
            <span class="c1"># TODO: At some point, this equations can include the case where </span>
            <span class="c1"># sensorsx = 1, and cleanup the original position calculation to place</span>
            <span class="c1"># firstsensorxstartback before this section on edge not on center.</span>
            <span class="c1"># will save some multiplications and division but well, it works :)</span>
            
            <span class="k">if</span> <span class="n">sensorsx_back</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">sx_xinc_back</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsx_back</span><span class="o">*</span><span class="mf">1.0</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
                <span class="n">sx_yinc_back</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsx_back</span><span class="o">*</span><span class="mf">1.0</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
                <span class="c1"># Not needed unless axis_tilt != 0, which is not a current option</span>
                <span class="n">sx_zinc_back</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1">#       </span>
                
                <span class="n">firstsensorxstartback</span> <span class="o">=</span> <span class="n">firstsensorxstartback</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">+</span> <span class="n">sx_xinc_back</span>
                <span class="n">firstsensorystartback</span> <span class="o">=</span> <span class="n">firstsensorystartback</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">+</span> <span class="n">sx_yinc_back</span>
                <span class="c1"># firstsensorzstartback Not needed unless axis_tilt != 0, which is not a current option</span>
                <span class="c1">#firstsensorxstartfront = firstsensorxstartback</span>
                <span class="c1">#firstsensorystartfront = firstsensorystartback                </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sx_xinc_back</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sx_yinc_back</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sx_zinc_back</span> <span class="o">=</span> <span class="mf">0.0</span>
            
            <span class="k">if</span> <span class="n">sensorsx_front</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">sx_xinc_front</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsx_front</span><span class="o">*</span><span class="mf">1.0</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
                <span class="n">sx_yinc_front</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">sensorsx_front</span><span class="o">*</span><span class="mf">1.0</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
                <span class="c1"># Not needed unless axis_tilt != 0, which is not a current option</span>
                <span class="n">sx_zinc_front</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># </span>
                
                <span class="n">firstsensorxstartfront</span> <span class="o">=</span> <span class="n">firstsensorxstartfront</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">+</span> <span class="n">sx_xinc_back</span>
                <span class="n">firstsensorystartfront</span> <span class="o">=</span> <span class="n">firstsensorystartfront</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span> <span class="o">+</span> <span class="n">sx_yinc_back</span>

                <span class="c1"># firstsensorzstartback Not needed unless axis_tilt != 0, which is not a current option</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sx_xinc_front</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sx_yinc_front</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sx_zinc_front</span> <span class="o">=</span> <span class="mf">0.0</span>
                
                
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Azimuth&quot;</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coordinate Center Point of Desired Panel before azm rotation&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coordinate Center Point of Desired Panel after azm rotation&quot;</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Edge of Panel&quot;</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Offset Shift&quot;</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">z3</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final Start Coordinate Front&quot;</span><span class="p">,</span> <span class="n">xstartfront</span><span class="p">,</span> <span class="n">ystartfront</span><span class="p">,</span> <span class="n">zstartfront</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Increase Coordinates&quot;</span><span class="p">,</span> <span class="n">xinc_front</span><span class="p">,</span> <span class="n">yinc_front</span><span class="p">,</span> <span class="n">zinc_front</span><span class="p">)</span>
        
        <span class="n">frontscan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xstart&#39;</span><span class="p">:</span> <span class="n">firstsensorxstartfront</span><span class="p">,</span> <span class="s1">&#39;ystart&#39;</span><span class="p">:</span> <span class="n">firstsensorystartfront</span><span class="p">,</span>
                     <span class="s1">&#39;zstart&#39;</span><span class="p">:</span> <span class="n">firstsensorzstartfront</span><span class="p">,</span>
                     <span class="s1">&#39;xinc&#39;</span><span class="p">:</span><span class="n">xinc_front</span><span class="p">,</span> <span class="s1">&#39;yinc&#39;</span><span class="p">:</span> <span class="n">yinc_front</span><span class="p">,</span> <span class="s1">&#39;zinc&#39;</span><span class="p">:</span><span class="n">zinc_front</span><span class="p">,</span>
                     <span class="s1">&#39;sx_xinc&#39;</span><span class="p">:</span><span class="n">sx_xinc_front</span><span class="p">,</span> <span class="s1">&#39;sx_yinc&#39;</span><span class="p">:</span><span class="n">sx_yinc_front</span><span class="p">,</span>
                     <span class="s1">&#39;sx_zinc&#39;</span><span class="p">:</span><span class="n">sx_zinc_front</span><span class="p">,</span> 
                     <span class="s1">&#39;Nx&#39;</span><span class="p">:</span> <span class="n">sensorsx_front</span><span class="p">,</span> <span class="s1">&#39;Ny&#39;</span><span class="p">:</span><span class="n">sensorsy_front</span><span class="p">,</span> <span class="s1">&#39;Nz&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;orient&#39;</span><span class="p">:</span><span class="n">front_orient</span> <span class="p">}</span>
        <span class="n">backscan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xstart&#39;</span><span class="p">:</span><span class="n">firstsensorxstartback</span><span class="p">,</span> <span class="s1">&#39;ystart&#39;</span><span class="p">:</span> <span class="n">firstsensorystartback</span><span class="p">,</span>
                     <span class="s1">&#39;zstart&#39;</span><span class="p">:</span> <span class="n">firstsensorzstartback</span><span class="p">,</span>
                     <span class="s1">&#39;xinc&#39;</span><span class="p">:</span><span class="n">xinc_back</span><span class="p">,</span> <span class="s1">&#39;yinc&#39;</span><span class="p">:</span> <span class="n">yinc_back</span><span class="p">,</span> <span class="s1">&#39;zinc&#39;</span><span class="p">:</span><span class="n">zinc_back</span><span class="p">,</span>
                     <span class="s1">&#39;sx_xinc&#39;</span><span class="p">:</span><span class="n">sx_xinc_back</span><span class="p">,</span> <span class="s1">&#39;sx_yinc&#39;</span><span class="p">:</span><span class="n">sx_yinc_back</span><span class="p">,</span>
                     <span class="s1">&#39;sx_zinc&#39;</span><span class="p">:</span><span class="n">sx_zinc_back</span><span class="p">,</span> 
                     <span class="s1">&#39;Nx&#39;</span><span class="p">:</span> <span class="n">sensorsx_back</span><span class="p">,</span> <span class="s1">&#39;Ny&#39;</span><span class="p">:</span><span class="n">sensorsy_back</span><span class="p">,</span> <span class="s1">&#39;Nz&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;orient&#39;</span><span class="p">:</span><span class="n">back_orient</span> <span class="p">}</span>

        <span class="k">if</span> <span class="n">modscanfront</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frontscan2</span> <span class="o">=</span> <span class="n">_modDict</span><span class="p">(</span><span class="n">originaldict</span><span class="o">=</span><span class="n">frontscan</span><span class="p">,</span> <span class="n">moddict</span><span class="o">=</span><span class="n">modscanfront</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="n">relative</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frontscan2</span> <span class="o">=</span> <span class="n">frontscan</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">modscanback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backscan2</span> <span class="o">=</span> <span class="n">_modDict</span><span class="p">(</span><span class="n">originaldict</span><span class="o">=</span><span class="n">backscan</span><span class="p">,</span> <span class="n">moddict</span><span class="o">=</span><span class="n">modscanback</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="n">relative</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backscan2</span> <span class="o">=</span> <span class="n">backscan</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>   
                
        <span class="k">return</span> <span class="n">frontscan2</span><span class="p">,</span> <span class="n">backscan2</span> </div>
      
    <span class="k">def</span> <span class="nf">analyzeRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octfile</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">rowWanted</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                   <span class="n">sensorsy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sensorsx</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to Analyze every module in the row. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        octfile : string</span>
<span class="sd">            Filename and extension of .oct file</span>
<span class="sd">        scene : ``SceneObj``</span>
<span class="sd">            Generated with :py:class:`~bifacial_radiance.RadianceObj.makeScene`.</span>
<span class="sd">        rowWanted : int</span>
<span class="sd">            Row wanted to sample. If none, defaults to center row (rounding down)</span>
<span class="sd">        sensorsy : int or list </span>
<span class="sd">            Number of &#39;sensors&#39; or scanning points along the collector width </span>
<span class="sd">            (CW) of the module(s). If multiple values are passed, first value</span>
<span class="sd">            represents number of front sensors, second value is number of back sensors</span>
<span class="sd">        sensorsx : int or list </span>
<span class="sd">            Number of &#39;sensors&#39; or scanning points along the length, the side perpendicular </span>
<span class="sd">            to the collector width (CW) of the module(s) for the back side of the module. </span>
<span class="sd">            If multiple values are passed, first value represents number of </span>
<span class="sd">            front sensors, second value is number of back sensors.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_row : dataframe</span>
<span class="sd">            Dataframe with all values sampled for the row.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#allfront = []</span>
        <span class="c1">#allback = []</span>
        
        <span class="n">nMods</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">sceneDict</span><span class="p">[</span><span class="s1">&#39;nMods&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">rowWanted</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rowWanted</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nRows</span> <span class="o">/</span> <span class="mf">1.99</span><span class="p">)</span>
        <span class="n">df_dict_row</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">row_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;rearZ&#39;</span><span class="p">,</span><span class="s1">&#39;mattype&#39;</span><span class="p">,</span><span class="s1">&#39;rearMat&#39;</span><span class="p">,</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">,</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">,</span><span class="s1">&#39;Back/FrontRatio&#39;</span><span class="p">]</span>
        <span class="n">dict_row</span> <span class="o">=</span> <span class="n">df_dict_row</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">row_keys</span><span class="p">)</span>
        <span class="n">df_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_row</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nMods</span><span class="p">)])</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">nMods</span><span class="p">):</span>
            <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">frontscan</span><span class="p">,</span> <span class="n">backscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moduleAnalysis</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">sensorsy</span><span class="o">=</span><span class="n">sensorsy</span><span class="p">,</span> 
                                        <span class="n">sensorsx</span><span class="o">=</span><span class="n">sensorsx</span><span class="p">,</span> <span class="n">modWanted</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> 
                                        <span class="n">rowWanted</span> <span class="o">=</span> <span class="n">rowWanted</span><span class="p">)</span> 
            <span class="n">allscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">(</span><span class="n">octfile</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;_Module_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">frontscan</span><span class="p">,</span> <span class="n">backscan</span><span class="p">)</span> 
            <span class="n">front_dict</span> <span class="o">=</span> <span class="n">allscan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">back_dict</span> <span class="o">=</span> <span class="n">allscan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">front_dict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">front_dict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">front_dict</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;rearZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">back_dict</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">front_dict</span><span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;rearMat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">back_dict</span><span class="p">[</span><span class="s1">&#39;mattype&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;Wm2Front&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">front_dict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;Wm2Back&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">back_dict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]</span>
            <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;Back/FrontRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">front_dict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">back_dict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]))</span>
            <span class="n">df_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_dict</span>
            <span class="c1">#allfront.append(front)</span>
        <span class="k">return</span> <span class="n">df_row</span>

<div class="viewcode-block" id="AnalysisObj.analysis"><a class="viewcode-back" href="../../generated/bifacial_radiance.AnalysisObj.analysis.html#bifacial_radiance.AnalysisObj.analysis">[docs]</a>    <span class="k">def</span> <span class="nf">analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octfile</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">frontscan</span><span class="p">,</span> <span class="n">backscan</span><span class="p">,</span>
                 <span class="n">plotflag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="n">RGB</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General analysis function, where linepts are passed in for calling the</span>
<span class="sd">        raytrace routine :py:class:`~bifacial_radiance.AnalysisObj._irrPlot` </span>
<span class="sd">        and saved into results with </span>
<span class="sd">        :py:class:`~bifacial_radiance.AnalysisObj._saveResults`.</span>

<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        octfile : string</span>
<span class="sd">            Filename and extension of .oct file</span>
<span class="sd">        name : string </span>
<span class="sd">            Name to append to output files</span>
<span class="sd">        frontscan : scene.frontscan object</span>
<span class="sd">            Object with the sensor location information for the </span>
<span class="sd">            front of the module</span>
<span class="sd">        backscan : scene.backscan object</span>
<span class="sd">            Object with the sensor location information for the </span>
<span class="sd">            rear side of the module</span>
<span class="sd">        plotflag : boolean</span>
<span class="sd">            Include plot of resulting irradiance</span>
<span class="sd">        accuracy : string </span>
<span class="sd">            Either &#39;low&#39; (default - faster) or &#39;high&#39; (better for low light)</span>
<span class="sd">        RGB : Bool</span>
<span class="sd">            If the raytrace is a spectral raytrace and information for the three channe</span>
<span class="sd">            wants to be saved, set RGB to True.</span>

<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">         File saved in `\\results\\irr_name.csv`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">octfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Analysis aborted - no octfile </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">linepts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linePtsMakeDict</span><span class="p">(</span><span class="n">frontscan</span><span class="p">)</span>
        <span class="n">frontDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irrPlot</span><span class="p">(</span><span class="n">octfile</span><span class="p">,</span> <span class="n">linepts</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;_Front&#39;</span><span class="p">,</span>
                                    <span class="n">plotflag</span><span class="o">=</span><span class="n">plotflag</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>

        <span class="c1">#bottom view.</span>
        <span class="n">linepts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linePtsMakeDict</span><span class="p">(</span><span class="n">backscan</span><span class="p">)</span>
        <span class="n">backDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irrPlot</span><span class="p">(</span><span class="n">octfile</span><span class="p">,</span> <span class="n">linepts</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;_Back&#39;</span><span class="p">,</span>
                                   <span class="n">plotflag</span><span class="o">=</span><span class="n">plotflag</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
        <span class="c1"># don&#39;t save if _irrPlot returns an empty file.</span>
        <span class="k">if</span> <span class="n">frontDict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frontDict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">backDict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">frontDict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">backDict</span><span class="p">[</span><span class="s1">&#39;Wm2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backRatio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm2Back</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wm2Front</span> <span class="o">+</span> <span class="mf">.001</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_saveResults</span><span class="p">(</span><span class="n">frontDict</span><span class="p">,</span> <span class="n">reardata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="s1">&#39;irr_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_Front&#39;</span><span class="p">),</span> <span class="n">RGB</span><span class="o">=</span><span class="n">RGB</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_saveResults</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reardata</span><span class="o">=</span><span class="n">backDict</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="s1">&#39;irr_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_Back&#39;</span><span class="p">),</span> <span class="n">RGB</span><span class="o">=</span><span class="n">RGB</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_saveResults</span><span class="p">(</span><span class="n">frontDict</span><span class="p">,</span> <span class="n">backDict</span><span class="p">,</span><span class="s1">&#39;irr_</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">RGB</span><span class="o">=</span><span class="n">RGB</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">frontDict</span><span class="p">,</span> <span class="n">backDict</span></div></div>


<span class="k">def</span> <span class="nf">quickExample</span><span class="p">(</span><span class="n">testfolder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example of how to run a Radiance routine for a simple rooftop bifacial system</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">bifacial_radiance</span>
    
    <span class="k">if</span> <span class="n">testfolder</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">testfolder</span> <span class="o">=</span> <span class="n">bifacial_radiance</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">_interactive_directory</span><span class="p">(</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Select or create an empty directory for the Radiance tree&#39;</span><span class="p">)</span>

    <span class="n">demo</span> <span class="o">=</span> <span class="n">bifacial_radiance</span><span class="o">.</span><span class="n">RadianceObj</span><span class="p">(</span><span class="s1">&#39;simple_panel&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">testfolder</span><span class="p">)</span>  <span class="c1"># Create a RadianceObj &#39;object&#39;</span>

    <span class="c1"># input albedo number or material name like &#39;concrete&#39;.</span>
    <span class="c1"># To see options, run setGround without any input.</span>
    <span class="n">demo</span><span class="o">.</span><span class="n">setGround</span><span class="p">(</span><span class="mf">0.62</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">epwfile</span> <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">getEPW</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="mf">40.01667</span><span class="p">,</span> <span class="n">lon</span><span class="o">=-</span><span class="mf">105.25</span><span class="p">)</span> <span class="c1"># pull TMY data for any global lat/lon</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span> <span class="c1"># no connection to automatically pull data</span>
        <span class="k">pass</span>

    <span class="n">metdata</span> <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">readWeatherFile</span><span class="p">(</span><span class="n">epwfile</span><span class="p">,</span> <span class="n">coerce_year</span><span class="o">=</span><span class="mi">2001</span><span class="p">)</span> <span class="c1"># read in the EPW weather data from above</span>
    <span class="c1">#metdata = demo.readTMY() # select a TMY file using graphical picker</span>
    <span class="c1"># Now we either choose a single time point, or use cumulativesky for the entire year.</span>
    <span class="n">cumulativeSky</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">cumulativeSky</span><span class="p">:</span>
        <span class="n">demo</span><span class="o">.</span><span class="n">genCumSky</span><span class="p">()</span> <span class="c1"># entire year.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">timeindex</span> <span class="o">=</span> <span class="n">metdata</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2001-06-17 12:0:0 -7&#39;</span><span class="p">))</span>
        <span class="n">demo</span><span class="o">.</span><span class="n">gendaylit</span><span class="p">(</span><span class="n">metdata</span><span class="o">=</span><span class="n">metdata</span><span class="p">,</span> <span class="n">timeindex</span><span class="o">=</span><span class="n">timeindex</span><span class="p">)</span>  <span class="c1"># Noon, June 17th</span>


    <span class="c1"># create a scene using panels in landscape at 10 deg tilt, 1.5m pitch. 0.2 m ground clearance</span>
    <span class="n">moduletype</span> <span class="o">=</span> <span class="s1">&#39;test-module&#39;</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">makeModule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">moduletype</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">1.59</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
    <span class="n">sceneDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tilt&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;pitch&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span><span class="s1">&#39;clearance_height&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="s1">&#39;azimuth&#39;</span><span class="p">:</span><span class="mi">180</span><span class="p">,</span> <span class="s1">&#39;nMods&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;nRows&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="c1">#makeScene creates a .rad file with 10 modules per row, 3 rows.</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">makeScene</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span> <span class="n">sceneDict</span><span class="o">=</span><span class="n">sceneDict</span><span class="p">)</span>
    <span class="c1"># makeOct combines all of the ground, sky and object files into .oct file.</span>
    <span class="n">octfile</span> <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">makeOct</span><span class="p">(</span><span class="n">demo</span><span class="o">.</span><span class="n">getfilelist</span><span class="p">())</span>

    <span class="c1"># return an analysis object including the scan dimensions for back irradiance</span>
    <span class="n">analysis</span> <span class="o">=</span> <span class="n">bifacial_radiance</span><span class="o">.</span><span class="n">AnalysisObj</span><span class="p">(</span><span class="n">octfile</span><span class="p">,</span> <span class="n">demo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">frontscan</span><span class="p">,</span> <span class="n">backscan</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">moduleAnalysis</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">sensorsy</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">analysis</span><span class="p">(</span><span class="n">octfile</span><span class="p">,</span> <span class="n">demo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">frontscan</span><span class="p">,</span> <span class="n">backscan</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">)</span>
    <span class="c1"># bifacial ratio should be 11.6% +/- 0.1% (+/- 1% absolute with glass-glass module)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Annual bifacial ratio average:  </span><span class="si">%0.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Back</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">Wm2Front</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">analysis</span>


</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2019, NREL.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>